[00:00:47] <BtbN> Right now, the ovpn-dco seems to have issues when a non-root user/group is configured in the config
[00:00:59] <BtbN> It just fails with "dco_new_peer: netlink reports error (-28): Operation not permitted"
[00:01:29] <ordex> yeah, the binary need the NET_CAP_ADMIN
[00:01:33] <ordex> *needs
[00:01:40] <ordex> or CAP_NET_ADMIN actually
[00:01:49] <BtbN> It has it, but it then drops it itself
[00:02:14] <BtbN> like, I start it as root. But I have "user nobody" in the config file
[00:02:15] <ordex> drops it? oh maybe when changing user
[00:02:23] <ordex> right
[00:02:33] <ordex> then it goes with user nobody
[00:02:41] <ordex> but you can specifically set some caps
[00:03:01] <BtbN> I'd assume it has those caps, if it's started as root?
[00:03:13] <BtbN> So it should keep NET_ADMIN itself, when it knows it needs it
[00:03:22] <BtbN> I'm surprised it works with classic tun interfaces
[00:03:25] <ordex> that'd be nice
[00:03:33] <ordex> but right now it doesn't work that way
[00:03:44] <BtbN> So it has to run as root?
[00:03:52] <ordex> or you explicitly set the cap on the binary
[00:04:04] <ordex> systemd allows you to do so, IIRC
[00:04:24] <BtbN> systemd starts it as root. So as far as systemd is concerned, it has that cap
[00:04:40] <colo> yo can define ambient capabilities in systemd units
[00:04:44] <colo> you*
[00:05:14] <BtbN> Hm, maybe those should be included in the service file openvpn installs
[00:05:35] <colo> for instance, the service unit that invokes my qemu guest instance has these:
[00:05:36] <colo> AmbientCapabilities=CAP_NET_ADMIN
[00:05:36] <colo> CapabilityBoundingSet=CAP_NET_ADMIN
[00:05:50] <colo> but runs as an unprivileged (even dynamic) user
[00:07:41] <BtbN> Adding the ambient cap doesn't seem to help
[00:08:05] <BtbN> I wonder if it's just not the right capability
[00:08:53] <BtbN> no, it just doesn't work. I just gave it ALL caps as ambient, still no dice
[00:09:50] <BtbN> I guess even if they're ambient, it'll drop them when changing user
[00:10:09] <colo> ftr, my service unit file: https://paste.debian.net/plainh/1ec7135c
[00:10:26] <BtbN> That seems stupidly over-engineered
[00:10:37] <BtbN> I'm just using the service file that comes with openvpn
[00:10:59] <colo> that is not a service file for openvpn
[00:11:07] <BtbN> ?
[00:11:22] <colo> I just show you to demonstrate how (i.e., where) I use the options I referred to
[00:11:29] <colo> and this works for the use case of qemu
[00:11:36] <BtbN> I'm aware of how the option works
[00:13:41] <colo> # getpcaps 1083
[00:13:41] <colo> 1083: cap_net_admin=eip
[00:13:47] <colo> is the result for me
[00:14:09] <colo> but yeah, setuid() and friends could _probably_ mess with ambient caps.
[00:20:38] *** Joins: toulene (~toulene@user/toulene)
[00:43:21] *** Quits: NeoFAT32 (~utilisate@user/NeoFAT32) (Remote host closed the connection)
[01:00:44] *** Quits: shibboleth (~shibbolet@user/shibboleth) (Quit: shibboleth)
[01:48:37] *** Quits: gast0n (~g4570n@user/gast0n) (Read error: Connection reset by peer)
[02:34:17] *** Quits: DoucheEnrique (~quassel@i5C7568DC.versanet.de) (Ping timeout: 256 seconds)
[02:34:45] *** Joins: DoucheEnrique (~quassel@i5C75629F.versanet.de)
[03:11:46] *** Quits: mzar (mzar@bpine64.dom.potoki.eu) (Read error: Connection reset by peer)
[03:11:55] *** Quits: wyre (~wyre@user/wyre) (Remote host closed the connection)
[03:11:58] *** Joins: mzar (mzar@bpine64.dom.potoki.eu)
[03:12:12] *** Joins: wyre (~wyre@user/wyre)
[03:13:33] *** Quits: a_west (~a_west@2a01:4f9:c010:5c49::1) (Ping timeout: 252 seconds)
[03:16:45] *** Joins: a_west (~a_west@2a01:4f9:c010:5c49::1)
[03:25:26] *** Joins: eelstrebor (~eelstrebo@198-178-29-136.scb.ne.static.allophone.net)
[04:01:22] *** Quits: eelstrebor (~eelstrebo@198-178-29-136.scb.ne.static.allophone.net) (Quit: Ex-Chat)
[04:49:02] *** Quits: clarkk (~clarkk@2a00:23c7:d106:2600:5a9f:6734:1f65:234f) (Quit: Leaving)
[05:48:20] *** Joins: lord_daemon (~lord_daem@187.36.203.244)
[07:09:31] *** Quits: lord_daemon (~lord_daem@187.36.203.244) (Quit: Leaving)
[07:20:29] *** Joins: adeliktas5 (~adeliktas@i59F5F72C.versanet.de)
[07:21:57] *** Quits: adeliktas (~adeliktas@i59F5F3F1.versanet.de) (Ping timeout: 240 seconds)
[07:21:57] *** adeliktas5 is now known as adeliktas
[09:09:25] *** Joins: nerozero (~nerozero@87.253.63.54)
[09:29:17] *** Quits: Pippin_ (Pippin_@openvpn/community/Pippin) (Quit: Quiting)
[11:07:45] *** Joins: mannequin (uid453465@id-453465.helmsley.irccloud.com)
[11:47:26] *** Quits: TheCoffeMaker (~TheCoffeM@user/thecoffemaker) (Ping timeout: 245 seconds)
[11:49:36] *** Joins: TheCoffeMaker (~TheCoffeM@user/thecoffemaker)
[12:07:06] *** Quits: Furai (~Furai@furai.pl) (Quit: WeeChat 3.4)
[12:12:56] *** Joins: Furai (~Furai@furai.pl)
[13:14:17] *** Quits: jmcgnh (~jmcgnh@wikipedia/jmcgnh) (Ping timeout: 256 seconds)
[13:18:54] *** Joins: jmcgnh (~jmcgnh@wikipedia/jmcgnh)
[13:32:46] *** Joins: clarkk (~clarkk@2a00:23c7:d106:2600:5a9f:6734:1f65:234f)
[13:39:36] *** Joins: NeoFAT32 (~utilisate@user/NeoFAT32)
[13:41:00] *** Quits: NeoFAT32 (~utilisate@user/NeoFAT32) (Client Quit)
[14:35:44] *** Quits: winstonsmith (~winstonsm@gateway/vpn/pia/winstonsmith) (Remote host closed the connection)
[14:36:03] *** Joins: winstonsmith (~winstonsm@gateway/vpn/pia/winstonsmith)
[14:38:58] *** Joins: becm (~becm@55d4e18a.access.ecotel.net)
[14:39:34] *** Quits: zulutango (~zulutango@static-n58-105-160-58.mas4.nsw.optusnet.com.au) (Ping timeout: 272 seconds)
[15:30:17] *** Quits: csrf (~csrf@user/csrf) (Quit: ZNC 1.7.2+deb3 - https://znc.in)
[15:31:02] *** Joins: csrf (~csrf@user/csrf)
[15:49:53] *** Quits: havoc (~havoc@cpe-75-86-131-62.wi.res.rr.com) (Remote host closed the connection)
[17:37:59] *** Joins: havoc (~havoc@cpe-75-86-131-62.wi.res.rr.com)
[17:42:41] *** Joins: eelstrebor (~eelstrebo@198-178-29-136.scb.ne.static.allophone.net)
[17:43:33] *** Quits: eelstrebor (~eelstrebo@198-178-29-136.scb.ne.static.allophone.net) (Remote host closed the connection)
[17:48:01] *** Joins: todo75 (~todo75@user/todo75)
[18:16:26] *** Joins: zulutango (~zulutango@static-n58-105-160-58.mas4.nsw.optusnet.com.au)
[18:32:45] *** Quits: Bardon (~Bardon@user/Bardon) (Ping timeout: 256 seconds)
[18:33:37] *** Joins: Bardon (~Bardon@user/Bardon)
[18:40:12] *** Quits: todo75 (~todo75@user/todo75) (Ping timeout: 240 seconds)
[18:55:19] *** Quits: RypPn (~RypPn@user/ryppn) (Quit: Real-time updating is paused. (Resume))
[19:08:40] *** Joins: todo75 (~todo75@user/todo75)
[19:26:28] *** Joins: bn_work (uid268505@id-268505.uxbridge.irccloud.com)
[19:44:38] *** Joins: RypPn (~RypPn@user/ryppn)
[19:57:45] *** Quits: Tuvix (~Tuvix@gateway/tor-sasl/tuvix) (Remote host closed the connection)
[19:57:58] *** Joins: Tuvix (~Tuvix@gateway/tor-sasl/tuvix)
[20:02:36] <csrf> found a bullshit problem/bug 
[20:02:58] <csrf> i need to route internet traffic via a client
[20:03:41] <csrf> iow, client connects to a central server, but then internet traffic from clients on the server's lan needs to go out via a specific client
[20:03:44] <rob0> you also need policy routing for that, BTW
[20:04:55] <csrf> i.e., i need to be able to route outbound traffic over the tunnel *towards* a client, and have the client route it out via its default gateway
[20:05:01] <csrf> openvpn wont do it without iroutes
[20:05:08] <csrf> and iroute 0.0.0.0 doesn't work
[20:05:51] <csrf> i tried setting up topology p2p, since iroutes are supposedly only needed for topology subnet, but nope
[20:06:05] <csrf> point-to-point still requires iroutes, which is retarded
[20:06:38] <csrf> i should be able to shove whatever random traffic I want over a p2p tunnel, and have the other end decide what to do with it
[20:06:39] <rob0> yeah, maybe "def1" style routes would work, with policy routing
[20:07:04] <csrf> rob0, that would work if I want to route traffic out via the ovpn server's gateway, but this is reversed
[20:07:07] <rob0> the whole idea hurts my head
[20:07:16] <csrf> I need to route traffic out via a specific client
[20:09:18] <csrf> example: ovpn server 'foo' is in USA, client 'bar' is in UK, client 'bar' connects to 'foo', no problem... but now, i need clients on "foo's" LAN to be able to route their internet-bound traffic out via "bar's" internet connection
[20:09:23] <bn_work> hi, does anyone have any h/w (CPU, RAM, network bandwidth, etc.) sizing guidelines for the openvpn server to support say 40 servers traffic?  (we don't get that much traffic, our busiest internal server uses maybe 1.74Mbit/s in, and our busiest external web server:  ~5.86Mbit/s out).  Checked https://community.openvpn.net/openvpn/wiki & the FAQ but not seeing anything
[20:09:30] <csrf> I can't make 'bar' the ovpn server, for various reasons
[20:10:14] <csrf> bar must connect to foo (which is publicly accesible), and then be able to route whatever traffic hits it over the tunnel via it's own default gateway
[20:10:31] <csrf> p2p tunnel *SHOULD* do it, without being limited by iroutes
[20:11:47] <csrf> 'iroute 0.0.0.0' would technically be the way to do it with iroutes, but it's completely broken/doesn't work, and is a shitty solution in general
[20:13:17] <csrf> obviously, if 'bar' was publicly accessible, I could just turn it into an ovpn server, and have the clients connect to it, but this isn't possible for logistical reasons
[20:13:26] <rob0> bn_work: the thing about CPU is that openvpn at this time is single-threaded.  The process runs on a single CPU core.  The DCO feature is on the way (in beta now) and will fix this, on supported OS (which is Linux and Windows now.)
[20:13:56] <rob0> "40 servers traffic" is unclear.
[20:15:24] <rob0> bn_work: also clarify what it is you are hoping to do with this VPN.  Are you planning to --redirect-gateway on clients?
[20:39:44] <bn_work> rob0:  not sure what you mean by "redirect-gateway on clients"... mainly want to use it to create a split-tunnel VPN for org/corp "internal" server traffic. PS: I qualified "40 servers" with approximate peak data rates?
[20:43:46] <rob0> bn_work, I hate to suggest this, in fact I slap myself any time I do. :) But here goes anyway: I think you should look at Access Server.  It has a native (albeit kludgy) way of spreading the load among multiple CPU cores.
[20:46:16] <bn_work> rob0: so for the data rates we are currently seeing and for up to 40 servers, is a single core already too underpowered?  
[20:46:27] <bn_work> I feel like it could be
[20:46:41] <rob0> definitely could be
[20:47:05] <rob0> you could try DCO with source from git
[20:47:57] <rob0> or, figure out the AS kludge of binding a VPN process to a specific CPU core
[20:57:58] *** Quits: colo (~colo@user/colo) (Quit: Bye.)
[20:58:08] *** Quits: nerozero (~nerozero@87.253.63.54) (Ping timeout: 256 seconds)
[21:00:17] <BtbN> I've not had much success with the DCO yet
[21:00:34] <BtbN> It only works if you run openvpn as root, and even then I have clients randomly de-authing all the time
[21:01:02] *** Joins: colo (~colo@user/colo)
[21:22:25] <rob0> I'll try when I can.  Got to figure out the CAP_* stuff.
[21:26:27] <BtbN> There's nothing to figure out really
[21:26:41] <BtbN> It has to be started as root and can't setuid() itself
[21:26:54] <BtbN> or already be started as user with the required capabilities
[21:27:02] <BtbN> But that might cause other issues
[21:27:36] <BtbN> I haven't seen any discussion about the capability situtation on the dev ML yet
[21:55:16] *** Quits: winstonsmith (~winstonsm@gateway/vpn/pia/winstonsmith) (Remote host closed the connection)
[21:55:33] *** Joins: winstonsmith (~winstonsm@gateway/vpn/pia/winstonsmith)
[22:45:07] *** Quits: Haxxa (~Haxxa@202-130-210-100.ip4.superloop.com) (Quit: Haxxa flies away.)
[22:46:33] *** Joins: Haxxa (~Haxxa@202-130-210-100.ip4.superloop.com)
[22:50:44] *** Joins: Pippin_ (Pippin_@openvpn/community/Pippin)
[22:50:44] *** ChanServ sets mode: +o Pippin_
[23:04:17] *** Joins: blueskyz (~blueskyz@2a02:2f0f:6006:7600:f639:9ff:fe32:cdb2)
[23:06:34] <blueskyz> Hello! Can someone help me with a OpenVPN config to allow a client to connect to a server's LAN side? I can ping the virtual addresses of the client and the server, but somehow the server is not forwarding the packets it receives... My current configuration: https://pastebin.com/c9uEw4Ch
[23:08:42] <rob0> --remote is how you specify an address to connect to.
[23:12:35] <blueskyz> I don't know if the answer was for me, but I can connect from the client to the server (i can ping them). The problem is that I can only connect to the virtual network (fd80:caf:111::1/64) not to a real network (managed by a router, on the server side).
[23:13:25] <rob0> I suppose the issue is with routing link-local addresses ... you can't.
[23:15:47] <blueskyz> Okay... I'll try to use GUA's, but my problem is that my ISP is changing the allocated prefix each time I reconnect... that's why I tried to use link local
[23:16:20] <BtbN> fd80 ULAs should work
[23:16:40] <BtbN> but every client or the central router in the server side LAN needs to know where to reach that network
[23:16:43] <rob0> if so, then you just need the proper routes
[23:16:46] <BtbN> as in, it needs a route back
[23:17:06] <BtbN> Or the server needs to NAT anything going out from the VPN to its own local IP
[23:17:28] <blueskyz> Oh... Okay, I'll try to add a static route to see if that works
[23:24:00] <blueskyz> I added a static route for fd80:caf:111::/64 (virtual net) to  fd80:caf::5 (OpenVPN server) but I still can't ping other nodes. I'll try to use iptables on server to NAT packets
[23:28:59] *** Joins: shibboleth (~shibbolet@user/shibboleth)
[23:34:10] <blueskyz> I tried to NAT everything from tun0 to ens1 but still I get no response... I will try GUAs now :(
[23:34:42] <rob0> iptables does not handle ipv6, see ip6tables
[23:35:27] <blueskyz> yes, I mean I tried ip6tables*
[23:36:31] <rob0> check "ip6tables-save -c", was your rule matched, or counters [0:0]?
[23:37:08] *** Quits: shibboleth (~shibbolet@user/shibboleth) (Remote host closed the connection)
[23:37:47] *** Joins: shibboleth (~shibbolet@user/shibboleth)
[23:38:38] <blueskyz> Hmm... I get:  https://pastebin.com/UzkvFY4W
[23:38:51] <blueskyz> All 0:0 except: [5:416] -A POSTROUTING -o ens1 -j MASQUERADE
[23:39:40] <blueskyz> Full log: https://pastebin.com/ift8iNCy
[23:40:49] <rob0> check ipv6 forwarding
[23:41:18] <BtbN> blueskyz, adding it to the vpn server is pointless. It already knows how to route to that network
[23:41:33] <BtbN> every single machine in the server side LAN needs a route to the VPN network
[23:41:40] <blueskyz> sudo sysctl -a | grep forward ====> net.ipv4.conf.all.forwarding = 0 ; net.ipv6.conf.all.forwarding = 1 net.ipv6.conf.ens1.forwarding = 1 net.ipv6.conf.tun0.forwarding = 1
[23:43:43] <blueskyz> @BtbN: I setup a route that says: Target: virtual-network, IPv6-Gateway: openvpn-server, but still isn't working. Maybe its a problem with local link addresses after all...
[23:44:56] <BtbN> set up where?
[23:45:09] <blueskyz> In the router
[23:45:34] <BtbN> fd00::/8 is the ULA range. It's not link local
[23:45:39] <BtbN> fe00 is
[23:46:17] <blueskyz> Yes.. my bad :9
[23:49:07] <blueskyz> It's working with GUAs :((
[23:51:39] <blueskyz> Now a follow up question, in the line: server-ipv6 2000:...:/64 I have to put my real IP or can I use the 2001:DB8::/64 range? I'm asking because my ISP changes my prefix each time I reconnect...
[23:54:17] <blueskyz> Uff.. I rebooted and now it's not working anymore :O
[23:57:26] *** Quits: mannequin (uid453465@id-453465.helmsley.irccloud.com) (Quit: Connection closed for inactivity)
[23:58:17] <blueskyz> Ok.. working again I forgot to forward ipv6
