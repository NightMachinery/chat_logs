[00:36:21] <thomasjm[m]> <jneira[m]> "and the entire thing if that..." <- hmm, tried deleting everything (`~/.stack` and `.stack-work`) and no luck
[00:40:15] *** Joins: coot (~coot@213.134.190.95)
[00:41:29] *** Quits: coot (~coot@213.134.190.95) (Client Quit)
[00:42:05] *** Joins: coot (~coot@213.134.190.95)
[00:48:44] <pepeiborra> Have you tried building with cabal?
[00:49:03] <pepeiborra> If you figure out how to do a dynamic build with Cabal, please let us know to update the docs
[00:51:22] <pepeiborra> fendor: i can help with the build graph but I haven‚Äôt been following the chat, maybe you can open an issue or otherwise send me the details
[01:45:08] <jneira[m]> <pepeiborra> "If you figure out how to do a..." <- with stack i guess
[01:48:25] <pepeiborra> Yes, with Stack sorry
[01:51:40] <jneira[m]> thomasjm: i think maybe -dynamic should be applied only to haskell-language-server, could you try `stack install haskell-language-server --ghc-options="-dynamic"`
[01:53:08] <thomasjm[m]> the command i gave above has worked for a dynamic stack build until now
[01:53:34] <jneira[m]> if that doesnot work maybe add `apply-ghc-options: targets` to stack yaml
[01:54:20] <jneira[m]> hmm that is a interesting info, it worked for you and ghc-9.0.1?
[01:54:41] <thomasjm[m]> it worked with ghc-9.0.2 :) when i was using a random commit on master
[01:55:08] <thomasjm[m]> i was using the first commit to add support for 9.0.2: 3f4685141c86ea960efdd240147937c2b6f7f9e7
[01:56:17] <thomasjm[m]> maybe i'll just bisect...
[01:56:17] <thomasjm[m]> tried the `stack install haskell-language-server` version and got the same result
[01:58:03] <jneira[m]> same issue but with cabal: https://github.com/haskell/cabal/issues/6059
[02:01:17] <thomasjm[m]> oh no, the commit that used to work doesn't work now either. yuck, i wonder what i forgot to clear out
[02:20:21] *** Quits: coot (~coot@213.134.190.95) (Quit: coot)
[02:36:03] <jneira[m]> released!
[03:36:18] *** Quits: shapr (~user@pool-100-36-247-68.washdc.fios.verizon.net) (Remote host closed the connection)
[03:37:07] *** Joins: shapr (~user@pool-100-36-247-68.washdc.fios.verizon.net)
[06:29:28] *** Quits: libertyprime (~libertypr@118-92-72-229.dsl.dyn.ihug.co.nz) (Ping timeout: 250 seconds)
[06:31:11] *** Joins: libertyprime (~libertypr@118-92-72-229.dsl.dyn.ihug.co.nz)
[12:17:01] *** Quits: Lierdakil (~lierdakil@94.158.171.19) (Read error: Connection reset by peer)
[12:17:07] *** Joins: Lierdakil_ (~lierdakil@94.158.171.19)
[12:17:37] *** Lierdakil_ is now known as Lierdakil
[13:55:03] *** Joins: coot (~coot@213.134.190.95)
[14:34:17] <fendor[m]> <pepeiborra> "fendor: i can help with the..." <- I will open an issue once I have minimised the example a bit more
[14:34:18] <fendor[m]> Thanks!
[15:45:26] <jneira[m]> pepeiborra: hi! we need make definitive the new plugins in hackage, could you add the plugin authors and me to hackage maitainers? thanks, the unique author missing is drsooch but we can add it afterwards
[15:45:58] <pepeiborra> I have already added you and kobobd
[15:47:05] <pepeiborra> let me know if anything is missing
[15:47:23] <jneira[m]> üëçÔ∏è
[16:53:18] <jneira[m]> hackage release done: https://hackage.haskell.org/package/haskell-language-server-1.6.0.0
[17:49:01] <jneira[m]> there is a issue about the hls-wrapper linking: https://github.com/haskell/haskell-language-server/issues/2650
[17:49:38] <jneira[m]> it seems the hls-wrapper was fully statically linked in hls-1.5.1 and it is not in hls-1.6.0.0
[17:50:28] <jneira[m]> i've revised the github virtual envs and several config files and i dont see the difference, but executables from 1.5.1 and 1.6.0.0 have a different size
[17:50:49] <jneira[m]> pepeiborra: wz1000 maerwald ^^
[17:51:17] <jneira[m]> i see linker warnings in 1.5.1 and no one in 1.6.0.0 building hls-wrapper
[17:56:19] <pepeiborra> I took a look and this is my guess: https://github.com/haskell/haskell-language-server/pull/2615/files#r795059782
[17:57:46] *** Quits: juhp (~juhp@128.106.188.82) (Ping timeout: 256 seconds)
[18:09:03] <maerwald> should probably `set -u` for all bash steps
[18:19:37] *** Joins: emad (~emad@156.214.92.21)
[18:23:01] <jneira[m]> pepeiborra: hmm i dont see what change there could make ignore the `--enable-executable-static` the build effectively passed to cabal, have you some more suspection about some concrete change?
[18:24:06] <jneira[m]> s/more//
[18:24:47] <jneira[m]> in 1.5.1 there were linker warnings and in 1.6.0.0 there were not
[18:25:54] <jneira[m]> the weird think is the hls executable in the same build is fine
[18:25:55] <jneira[m]> s/think/thing/
[18:56:23] <pepeiborra> jneira[m]: where is `--enable-executable-static` being passed to cabal?
[19:06:45] *** Quits: coot (~coot@213.134.190.95) (Quit: coot)
[19:28:57] <jneira[m]> just see your comment and the reason to set -u
[20:32:54] <sm> g'day all.. do I remember rightly there's a key that will rename a function and all its uses ? (refactor: rename) ?
[20:33:18] <sm> (in vs code + Haskell + hls)
[20:53:24] <sm> hls 1.6 downloaded with ghcup doesn't support TH ? This is different from hls 1.5, isn't it ?
[20:57:10] <maerwald> sm: 1.6 is busted, but not sure that's the reason
[20:57:23] <maerwald> sm: try `ghcup compile hls -v 1.6.0.0 -j10 --ghc 8.10.7 -- --ghc-options='-dynamic'`
[20:58:48] <sm> oh goody, 1.6 is busted.. how so ?
[20:59:06] <maerwald> https://github.com/haskell/haskell-language-server/issues/2650
[20:59:16] <maerwald> for mac, shouldn't matter
[20:59:16] <sm> thanks. My project is on 9.0.2 so I'll give that a shot
[21:00:24] <maerwald> you can specify --ghc multiple times
[21:00:48] <sm> nice
[21:00:49] <michaelpj[m]> sm: https://haskell-language-server.readthedocs.io/en/latest/features.html ctrl-f "renaming"
[21:01:25] <sm> ah, thanks michaelpj 
[21:10:06] <sm> maerwald: just FYI, that fails with the strangely wide error message https://termbin.com/jvgtn, and I wasn't sure where to look next
[21:10:40] <maerwald> what did you type in
[21:11:21] <sm> the command you gave above, and also the same with --ghc 9.0.2 - both fail
[21:11:26] <maerwald> ah, you need a different project file
[21:11:28] <maerwald> sec
[21:12:37] <maerwald> sm: ghcup compile hls -v 1.6.0.0 -j10 --cabal-project cabal-ghc90.project --ghc 8.10.7 -- --ghc-options='-dynamic
[21:12:38] *** Joins: portal_narlish (~portal_na@cpe-72-134-245-253.natsow.res.rr.com)
[21:12:49] <maerwald> oops
[21:12:51] <maerwald> --ghc 9.0.2
[21:13:08] <maerwald> cabal.project file is different for 9.0.x
[21:14:04] <sm> not quite yet: https://termbin.com/5nz2
[21:15:02] <maerwald> that works here
[21:15:23] <maerwald> your longopts isn't interpreted correctly
[21:16:02] <maerwald> also, what do the logs say
[21:16:32] <sm> -- usually works here. I wasn't sure where to find the logs, from the error message
[21:16:32] <jneira[m]> and what about `--enable-executable-dynamic` instead `--ghc-options='-dynamic`
[21:16:46] <sm> (where are they ?)
[21:16:48] <maerwald> that is broken for v2-install afair
[21:16:58] <maerwald> sm: ~/.ghcup/logs
[21:17:33] <sm> thanks
[21:17:34] <sm> https://termbin.com/ub6t
[21:17:40] <portal_narlish> does anyone have a working hls + native neovim LSP setup i can take notes from?
[21:17:57] <maerwald> sm: cabal update?
[21:18:09] <sm> I have done that every time
[21:18:15] <maerwald> Warning: The package list for 'hackage.haskell.org' is 43 days old.
[21:18:19] <maerwald> I don't believe you
[21:18:31] <sm> strange
[21:20:28] <sm> you're right! I have been retrying the stack method, but only tried the cabal method after ghcup. Thanks. You should mention `cabal update && ` like https://haskell-language-server.readthedocs.io/en/latest/troubleshooting.html#static-binaries does
[21:22:32] <jneira[m]> ugh we had to add `cabal update &&` to every mention to cabal invocations ;-)
[21:22:48] <sm> yup, it has always been thus
[21:23:31] <jneira[m]> hey mates, could you review https://github.com/haskell/haskell-language-server/pull/2647?
[21:23:54] <jneira[m]> it includes the preparation for the bug fix release
[21:24:01] <jneira[m]> so i would like to merge asap
[21:24:50] <maerwald> what did it even break?
[21:25:43] <sm> jneira, now I have some feedback on the cabal command on that page:
[21:25:43] <sm> I had to add exe: before haskell-language-server. 
[21:25:44] <sm> I added -w ghc-9.0.2 to suit the project where I'll be using hls, maybe the page should mention that.
[21:25:44] <sm> It fails with https://termbin.com/63e4
[21:28:50] *** Joins: coot (~coot@213.134.190.95)
[21:29:03] <jneira[m]> maerwald: https://github.com/haskell/haskell-language-server/issues/2650
[21:29:21] <sm> and on the stack yamls:
[21:29:21] <sm> https://termbin.com/7duc or similar is needed in stack-9*.yaml to make them work on mac m1 (not sure about -9.0.1)
[21:30:57] <maerwald> jneira[m]: other than the nixos issue, I see only people not having installed libtinfo5
[21:32:04] <sm> summary: stack, cabal and ghcup build methods failed. I knew how to fix the stack issue, so your multiple stack yamls saved my butt. I got ghcup working because maerwald was here.
[21:32:11] <maerwald> jneira[m]: so what's the pressure?
[21:35:02] <sm> (and the https://haskell-language-server.readthedocs.io/en/latest/troubleshooting.html#static-binaries cabal command needs to use a cabal project like maerwald's, to be robust)
[21:39:26] <maerwald> jneira[m]: I'd much rather postpone the re-release and provide proper dynamic release like GHC bindists do
[21:40:09] <maerwald> I can add the install instructions for libtinfo5 to the ghcup post-install message
[21:40:47] <jneira[m]> and automatic download of the vscode extension?
[21:41:26] <maerwald> I dunno, I just think this doesn't render the release "broken"
[21:41:45] <maerwald> 1. it works on windows and mac, 2. it works on all major distros if libtinfo5 compat libs are installed
[21:41:48] <jneira[m]> <sm> "(and the https://haskell-..." <- thanks, i am just changing those instructions
[21:42:47] <jneira[m]> so it wont work without installing them (which is not by defaul afaiu) :-( 
[21:43:20] <jneira[m]> if i update the hls-wrapper in 1.6.0.0 and the checksum anyone will notice? :-P
[21:44:03] <jneira[m]> ghcup will not as it is not using it 
[21:47:03] <jneira[m]> in fact the hls-wrapper used in ghcup should be good
[21:47:34] <jneira[m]> ah no, only the for the extra systems, we are using the github one for generic linux
[21:48:32] <sm> stack build method: hiedb fails to build with "mismatched interface file", alas: https://termbin.com/0xwa
[21:49:36] <sm> ghcup build method: also needed the ghc 9.x/mac m1 ffi workaround: ... --ghc-options='-dynamic -I/Library/Developer/CommandLineTools/SDKs/MacOSX12.1.sdk/usr/include/ffi'
[21:49:39] <jneira[m]> > <@simonmic:matrix.org> jneira, now I have some feedback on the cabal command on that page:... (full message at https://libera.ems.host/_matrix/media/r0/download/libera.chat/abbec2c9a918ebb92ffed1f24cf4edbf4dc5848a)
[21:53:59] <sm> ghcup build method: actually that -I wasn't enough, maybe cabal's --extra-include-dirs would do it
[22:00:17] <jneira[m]> -I?
[22:01:48] <sm> as in my previous comment jneira.. trying to get ghc to see a needed include file on m1
[22:02:21] *** Quits: portal_narlish (~portal_na@cpe-72-134-245-253.natsow.res.rr.com) (Quit: Client closed)
[22:02:28] <sm> I didn't figure out how to pass it using ghcup, but it's working with cabal:
[22:02:28] <sm> cabal update && cabal install pkg:haskell-language-server --enable-executable-dynamic -w ghc-9.0.2 --project-file cabal-ghc90.project --ghc-options='-I/Library/Developer/CommandLineTools/SDKs/MacOSX12.1.sdk/usr/include/ffi'
[22:04:23] <sm> bah, once again right as I say that it fails
[22:05:27] <jneira[m]> jumm too specific to add it to docs? maybe it should be a separate issue in hls
[22:06:44] <sm> here's the GHC issue if you want to link something: https://gitlab.haskell.org/ghc/ghc/-/issues/20592
[22:07:33] <sm> well, I have failed with -I and with --extra-include-dirs.. I only know how to apply that workaround with stack
[22:09:06] <jneira[m]> @sm  i've rewrite the instructions, wdty about https://github.com/haskell/haskell-language-server/blob/c4fa8e83e2310b9b44b7c7330c89ea9a47e8dea6/docs/troubleshooting.md#static-binaries-and-template-haskell-support
[22:11:03] <jneira[m]> oh reading the ghc issue it seems the workaround works for stack
[22:11:27] <sm> jneira: in the first cabal command, don't you need to add a cabal.project file to make it reliable
[22:12:02] <sm> and it would need to be the one corresponding to the ghc in path (or, specify that with -w)
[22:12:10] <sm> in the second cabal command, don't you need the -w ghc 9.0.2 as well ?
[22:12:33] <jneira[m]> if you dont set any --project-file cabal uses `cabal.project` by default
[22:13:04] <jneira[m]> and some day 9.0 will not need an special cabal.ghc90.project
[22:13:05] <sm> really ? well, the cabal build failed for me, as pasted above
[22:13:11] <jneira[m]> in fact it will soon i hope
[22:13:27] <sm> maybe an issue in the cabal.project file, then
[22:13:30] <jneira[m]> cabal.project works for ghc < 9.0
[22:14:04] <jneira[m]> so i writed: "If you are compiling with a ghc version with a specific cabal-ghc${ghcVersion}.project in the repo you will have to use it with. For example for ghc-9.0.x:"
[22:14:24] <jneira[m]> :-D 
[22:14:25] <jneira[m]> ops a typo
[22:14:29] <Guillaum[m]> jneira: I do have a WIP MR which automatically patch `cabal` so it uses the correct project file (if you are in a nix-shell) ;)
[22:15:03] <jneira[m]> cabal will have conditions in cabal.project "soon"
[22:15:12] <jneira[m]> and all those tweaks will be not necessary but still..
[22:15:17] <Guillaum[m]> jneira: haaa, that's a great news.
[22:16:03] <jneira[m]> and imports!
[22:16:04] <jneira[m]> https://github.com/haskell/cabal/pull/7783
[22:16:09] <Guillaum[m]> That's kinda awesome.
[22:16:27] <jneira[m]> it will open the way to use stackage in cabal
[22:16:46] <sm> jneira: I've maxed out on testing/issues/docs/time for now, sorry. I haven't managed to build a dynamic hls by any method. Fortunately hls 1.5 is still working well for me. I'm just wondering, what changed with 1.6 ? I don't remember having any warning about TH with 1.5 
[22:17:03] <jneira[m]> ainns
[22:17:34] <jneira[m]> i knew somthing like this would happen :-P
[22:18:14] <jneira[m]> @sm if th worked for you in the past it should continue working
[22:18:17] <sm> I don't even know what TH working looks like :)
[22:18:23] <jneira[m]> ah ok
[22:18:30] <sm> HLS not warning me about it at startup, I guess
[22:18:43] <jneira[m]> so the warning worked :-)
[22:19:02] <jneira[m]> but the workaround should .. well, work
[22:19:03] <jneira[m]> as well
[22:19:04] <sm> the warning alarmed me and I don't know if it's a reason I should stick with 1.5
[22:19:18] <jneira[m]> i dont think so
[22:19:32] <jneira[m]> 1.6.0 works like 1.5.0 for th
[22:19:41] <jneira[m]> i.e. nor reliably
[22:19:49] <jneira[m]>  * i.e. not reliably
[22:20:02] <jneira[m]> we only added the warning
[22:20:06] <sm> I see. That's what I was wondering
[22:20:27] <jneira[m]> we were recommending it in docs since some time ago
[22:20:38] <sm> 1.5 hours ago. Oh well I hope the build command testing has some value. Thanks :)
[22:20:50] <jneira[m]> sure
[22:21:13] <jneira[m]> hard days for haskeller on mac lately
[22:21:39] <jneira[m]> we are more peaceful in windows :-P 
[22:21:49] <sm> s/on mac lately/
[22:22:02] <sm> /
[22:22:14] <jneira[m]> windows works quite well
[22:22:18] <jneira[m]> no problems with th
[22:22:27] <sm> nice to hear :)
[22:22:30] <jneira[m]> maybe you should consider switch to windows MUHAHAHA
[22:28:01] <jneira[m]> the install script could work to help in the th workaround 
[22:28:28] <jneira[m]> stack ./install.hs hls-9.0.1 --dynamic
[22:28:47] <jneira[m]> but we are about to remove it.. ainss
[22:29:50] <sm> I read the warning as "there's a problem! you must build a dynamic hls now" rather than "such and such TH thing won't work, if you need that build a dynamic hls"
[22:36:40] <jneira[m]> the warning onlyis emitted if your project has th
[22:37:10] <jneira[m]> (iirc)
[22:38:44] <jneira[m]> `This HLS binary does not support Template Haskell.` :-) 
[22:47:30] *** Quits: coot (~coot@213.134.190.95) (Ping timeout: 250 seconds)
[23:17:02] *** Joins: coot (~coot@213.134.190.95)
[23:48:45] *** Quits: coot (~coot@213.134.190.95) (Quit: coot)
