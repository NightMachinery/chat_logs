[00:00:10] <JEEB> if it's got NAL HRD message stuck into it, that should have the parameters
[00:00:56] <aphysically> this isn't a very serious problem to solve (it doesn't block me or anyone that uses my toy streaming wrapper from doing anything, afaik), but sorta interesting I guess
[00:00:57] <JEEB> alternatively, if you're guesstimating the bufsize then calculated maxrate would anyways fluctuate depending on that decision
[00:01:20] <JEEB> since a larger bufsize gives you more leeway to stay within a certain bit budget
[00:03:15] *** Joins: durandal_1707 (~computer@95.168.116.134)
[00:15:57] <emcodem> @aphysically what keeps you from just getting pkt_size sum over a certain timeframe as suggested yesterday?
[00:16:20] <aphysically> nothing, just exploring different options at the same time
[00:18:14] <emcodem> i guess there will be nothing easier than that :p
[00:19:33] <emcodem> well, if you can also change the encoding process, you could kind of dump the encoded pkt size so you don't need to analyze later
[00:24:07] <emcodem> like a passlog file hehe
[00:29:05] *** Quits: Blacker47 (~Blacker47@user/blacker47) (Quit: Life is short. Get a V.90 modem fast!)
[00:34:19] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Ping timeout: 250 seconds)
[00:41:39] *** Quits: Volgaar (~volgaar@193.137.116.78.rev.sfr.net) (Quit: WeeChat 3.3)
[00:54:04] *** Joins: rya (~ry@47.23.188.138)
[00:54:04] *** Quits: rya (~ry@47.23.188.138) (Changing host)
[00:54:04] *** Joins: rya (~ry@user/rya)
[01:03:41] *** Quits: aphysically (~aphysical@user/aphysically) (Quit: aphysically)
[01:11:00] *** Joins: lavaball (felix@31.204.155.215)
[01:13:25] *** Quits: cosimone (~user@93-47-231-203.ip115.fastwebnet.it) (Quit: ERC (IRC client for Emacs 27.1))
[01:25:13] *** Joins: aphysically (~aphysical@user/aphysically)
[01:40:41] *** Quits: dreamon (~dreamon@pd9503f67.dip0.t-ipconnect.de) (Ping timeout: 256 seconds)
[01:47:04] *** Joins: AbleBacon (~AbleBacon@user/AbleBacon)
[01:47:36] *** Joins: jerome-- (~jerome@88.173.24.196)
[01:48:58] *** Quits: jerome- (~jerome@88.173.24.196) (Ping timeout: 260 seconds)
[01:53:22] *** Quits: jerome-- (~jerome@88.173.24.196) (Quit: -)
[01:53:39] *** Joins: jerome- (~jerome@88.173.24.196)
[02:05:03] *** Quits: Buster_ (~Buster@buster-net.ru) (Ping timeout: 256 seconds)
[02:18:36] *** Joins: Buster_ (~Buster@buster-net.ru)
[02:35:02] *** Quits: Buster_ (~Buster@buster-net.ru) ()
[02:47:17] *** Quits: troyt (troyt@2601:681:4100:d591:44dd:acff:fe85:9c8e) (Ping timeout: 252 seconds)
[02:50:47] *** Joins: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua)
[02:51:06] *** Quits: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua) (Client Quit)
[02:51:59] *** Joins: troyt (troyt@2601:681:4100:d591:44dd:acff:fe85:9c8e)
[02:54:03] *** Quits: djk (~Thunderbi@pool-96-242-218-239.nwrknj.fios.verizon.net) (Quit: djk)
[03:06:32] *** Quits: palasso (~palasso@user/palasso) (Remote host closed the connection)
[03:16:11] *** Quits: Jerrrk (~Jerrk@193.138.218.211) (Remote host closed the connection)
[03:51:05] *** Quits: durandal_1707 (~computer@95.168.116.134) (Read error: Connection reset by peer)
[04:06:29] *** Joins: nillyhan7 (~c0a80070@user/nillyhan)
[04:07:27] *** Quits: nillyhan (~c0a80070@user/nillyhan) (Ping timeout: 256 seconds)
[04:07:27] *** nillyhan7 is now known as nillyhan
[04:10:49] *** Quits: lavaball (felix@31.204.155.215) (Remote host closed the connection)
[04:10:53] *** Quits: waleee (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4) (Ping timeout: 252 seconds)
[04:11:46] *** Joins: Jerrk (~Jerrk@193.138.218.216)
[04:14:10] *** Quits: iive (~iive@87.119.101.204.client.entry.bg) (Quit: They came for me...)
[04:23:26] *** Quits: lucaswang (~lucaswang@58.246.19.98) (Quit: Ping timeout (120 seconds))
[04:31:27] *** Quits: Seirdy (~Seirdy@sourcehut/user/seirdy) (Quit: exiting 3.3)
[04:31:56] *** Joins: Seirdy (~Seirdy@sourcehut/user/seirdy)
[05:31:33] *** Joins: Guest48 (~Guest48@192.102.204.55)
[05:37:01] *** Joins: hawkotd (~mhawk@host-82-55-20-130.retail.telecomitalia.it)
[05:37:02] <hawkotd> it
[05:37:30] *** Quits: hawkotd (~mhawk@host-82-55-20-130.retail.telecomitalia.it) (Client Quit)
[05:38:09] *** Quits: NovelHawk (~mhawk@host-95-244-41-223.retail.telecomitalia.it) (Ping timeout: 252 seconds)
[05:44:49] *** Quits: Guest48 (~Guest48@192.102.204.55) (Ping timeout: 256 seconds)
[05:47:53] *** Joins: Guest48 (~Guest48@192.102.204.55)
[05:53:25] *** Joins: stevenliu (~stevenliu@ffmpeg/developer/stevenliu)
[05:54:35] *** Joins: Guest64873 (~bot@172-220-180-248.res.spectrum.com)
[05:54:37] *** Quits: Guest64873 (~bot@172-220-180-248.res.spectrum.com) (Read error: Connection reset by peer)
[06:22:53] *** Quits: keypusher (keypusher@user/keypusher) (Ping timeout: 256 seconds)
[06:24:15] *** Joins: scoobydoob (~scooby@user/scoobydoo)
[06:26:38] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Ping timeout: 260 seconds)
[06:26:46] *** scoobydoob is now known as scoobydoo
[06:28:03] *** Joins: a0z (~a0z@90.244.184.28)
[06:37:13] *** Joins: Mebilus (~Mebilus@85.187.219.207)
[06:37:14] <Mebilus> hi
[06:37:38] <Mebilus> I just asked a question in ##ffmpeg on  Freenode !
[06:37:50] <Mebilus> then I realized I should have come here, to "irc.libera.chat"!
[06:37:54] <Mebilus> what shall I do?
[06:38:01] <Mebilus> ask again, or paste it to a paste service?
[06:40:02] *** Quits: xkuru (~xkuru@user/xkuru) (Read error: Connection reset by peer)
[06:41:28] <jarthur> Mebilus either is fine
[06:42:22] <Mebilus> In this case, I ask again:
[06:42:35] <Mebilus> ffmpeg -loop 1 -i pic.jpg -t 15 -q:a 1 -c:v libx264 -crf 18 -bf 2 -c:a aac -ar 48000 -vf yadif,format=yuv420p -force_key_frames "expr:gte(t,n_forced*1)" -coder 1 -b:v 10M out_silent.mp4
[06:42:43] <Mebilus> ^ this is how I create a short 15 seconds demo video
[06:42:51] <Mebilus> --
[06:43:06] <Mebilus> sox -n -n sound.wav --combine merge synth '00:01:00' whitenoise
[06:43:17] <Mebilus> ^ some demo-sound  (just random white noise) for testing purposes
[06:43:19] <Mebilus> --
[06:43:50] <Mebilus> combine it all:
[06:43:51] <Mebilus> ffmpeg -i out_silent.mp4 -i sound.wav -c copy -map 0:v:0 -map 1:a:0 -shortest final.mp4
[06:43:52] <Mebilus> --
[06:44:00] <Mebilus> run it:
[06:44:02] <Mebilus> mpv final.mp4
[06:44:14] <Mebilus> --
[06:44:17] <Mebilus> Error messages:
[06:44:19] <Mebilus> >> VO does not support requested hardware decoder, or loading it failed.
[06:44:25] <Mebilus> >> Failed to initialize an audio decoder for codec ''
[06:44:28] <Mebilus> --
[06:44:33] <Mebilus> same problem with "vlc"
[06:44:37] <Mebilus> only kaffeine plays it well
[06:45:46] <furq> that last ffmpeg line should have thrown an error
[06:46:02] <furq> you can't mux pcm into mp4 and at least the ffmpeg i have won't let you
[06:46:05] <Mebilus> nope, it did not.
[06:46:18] <jarthur> Mebilus what version of ffmpeg?
[06:46:46] <Mebilus> ffmpeg version 3.4.8-0ubuntu0.2 Copyright (c) 2000-2020 the FFmpeg developers
[06:46:59] <furq> i don't think that check is new but also you should really update that
[06:47:24] <furq> in any case use -c:v copy -c:a aac
[06:48:05] <furq> also i don't think yadif is going to do anything useful if your input is a looped jpeg
[06:48:15] <Mebilus> thank you!  - one moment please, I am just updating ffmpeg
[06:49:34] <Mebilus> >> ffmpeg 4.3.1 from Snapcrafters installed
[06:49:47] <Mebilus> now re-running the command - brb
[06:51:41] <Mebilus> I have a problem on my system....
[06:51:48] <Mebilus> bash: /usr/bin/ffmpeg: No such file or directory
[06:52:00] <Mebilus> deleting ffmpeg and re-installing it as "snap" caused issues
[06:52:24] <Mebilus> nevermind, opening a new terminal solved it
[06:52:25] <Mebilus> sorry
[06:54:55] <Mebilus> wooooow it worked!!!
[06:55:01] <Mebilus> THANK YOU furq and jarthur !
[06:55:04] <Mebilus> thank you so much!
[06:55:08] <Mebilus> it makes "ssshshhhhshshhsh" :)
[06:55:10] <Mebilus> it works
[06:55:14] <Mebilus> thank you!
[06:55:23] <jarthur> haha, good deal :)
[06:55:30] <Mebilus> sorry for bothering you guys
[06:55:37] <Mebilus> I have tried my very best to find a solution myself
[06:55:43] <jarthur> it's no prob, it's nice when there's a simple explanation
[06:55:47] <Mebilus> it has taken me roughly 5 hours of research before coming here
[06:56:02] <Mebilus> can I please ask 2 more tiny little things?
[06:56:20] <Mebilus> is this correct?
[06:56:21] <Mebilus> -vf yadif,format=yuv420p
[06:56:31] <another|> define "correct"
[06:56:42] *** Quits: jos1 (~jos3@dyndsl-178-142-070-155.ewe-ip-backbone.de) (Ping timeout: 268 seconds)
[06:56:55] <Mebilus> nothing in the man page hinted this were a thing,  but I have found it many times on the internet @ another|
[06:57:05] <furq> yadif is a deinterlacer
[06:57:06] <Mebilus> the man page seems to prefer    -pix_fmt yuv420p
[06:57:08] <furq> you don't have interlaced video
[06:57:23] <Mebilus> what would an interlaced video be?
[06:57:26] <furq> -pix_fmt yuv420p or -vf format=yuv420p
[06:57:41] <furq> https://en.wikipedia.org/wiki/Interlaced_video
[06:57:43] <Mebilus> a friend of mine recorded a song she wants to upload to youtube
[06:57:56] <Mebilus> so she asked me to put together a video with a picture of her singing
[06:58:03] <Mebilus> but I am a programmer, not a youtube-guy
[06:58:48] <Mebilus> furq, so  "-vf yadif,format=yuv420p "  is wrong?
[06:59:01] <furq> unless your source is interlaced
[06:59:16] <Mebilus> let me read that wikipedia article you kindly linked - brb
[06:59:19] <another|> https://trac.ffmpeg.org/wiki/Encode/YouTube#BasicExamples
[06:59:41] <furq> if the source is actually a looped jpeg then it can't be interlaced
[06:59:58] <Mebilus> oh, that's like how television was in the 80ies??  #interlaced
[07:00:13] <jarthur> Sadly, it didn't end in the 80s :P
[07:00:19] <furq> yeah 1080i still exists
[07:00:29] <another|> interlacing should die
[07:00:36] <furq> it should have ended when pal and ntsc did
[07:00:45] <Mebilus> what about modern cameras,  like digital cameras or gopro cameras?
[07:00:47] <Mebilus> are they interlaced?
[07:00:50] <furq> they can be
[07:00:53] <Mebilus> thank you another| for the link
[07:00:58] <furq> like i said you can still shoot 1080i
[07:00:59] <another|> third example
[07:01:27] <jarthur> An interlaced video would be where every other line in a picture corresponds to the same time frame (and the other lines a different timeframe). Broadcast TV and DVD used it to fit 60 moments per second into 30 pictures per second video (or 50 moments per second into 25 fps video). Deinterlacers like yadif can be used to reduce the apparent combing effect when playing those videos on a slower display (or even
[07:01:27] <jarthur>  on a faster display because people still notice it).
[07:01:36] <furq> i have a function here that does exactly this i should just paste it
[07:01:42] <Mebilus> I feel like my command is bloating things up..   it is just a single picture.   Can't this be done easier?
[07:01:53] <another|> interlacing was a hack to make analog TVs work. It should no longer be used in a digital age
[07:01:59] <Mebilus> At the moment, the same picture gets written thousands of times (24 fps)
[07:02:10] <Mebilus> can't I just save the picture once and say "keep displaying it" ?
[07:02:41] <furq> you can but it'll break seeking
[07:03:12] <another|> Mebilus: see third example on the link
[07:03:14] <furq> the seek index of mkv/mp4 etc is based on the video, not the audio
[07:03:33] <Mebilus> another|:  I looked at the 3rd example.  What exactly does it do better than my current command?
[07:03:34] <furq> -framerate 2 will mess up seeking on youtube iirc
[07:03:36] <furq> or at least it used to
[07:03:45] <furq> it's been years since i did this though
[07:03:52] <another|> furq: since YT is reencoding it I expect they're gonna fix framerate
[07:03:55] <furq> thanks jvc for the copyright strikes
[07:04:03] <Mebilus> may I please show you all the final commands?
[07:04:09] <Mebilus> I will use a paste service - brb
[07:04:11] <furq> https://clbin.com/wKpdi
[07:04:13] <furq> that's what i use anyway
[07:04:50] <furq> you don't really save much by only encoding at 2fps or whatever since it's all the same frama
[07:04:53] <furq> frame
[07:07:30] <furq> also you shouldn't encode the audio before sending it to youtube since they'll do that anyway
[07:07:39] <furq> send them flac or wav in mkv if possible
[07:08:09] <another|> furq: wouldn't it be better to scale before subsampling?
[07:08:24] <Mebilus> https://dpaste.org/46Sa
[07:08:25] <Mebilus> ^ final
[07:08:28] <Mebilus> is that okay?
[07:08:42] <Mebilus> it is still not the music,  it is still the sample sound  (noise)
[07:08:45] <furq> most of that is redundant
[07:09:00] <furq> and you don't need to run ffmpeg twice
[07:09:00] <Mebilus> Please kindly elaborate
[07:09:07] <furq> look at the function i pasted
[07:09:22] <Mebilus> I could run sox first, and then all in one go, right?
[07:09:22] <furq> or the examples on the wiki
[07:09:39] <furq> yeah although you could generate the sample sound with ffmpeg as well
[07:09:46] <furq> that's not really relevant to what you ultimately wnat though
[07:09:56] *** Joins: jos1 (~jos3@host-091-097-188-114.ewe-ip-backbone.de)
[07:10:02] <Mebilus> I tried that sample sound,  but I failed - it was never stereo
[07:10:09] <Mebilus> -f lavfi -i 'anoisesrc=d=15:c=brown:r=44800:a=1.0' \
[07:10:18] <furq> -f lavfi -i anoisesrc=d=15,aresample=ocl=stereo
[07:10:53] <another|> way too complicated and error prone. furq's looks okay
[07:12:02] <Mebilus> I just realized,  I could actually use that for my office... to get rid of background noises of talking people.
[07:12:16] <Mebilus> what started as a sample-sound could actually be cool for real life :)
[07:12:41] <Mebilus> how can I tell ffmpeg to give out the best possible audio quality for the noise,  and have a different noise left and right ?
[07:13:10] <another|> lul. "best quality noise"
[07:13:28] <Mebilus> 380k  noise?  :)
[07:13:49] <Mebilus> they keep talking and talking at the office,  without respect for thinking programmers...
[07:14:09] <furq> i was going to go through the command line by line but like 75% of it is useless in this application or does nothing at all
[07:14:22] <furq> so basically like every other ffmpeg command you find online
[07:14:42] <another|> Mebilus: noise canceling headphones?
[07:15:10] <Mebilus> another|, do they work without sound playing inside?
[07:15:19] <Mebilus> another|, can they cancel sound without playing sound?
[07:15:25] <another|> wyes
[07:15:34] <Mebilus> definitely going to look into that
[07:15:35] <Mebilus> thank yoU!
[07:15:49] <another|> I tried a friend's once and it was amazing
[07:15:55] <furq> -f lavfi -i anoisesrc:c=brown:r=48000 -f lavfi -i anoisesrc=c=white:r=48000 -af join=channel_layout=stereo -f wav - | mpv -
[07:15:59] <another|> his lips moved but i heard nothing
[07:16:21] <Mebilus> another|, that must be brutally fast,  imagine,  how fast sound it!   To counteract that,  these noise cancellation devices must have a really fast processor
[07:16:41] <Mebilus> another|, did they hurt on your ears after a while?
[07:16:53] <another|> only tried them for a minute
[07:17:27] <Mebilus> Thank you very, very much,  furq
[07:17:35] <Mebilus> furq, now testing
[07:17:36] <Mebilus> brb
[07:18:33] <Mebilus> furq, multiple errors
[07:18:39] <Mebilus> furq, even after changing  anoisesrc:c=brown:r=48000  to anoisesrc=c=brown:r=48000
[07:19:20] <furq> oh yeah that's what i meant
[07:19:49] <Mebilus> furq, https://dpaste.org/dw0W
[07:20:05] <furq> -lavfi join=channel_layout=stereo
[07:20:16] <furq> instead of -af
[07:20:31] <Mebilus> thank you, brb
[07:21:40] <Mebilus> [lavfi @ 0x56135f6a0ac0] No such filter: 'anoisesrc:c'
[07:21:40] <Mebilus> anoisesrc:c=brown:r=48000: Invalid argument
[07:22:04] <furq> you caught that one already
[07:22:34] <Mebilus> sorry my fault
[07:23:02] *** Quits: nillyhan (~c0a80070@user/nillyhan) (Ping timeout: 240 seconds)
[07:23:59] <Mebilus> works like a charm
[07:24:11] <Mebilus> now I can send the music video to my friend,  and also have silence at my office :)
[07:24:23] <Mebilus> thank you guys, you were so helpful and nice to me!
[07:24:24] <Mebilus> thank you
[07:25:41] <Mebilus> one problem remains....  ffmpeg does not count the frames correctly,  sometimes
[07:25:47] <Mebilus> not always... but sometimes
[07:25:57] *** Quits: Guest48 (~Guest48@192.102.204.55) (Quit: Client closed)
[07:26:02] <Mebilus> a 15 seconds long sample clip with 24 fps  should have 360 frames, right?
[07:26:12] <Mebilus> often I get many more
[07:26:54] <Mebilus> frame=  375 fps=294 q=-1.0 Lsize=    5722kB time=00:00:14.91 bitrate=3143.4kbits/s speed=11.7x
[07:27:31] <another|> standard framerate in ffmpeg is 25
[07:28:24] <Mebilus> oh, my bad
[07:28:34] <Mebilus> I think that's a Europe - U.S. thingy
[07:28:42] <Mebilus> I believe it's 25 in the US and 24 in Europe
[07:28:58] <furq> pal is 25, ntsc is 30
[07:29:04] <furq> 24 is for films
[07:30:06] <another|> again: the default _in ffmpeg_ is 25
[07:30:18] <another|> unless otherwise specified
[07:31:36] <Mebilus> Thank you!
[07:31:50] <Mebilus> I am way, way, way beyond my bedtime now.
[07:31:55] <Mebilus> have a great day / evening
[07:32:00] <jarthur> You too
[07:32:02] <Mebilus> see you guys again, hopefully
[07:32:10] <Mebilus> I wish you all the best, and thank you from the bottom of my heart
[07:32:18] <Mebilus> and thank you to all developers who put in the hard work
[07:32:31] <Mebilus> bye bye!
[07:32:33] *** Quits: Mebilus (~Mebilus@85.187.219.207) (Quit: Leaving)
[07:34:30] *** Joins: Guest48 (~Guest48@192.55.46.56)
[07:48:25] *** Quits: stevenliu (~stevenliu@ffmpeg/developer/stevenliu) (Read error: Connection reset by peer)
[07:48:52] *** Joins: stevenliu (~stevenliu@ffmpeg/developer/stevenliu)
[07:55:01] *** Quits: Kei_N (~Kei_N@user/kei-n/x-2886111) (Read error: Connection reset by peer)
[07:58:11] *** Joins: guest (~guest@161.117.202.209)
[07:58:22] *** Joins: guest82 (~guest@222.128.6.148)
[08:01:58] *** Quits: fkaa (~fkaa@81-226-20-99-no256.tbcn.telia.com) (Remote host closed the connection)
[08:02:25] *** Quits: darkstarx (~darkstard@50.39.115.145) (Read error: Connection reset by peer)
[08:02:32] *** Quits: guest (~guest@161.117.202.209) (Ping timeout: 240 seconds)
[08:03:14] *** Quits: guest82 (~guest@222.128.6.148) (Client Quit)
[08:07:18] *** Joins: darkstardevx (~darkstard@50.39.115.145)
[08:08:29] *** Joins: scoobydoob (~scooby@user/scoobydoo)
[08:08:33] *** Quits: darkstardevx (~darkstard@50.39.115.145) (Remote host closed the connection)
[08:08:51] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Ping timeout: 252 seconds)
[08:08:58] *** scoobydoob is now known as scoobydoo
[08:08:59] *** Joins: darkstardevx (~darkstard@50.39.115.145)
[08:13:22] *** Quits: darkstardevx (~darkstard@50.39.115.145) (Read error: Connection reset by peer)
[08:26:27] *** Quits: demon__ (~user@197.54.50.188) (Ping timeout: 252 seconds)
[08:33:59] *** Joins: someuser (~user@197.54.43.98)
[08:51:49] *** Quits: Guest48 (~Guest48@192.55.46.56) (Ping timeout: 256 seconds)
[08:52:46] *** Joins: darkstardevx (~darkstard@50.39.115.145)
[08:53:36] *** Quits: darkstardevx (~darkstard@50.39.115.145) (Remote host closed the connection)
[08:54:03] *** Joins: darkstardevx (~darkstard@50.39.115.145)
[09:02:53] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Read error: Connection timed out)
[09:03:16] *** Quits: darkstardevx (~darkstard@50.39.115.145) (Remote host closed the connection)
[09:04:23] *** Joins: scoobydoo (~scooby@user/scoobydoo)
[09:16:10] *** Joins: Kei_N (~Kei_N@user/kei-n/x-2886111)
[09:19:55] *** Joins: anotheruser (~user@197.54.43.83)
[09:21:23] *** Quits: someuser (~user@197.54.43.98) (Ping timeout: 256 seconds)
[09:22:19] *** Quits: AbleBacon (~AbleBacon@user/AbleBacon) (Read error: Connection reset by peer)
[09:22:40] *** Joins: ossifrage_ (~ossifrage@pool-72-78-189-30.phlapa.fios.verizon.net)
[09:22:48] *** Quits: ossifrage (~ossifrage@pool-72-78-189-30.phlapa.fios.verizon.net) (Read error: Connection reset by peer)
[09:27:51] *** Joins: Guest48 (~Guest48@192.55.46.56)
[09:45:01] *** ossifrage_ is now known as ossifrage
[09:51:53] *** Quits: Guest48 (~Guest48@192.55.46.56) (Ping timeout: 256 seconds)
[09:54:32] *** Quits: zsoltiv_ (~zsoltiv@fibhost-67-12-35.fibernet.hu) (Ping timeout: 240 seconds)
[09:58:23] *** Quits: emcodem (uid483343@id-483343.helmsley.irccloud.com) (Quit: Connection closed for inactivity)
[09:58:57] *** Quits: Colt (~Colt@user/colt) (Quit: Leaving)
[09:59:08] *** Joins: darkstardevx (~darkstard@50.39.115.145)
[09:59:55] *** Quits: darkstardevx (~darkstard@50.39.115.145) (Remote host closed the connection)
[10:00:21] *** Joins: darkstardevx (~darkstard@50.39.115.145)
[10:04:52] *** Joins: Guest48 (~Guest48@192.55.46.56)
[10:36:12] *** Quits: rpthms (~rpthms@user/rpthms) (Remote host closed the connection)
[10:38:49] *** Joins: Volgaar (~volgaar@193.137.116.78.rev.sfr.net)
[10:39:09] *** Joins: rpthms (~rpthms@user/rpthms)
[10:41:59] *** Joins: dreamon (~dreamon@pd9503f67.dip0.t-ipconnect.de)
[10:45:49] *** Quits: lexano (~lexano@195.206.104.82) (Ping timeout: 256 seconds)
[10:56:47] *** Quits: dreamon (~dreamon@pd9503f67.dip0.t-ipconnect.de) (Ping timeout: 250 seconds)
[10:59:19] *** Joins: nillyhan (~00000000@user/nillyhan)
[10:59:53] *** Quits: darkstardevx (~darkstard@50.39.115.145) (Read error: Connection reset by peer)
[11:01:31] *** Quits: thebombzen (~thebombze@c-68-41-54-207.hsd1.mi.comcast.net) (Quit: Quit)
[11:04:13] *** Joins: thebombzen (~thebombze@c-68-41-54-207.hsd1.mi.comcast.net)
[11:05:07] *** Joins: darkstardevx (~darkstard@50.39.115.145)
[11:05:59] *** Quits: darkstardevx (~darkstard@50.39.115.145) (Remote host closed the connection)
[11:06:46] *** Joins: darkstardevx (~darkstard@50.39.115.145)
[11:11:35] *** Quits: darkstardevx (~darkstard@50.39.115.145) (Read error: Connection reset by peer)
[11:11:47] *** Quits: Guest48 (~Guest48@192.55.46.56) (Ping timeout: 256 seconds)
[11:22:11] *** Joins: Guest48 (~Guest48@192.55.46.56)
[11:25:46] *** Joins: lexano (~lexano@195.206.104.86)
[11:27:32] *** Joins: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua)
[11:27:56] *** Joins: darkapex_ (~darkapex@user/darkapex)
[11:28:02] *** Quits: darkapex (~darkapex@user/darkapex) (Ping timeout: 268 seconds)
[11:34:27] *** Quits: Guest48 (~Guest48@192.55.46.56) (Ping timeout: 256 seconds)
[11:35:17] *** Quits: lexano (~lexano@195.206.104.86) (Ping timeout: 252 seconds)
[11:35:54] *** Quits: bitblit (~bitblit@gateway/tor-sasl/bitblit) (Ping timeout: 276 seconds)
[11:36:07] *** Joins: luc4 (~luca@151.82.24.19)
[11:36:17] *** Joins: bitblit (~bitblit@gateway/tor-sasl/bitblit)
[11:36:36] *** Joins: wyatt8740 (~wyatt8740@23.19.141.108)
[11:36:40] *** Quits: wyatt8750 (~wyatt8740@149.164.111.65) (Ping timeout: 268 seconds)
[11:39:19] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Read error: Connection timed out)
[11:39:30] *** Joins: dreamon (~dreamon@ppp-88-217-82-137.dynamic.mnet-online.de)
[11:40:32] *** Joins: scoobydoo (~scooby@user/scoobydoo)
[11:43:12] <luc4> Hello! Anyone who knows why the data needs to be copied to another buffer here? https://github.com/FFmpeg/FFmpeg/blob/master/doc/examples/demuxing_decoding.c#L81
[11:43:23] *** Joins: someuser (~user@197.54.108.24)
[11:43:52] <luc4> What is the difference from video_dst_data and frame->data? Thanks!
[11:45:53] *** Quits: anotheruser (~user@197.54.43.83) (Ping timeout: 256 seconds)
[11:48:34] <JEEB> luc4: I think that's just because the example is doing nothing else than dumping the raw decoded result out
[11:48:47] <JEEB> it's because it's such a limited example
[11:48:52] <JEEB> see the transcoding example
[11:49:10] *** Joins: lexano (~lexano@185.245.87.61)
[11:50:01] <luc4> JEEB: I'll have a look to the other example then, thanks
[11:50:02] *** Quits: darkapex_ (~darkapex@user/darkapex) (Ping timeout: 240 seconds)
[11:50:21] *** Joins: palasso (~palasso@user/palasso)
[11:51:15] *** Joins: darkapex (~darkapex@user/darkapex)
[11:52:39] *** Joins: softworkz_ (~softworkz@user/softworkz)
[11:52:39] *** softworkz is now known as Guest6679
[11:52:39] *** Quits: Guest6679 (~softworkz@user/softworkz) (Killed (molybdenum.libera.chat (Nickname regained by services)))
[11:52:39] *** softworkz_ is now known as softworkz
[11:53:35] *** Joins: durandal_1707 (~computer@95.168.121.109)
[11:54:14] *** Quits: lexano (~lexano@185.245.87.61) (Ping timeout: 260 seconds)
[11:55:32] *** Joins: lavaball (felix@31.204.155.215)
[12:04:12] *** Joins: Guest48 (~Guest48@192.55.46.56)
[12:08:08] *** Joins: lexano (~lexano@195.206.104.82)
[12:09:09] <luc4> JEEB: the transcoding example is very different in that point. However it seems that the call to copy is needed to get a proper image. It somehow realigns data in some way. Avoiding a new copy of the buffer would be good, I'm wondering if it is really needed.
[12:09:09] *** Quits: Volgaar (~volgaar@193.137.116.78.rev.sfr.net) (Ping timeout: 250 seconds)
[12:19:17] *** Quits: a0z (~a0z@90.244.184.28) (Ping timeout: 252 seconds)
[12:24:00] *** Quits: System_Error (~SystemErr@user/systemerror) (Ping timeout: 276 seconds)
[12:24:56] <Beam> yo. i see ffmpeg can host a simple tcp server, however if a client disconnects, ffmpeg exits with broken pipe - is it possible to make it just wait for another connection?
[12:28:05] <JEEB> luc4: it is only required because of how the fwrite expects the data to be :P
[12:28:21] <JEEB> it expects the raw video result to be in a single, continuous buffer
[12:28:21] <another|> I don't think so. It is _very_ simple
[12:29:04] <JEEB> yea it's not really a HTTP server
[12:29:31] <JEEB> it's a hack that someone added and if you need an actual HTTP server then please utilize something else and feed video from ffmpeg.c or something to it
[12:30:53] <luc4> JEEB: so the previous buffer is split into different parts? It is weird cause without the copy call I see the entire frame, but with wrong colors (shifted to green).
[12:31:11] <JEEB> it depends on what sort of pix_fmt is received
[12:31:24] <JEEB> for example for planar formats you have a separate plane for each
[12:31:33] <JEEB> yuv420p for example has separate planes for Y, Cb, Cr
[12:31:45] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Read error: Connection timed out)
[12:31:58] <JEEB> gbrp is planar RGB and has one for G, B and R
[12:32:18] <JEEB> NV12 is half-planar and has one plane for Y, and another where Cb and Cr are stuck next to each other
[12:32:55] *** Quits: pa (~pah@user/pah) (Ping timeout: 256 seconds)
[12:33:39] *** Joins: scoobydoo (~scooby@user/scoobydoo)
[12:33:42] <JEEB> there is also alignment, but I think if you're generally dumping frames the bigger is planar vs packed
[12:33:59] <JEEB> alignment then is when your linesize/stride is bigger than width
[12:34:25] <AMM> There's no convenient flag to have ffmpeg ignore m3u8 playlists or other not-local media, is there?
[12:34:47] <JEEB> protocol white list I think
[12:35:06] <JEEB> some formats like hlsdec have a protocol white list by default
[12:35:40] <AMM> Yep -protocol_whitelist is good
[12:36:03] <JEEB> but I don't think that's perfect :<
[12:36:18] <AMM> It's not, I'll libmagic later
[12:36:31] <AMM> User uploads
[12:36:48] *** Joins: pah (~pah@user/pah)
[12:36:57] <JEEB> I do recommend putting that into a chroot etc at the very least
[12:37:06] <JEEB> if you're dealing with user uploads
[12:37:15] <JEEB> and possibly just limiting the build to certain protocols
[12:37:24] <JEEB> (and formats)
[12:38:23] <AMM> actually -protocol_whitelist did nothing for ffprobing a local playlist, so I'll just go with libmagic
[12:39:40] <luc4> JEEB: thanks, let's see if I can do something better then
[12:40:31] <JEEB> also FFmpeg actually has a rawvideo writer if you want that :D
[12:40:55] *** Quits: lavaball (felix@31.204.155.215) (Remote host closed the connection)
[12:42:41] <luc4> JEEB: no, I need to convert it to RGB for postprocessing it
[12:42:59] <luc4> JEEB: I can probably change my code a bit to handle planes separately
[12:43:14] <JEEB> then you can utilize libavfilter or swscale for that
[12:43:29] <JEEB> swscale now has an AVFrame API, and libavfilter has the scale filter that does format conversions and scaling
[12:43:46] <JEEB> unless you want to handle it by yourself
[12:43:55] <JEEB> av_pix_fmt_desc_get can be useful :P
[12:44:10] <JEEB> which gets the description for the pix_fmt
[12:44:15] <luc4> JEEB: unfortunately I used swscale but had to move to libyuv for this, as swscale seemed not to support premultiplied formats
[12:46:25] *** Quits: Guest48 (~Guest48@192.55.46.56) (Ping timeout: 256 seconds)
[12:46:40] <JEEB> well then the pixel format descriptor probably will come in handy
[12:46:50] <JEEB> since it will describe various values of the format
[12:48:27] <durandal_1707> luc4: use libavfilter for premulitiplied formats
[12:58:38] *** Quits: feiw (~Fei.Wang@192.102.204.51) (Remote host closed the connection)
[12:59:02] *** Joins: feiw (~Fei.Wang@192.102.204.51)
[13:01:07] <Beam> hi
[13:01:10] <Beam> cur_dts is invalid st:0 (0) [init:1 i_done:0 finish:0] (this is harmless if it occurs once at the start per stream)
[13:01:10] <Beam> [mpegts @ 0x55a48af89840] Delay between the first packet and last packet in the muxing queue is 10005334 > 10000000: forcing output
[13:01:23] <Beam> i'm getting this most of the time. about 1 in 10 times it works :/
[13:01:58] <Beam> when i get this error, the stream never starts video. audio works fine. the source is webrtc opus / vp8
[13:02:54] <Beam> i assume its lack of keyframes?
[13:07:04] *** Quits: durandal_1707 (~computer@95.168.121.109) (Read error: No route to host)
[13:16:28] *** Joins: Guest48 (~Guest48@192.55.46.56)
[13:20:45] *** pah is now known as pa
[13:28:25] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Read error: Connection timed out)
[13:31:29] *** Joins: scoobydoo (~scooby@user/scoobydoo)
[13:31:45] *** Quits: feiw (~Fei.Wang@192.102.204.51) (Remote host closed the connection)
[13:32:08] *** Joins: feiw (~Fei.Wang@192.102.204.51)
[13:32:14] *** Joins: cosimone (~user@93-47-228-203.ip115.fastwebnet.it)
[13:32:22] *** Quits: cosimone (~user@93-47-228-203.ip115.fastwebnet.it) (Remote host closed the connection)
[13:32:47] *** Joins: cosimone (~user@93-47-228-203.ip115.fastwebnet.it)
[13:38:10] *** Joins: durandal_1707 (~computer@95.168.116.164)
[13:39:40] *** Joins: lavaball (~Melissa@31.204.155.215)
[13:39:46] *** Quits: Guest48 (~Guest48@192.55.46.56) (Quit: Client closed)
[13:41:21] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Remote host closed the connection)
[13:41:25] *** Quits: dreamon (~dreamon@ppp-88-217-82-137.dynamic.mnet-online.de) (Ping timeout: 252 seconds)
[13:42:24] *** Joins: scoobydoo (~scooby@user/scoobydoo)
[13:48:54] *** Quits: l4yer (~l4yer@195.181.170.210) (Remote host closed the connection)
[13:50:07] *** Joins: l4yer (~l4yer@84.69.191.245)
[13:53:26] *** Quits: durandal_1707 (~computer@95.168.116.164) (Read error: No route to host)
[13:54:08] *** Joins: keypusher (keypusher@user/keypusher)
[13:54:41] *** Quits: l4yer (~l4yer@84.69.191.245) (Ping timeout: 250 seconds)
[14:05:55] *** Joins: cmp (~cmp@lfbn-ren-1-1158-210.w86-215.abo.wanadoo.fr)
[14:06:56] *** Joins: l4yer (~l4yer@195.181.170.210)
[14:14:25] *** Joins: Jan\ (~kvirc@104.204.200.118)
[14:18:09] *** garfvl_ is now known as garfvl
[14:28:22] *** Joins: Blacker47 (~Blacker47@user/blacker47)
[14:39:25] *** Joins: emcodem (uid483343@id-483343.helmsley.irccloud.com)
[14:39:42] <emcodem> @BtbN you dont accidently have a build script for decklink ready to use? :D
[14:49:16] *** Quits: jarthur (~jarthur@2603-8080-1540-002d-b1ee-87e3-1ad0-a6a9.res6.spectrum.com) (Quit: jarthur)
[15:16:45] *** Quits: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua) (Ping timeout: 252 seconds)
[15:17:47] *** Joins: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua)
[15:18:23] *** Joins: minimal (~minimal@user/minimal)
[15:21:48] *** Quits: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua) (Remote host closed the connection)
[15:22:45] *** Joins: djk (~Thunderbi@pool-96-242-218-239.nwrknj.fios.verizon.net)
[15:23:53] *** Joins: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua)
[15:32:40] *** Quits: luc4 (~luca@151.82.24.19) (Read error: Connection reset by peer)
[15:35:35] *** Joins: luc4 (~luca@mi-18-5-108.service.infuturo.it)
[15:41:03] *** Quits: lexano (~lexano@195.206.104.82) (Ping timeout: 250 seconds)
[15:44:18] *** Joins: Volgaar (~volgaar@gw.lipn.univ-paris13.fr)
[16:21:18] *** Joins: kib_ (~kib@user/kib)
[16:23:13] *** Parts: benbrown (~benbrown@user/benbrown) ()
[16:32:27] *** kib_ is now known as kib
[16:49:18] *** Joins: voltron (~voltrin_@ip4d16bdc6.dynamic.kabel-deutschland.de)
[16:51:47] *** Quits: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua) (Read error: Connection reset by peer)
[16:52:17] *** Joins: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua)
[16:54:20] *** Joins: fkaa (~fkaa@81-226-20-99-no256.tbcn.telia.com)
[16:58:03] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Read error: Connection timed out)
[16:59:14] *** Joins: scoobydoo (~scooby@user/scoobydoo)
[17:19:29] *** Quits: kib (~kib@user/kib) (Quit: WeeChat 3.3)
[17:20:49] *** Quits: beaver (~beaver@user/pong) (Remote host closed the connection)
[17:21:12] <bencc1> why changing video from variable framerate to a fixed framerate requires re-encode?
[17:21:22] <bencc1> isn't it just dropping and duplicating frames?
[17:23:33] <galad> encoded frames depend on other frames, so dropping one is not that smple
[17:27:35] *** Quits: Volgaar (~volgaar@gw.lipn.univ-paris13.fr) (Ping timeout: 256 seconds)
[17:30:59] *** Quits: voltron (~voltrin_@ip4d16bdc6.dynamic.kabel-deutschland.de) (Remote host closed the connection)
[17:32:54] *** Joins: beaver (~beaver@user/pong)
[17:33:35] <bencc1> ok
[17:34:07] <emcodem> whut?
[17:34:07] <bencc1> can it be done without lossing quality?
[17:34:18] *** Joins: waleee (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4)
[17:34:44] <emcodem> i think it should be possible to force a fixed rate
[17:34:49] <emcodem> without reencoding
[17:36:46] *** Quits: beaver (~beaver@user/pong) (Client Quit)
[17:49:12] *** Joins: lexano (~lexano@174.119.69.134)
[18:04:31] *** Joins: kib (~kib@user/kib)
[18:08:04] *** Joins: darkapex_ (~darkapex@user/darkapex)
[18:08:30] *** Quits: darkapex (~darkapex@user/darkapex) (Ping timeout: 260 seconds)
[18:12:49] <emcodem> something like -bsf:v h264_metadata=tick_rate=1001/60000:fixed_frame_rate_flag=1
[18:12:53] <emcodem> ?
[18:17:53] *** Joins: darkstardevx (~darkstard@50.39.115.145)
[18:25:35] *** Joins: zsoltiv_ (~zsoltiv@fibhost-67-12-35.fibernet.hu)
[18:27:22] *** Quits: ecs (ecs@user/ecs) (Ping timeout: 268 seconds)
[18:27:26] *** Joins: cis_ (~cis@user/cis)
[18:27:39] *** Joins: dreamon (~dreamon@ppp-88-217-82-137.dynamic.mnet-online.de)
[18:27:52] *** Joins: ecs (~ecs@user/ecs)
[18:28:04] *** Joins: System_Error (~SystemErr@user/systemerror)
[18:28:36] *** Quits: cis (cis@user/cis) (Ping timeout: 268 seconds)
[18:29:13] *** Quits: rcombs (rcombs@irc.rcombs.me) (Ping timeout: 268 seconds)
[18:31:47] *** Joins: Volgaar (~volgaar@nat-wifi-eduroam.reseau.univ-paris13.fr)
[18:36:13] *** Joins: xkuru (~xkuru@user/xkuru)
[18:41:55] *** Joins: rcombs (rcombs@irc.rcombs.me)
[18:45:23] *** Quits: Volgaar (~volgaar@nat-wifi-eduroam.reseau.univ-paris13.fr) (Ping timeout: 252 seconds)
[18:47:10] *** Joins: softworkz_ (~softworkz@user/softworkz)
[18:47:10] *** softworkz is now known as Guest6692
[18:47:10] *** Quits: Guest6692 (~softworkz@user/softworkz) (Killed (strontium.libera.chat (Nickname regained by services)))
[18:47:10] *** softworkz_ is now known as softworkz
[18:52:02] *** Quits: Atsuko (~x@94.242.254.66) (Remote host closed the connection)
[18:55:57] *** Quits: teebz89 (~tcb@216.109.199.128) (Quit: The Lounge - https://thelounge.chat)
[19:02:00] *** Joins: Atsuko (~x@94.242.250.86)
[19:06:31] *** Joins: beaver (~beaver@user/pong)
[19:08:00] *** Joins: rsx (~dummy@ppp-188-174-144-140.dynamic.mnet-online.de)
[19:09:42] *** Quits: jos1 (~jos3@host-091-097-188-114.ewe-ip-backbone.de) (Remote host closed the connection)
[19:10:03] *** Joins: jos1 (~jos3@host-091-097-188-114.ewe-ip-backbone.de)
[19:14:03] *** Quits: nillyhan (~00000000@user/nillyhan) (Ping timeout: 250 seconds)
[19:21:59] *** Joins: Xaldafax (~xaldafax@cpe-198-72-160-101.socal.res.rr.com)
[19:24:26] *** Joins: mhicks (~mhicks@ip72-198-30-11.ok.ok.cox.net)
[19:24:54] *** Quits: mhicks (~mhicks@ip72-198-30-11.ok.ok.cox.net) (Client Quit)
[19:25:06] *** Joins: mhicks (~mhicks@ip72-198-30-11.ok.ok.cox.net)
[19:26:05] <mhicks> I'm attempting to pipe a raw webm through ffmpeg to send to an RTSP stream. Are there any examples of doing this?
[19:26:40] <mhicks> this is what I have: ffmpeg -re -f webm -i pipe: -f rtsp rtsp://localhost:8554/mystream but when I try to open the stream in VLC it just errors. If I use a file instead of piping, it works
[19:29:29] <emcodem> how do you bring the input to stdin?
[19:31:26] <mhicks> @emcodem, testing with: `ffmpeg -re -i test.webm -f webm pipe: | ffmpeg -re -f webm -i pipe: -c copy -strict experimental -f rtsp rtsp://localhost:8554/mystream`
[19:32:05] <mhicks> but ultimately, I want to launch the ffmpeg process from Java and use stdout to write the raw webm packets I'm receiving in real-time to the process
[19:32:06] <emcodem> that should do... did you try using dash instead of pipe: ?
[19:32:47] <mhicks> when I try to view the stream it says "main decoder error: could not identify codec"
[19:33:19] <mhicks> using `vlc rtsp://localhost:8554/mystream` to view the stream
[19:33:21] *** Joins: AbleBacon (~AbleBacon@user/AbleBacon)
[19:33:23] *** Quits: luc4 (~luca@mi-18-5-108.service.infuturo.it) (Read error: Connection reset by peer)
[19:34:14] <mhicks> what do you mean using dash?
[19:34:54] <emcodem> -
[19:35:03] <mhicks> ah, yeah, same exact problem
[19:35:10] <emcodem> ok thats expected
[19:35:21] <emcodem> and did u try writing a file instead of rtsp?
[19:36:04] *** Joins: luc4 (~luca@151.82.3.163)
[19:36:10] <mhicks> good idea...trying now
[19:36:37] <mhicks> that worked...
[19:36:56] <mhicks> used: ffmpeg -re -i test.webm -f webm - | ffmpeg -re -f webm -i - -c copy output.webm
[19:39:26] <emcodem> damn :D
[19:40:04] <mhicks> well, at least that tells me I'm on the right track, but there's some issue streaming to rtsp
[19:40:13] <mhicks> but, if I do it directly from the file to rtsp it works fine
[19:40:27] <emcodem> i'd try another codec
[19:40:37] <emcodem> like not codec copy but libx264 or such
[19:40:45] <mhicks> hmmm, perhaps
[19:41:23] <furq> probably the container is the problem not the codec
[19:42:40] <emcodem> true
[19:42:58] <emcodem> -f mpeg2ts should work, right?
[19:43:20] <furq> i don't think vp9 is mapped in mpegts yet
[19:43:40] <furq> does it have to go to an rtsp server
[19:43:55] <furq> icecast can deal with webm ingest
[19:44:05] *** Quits: Atsuko (~x@94.242.250.86) (Remote host closed the connection)
[19:45:04] <furq> or i guess to be specific ffmpeg can definitely send webm to icecast and it'll all work
[19:45:15] <furq> whether rtsp in general or your rtsp server can do that i have no idea
[19:45:44] <mhicks> well, I'm actually setting this up to eventually stream to RTMPS, but locally testing with RTSP
[19:45:57] <furq> you'll need to transcode for rtmp anyway
[19:46:00] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Read error: Connection timed out)
[19:46:09] <furq> rtmp only does h264 and aac in flv
[19:46:18] <furq> (and also some ancient codecs you don't want to use)
[19:47:12] *** Joins: scoobydoo (~scooby@user/scoobydoo)
[19:49:09] <mhicks> well, I'm trying to test the other side now just writing to a file piping through ffmpeg from Java and I'm getting the error: "Invalid data found when processing input", but I'm just piping the raw webm coming from the browser blobs
[19:51:51] *** Joins: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net)
[19:52:03] <mhicks> can ffmpeg stream a file as it's being written?
[19:52:24] <BtbN> no, as it'll get its size initially and stop when it reached the "end"
[19:54:49] <emcodem>  i think the -follow option should do this actually
[19:55:51] *** Joins: iive (~iive@87.119.101.204.client.entry.bg)
[19:56:46] <mhicks> so: ffmpeg -follow -f webm -i test.webm -c copy -f rtsp rtsp://localhost:8554/mystream
[19:56:49] <mhicks> ?
[19:57:04] <emcodem> doesnt look bad
[19:57:05] <mhicks> where I'm writing concurrently to test.webm
[19:57:16] <emcodem> but furq says only flv and h264 works, right?
[19:57:42] <BtbN> It sure won't work with non-streamable files like mp4
[19:57:46] <JEEB> mhicks: you can keep the I/O reading the file even if it hits EOF
[19:57:56] <JEEB> I do this with mpeg-ts for quite a while
[19:58:08] <JEEB> you need to set rw_timeout as well as that one I/O option
[19:58:54] *** Joins: Atsuko (~x@94.242.254.66)
[19:59:21] <JEEB> let me remind me what that option by wbs was
[20:00:01] <JEEB> ah yes
[20:00:04] <JEEB> follow
[20:00:33] *** Quits: System_Error (~SystemErr@user/systemerror) (Remote host closed the connection)
[20:00:36] <JEEB> rw_timeout + follow will keep reading the input file as it's being written to
[20:00:41] <JEEB> with file protocol specifically
[20:01:05] *** Joins: System_Error (~SystemErr@user/systemerror)
[20:02:13] <mhicks> ffmpeg -follow -f webm -i test.webm -c copy -f rtsp rtsp://localhost:8554/mystream <-- gives me "unable to find a suitable output format for 'webm'"
[20:02:40] <mhicks> so, ffmpeg doesn't seem to like streaming webm?
[20:02:42] <JEEB> clearly you are not reading
[20:03:05] <JEEB> but first thing is that you did not set a value for follow
[20:03:07] <JEEB> second of all
[20:03:09] <mhicks> sorry, re-reading
[20:03:15] <JEEB> I said rw_timeout PLUS follow
[20:03:23] <JEEB> `ffmpeg -h full |grep rw_timeout`
[20:03:31] <JEEB> for rw_timeout's docs
[20:03:41] <JEEB> `ffmpeg -h protocol=file` for file protocol's options
[20:05:45] <mhicks> sorry, got a meeting..back in a few...I'll go through the docs and come back..thanks!
[20:06:27] *** Joins: Volgaar (~volgaar@nat-wifi-eduroam.reseau.univ-paris13.fr)
[20:09:32] <mhicks> @JEEB, so ffmpeg -follow -rw_timeout 1000000 -f webm -i test.webm -c copy -f rtsp rtsp://localhost:8554/mystream
[20:10:08] <mhicks> oops: ffmpeg -follow 1 -rw_timeout 1000000 -f webm -i test.webm -c copy -f rtsp rtsp://localhost:8554/mystream
[20:10:56] <JEEB> woah
[20:11:03] <JEEB> someone actually read the explanation of rw_timeout xD
[20:11:08] <mhicks> hehe
[20:11:19] <JEEB> so many people go for either seconds or milliseconds
[20:11:35] <JEEB> granted, there is a timestamp option type which in theory rw_timeout should be utilizing
[20:11:40] <JEEB> but hysterical raisins
[20:11:59] <JEEB> but yes, that would wait for 1 second if the file got more data
[20:12:11] <JEEB> when that finishes, it gives EOF
[20:12:21] <mhicks> will that still work if it starts with a zero length file?
[20:12:40] <JEEB> haven't really tested that early in the process :P
[20:12:55] <JEEB> you could try it by setting a longer rw_timeout
[20:13:00] <JEEB> and testing with an empty shell :P
[20:13:38] <mhicks> I'll wait until I write my first bytes just to be sure
[20:14:05] <mhicks> testing with my webcam and on a Zoom meeting now, so I can't test until I'm finished. :o
[20:22:16] *** Joins: Buster_ (~Buster@46.160.36.66)
[20:28:38] *** Quits: xkuru (~xkuru@user/xkuru) (Read error: Connection reset by peer)
[20:37:35] *** Quits: luc4 (~luca@151.82.3.163) (Ping timeout: 252 seconds)
[20:40:25] *** Quits: cmp (~cmp@lfbn-ren-1-1158-210.w86-215.abo.wanadoo.fr) (Quit: Connection closed)
[20:40:53] *** Quits: waleee (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4) (Ping timeout: 252 seconds)
[20:42:47] *** Joins: xkuru (~xkuru@user/xkuru)
[20:43:46] *** Joins: waleee (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4)
[20:44:23] <phinxy> Since firefox uses ffmpeg, can options/flags be passed through to ffmpeg?
[20:44:41] <phinxy> Or is there a "libffmpeg" which firefox uses?
[20:45:39] <JEEB> libavformat for reading files, libavcodec for decoding and encoding etc
[20:46:15] <JEEB> I think Firefox mostly utilizes FFmpeg for decoding purposes on linux, as well as they have split the VP9 decoder into their own thing
[20:46:24] <JEEB> so I think they mostly utilize libavcodec specifically
[20:47:02] <bencoh> you can also build ffmpeg using emscripten and run it from your website and ... ahem, nevermind :>
[20:47:17] *** Joins: mickor (~mickor@89-64-97-154.dynamic.chello.pl)
[20:47:21] <bencoh> (I wasn't being serious)
[20:48:18] *** Quits: mickor (~mickor@89-64-97-154.dynamic.chello.pl) (Client Quit)
[20:49:08] <furq> don't want to google that to find out someone is inevitably doing it
[20:49:41] <AMM> People very much are doing it
[20:50:02] <AMM> My Dahua IP camera's webview loads up ffmpeg.js and pals
[20:50:11] *** Quits: Volgaar (~volgaar@nat-wifi-eduroam.reseau.univ-paris13.fr) (Ping timeout: 265 seconds)
[20:51:21] *** Joins: teebz89 (~tcb@216.109.199.128)
[20:51:31] *** Quits: dreamon (~dreamon@ppp-88-217-82-137.dynamic.mnet-online.de) (Ping timeout: 252 seconds)
[20:53:41] *** Quits: rsx (~dummy@ppp-188-174-144-140.dynamic.mnet-online.de) (Quit: rsx)
[20:53:55] <emcodem> emscriten, like :D
[21:01:40] <LuKaRo_> I want to add a 3 second fade in and fade out to a long libx265 mkv video without re-encoding the entire file. My approach was to create the fade in and fade out as separate files, and then use the concat protocol / demuxer to combine the start and end with a cutted version of the file without re-encoding. This works, however timestamps seem to be messed up, as frames jump at the concatenations. Any ideas how to fix this?
[21:02:02] *** Quits: waleee (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4) (Ping timeout: 240 seconds)
[21:05:34] <LuKaRo_> My syntax was something like this: ffmpeg -ss 00:57:00 -i source.mkv -c:v libx265 -crf 23 -c:a copy -vf "fade=t=in:st=0:d=3" -to 00:00:04 fadein.mkv
[21:07:06] <LuKaRo_> ffmpeg -ss 00:57:04 -i source.mkv -c copy -to main.mkv
[21:07:58] <LuKaRo_> ffmpeg -ss 01:43:20 -i source.mkv -c:v libx265 -crf 23 -c:a copy -vf "fade=t=out:st=0:d=3" -to 00:00:03 fadeout.mkv
[21:08:51] <emcodem> did you make sure that all basic params like pix_fmt, resolution, audio codec and such is exactly the same in all 3 files?
[21:10:48] <LuKaRo_> Hm, I thought as they all stem from the same source file, this should not be a problem, is it?
[21:14:20] <emcodem> hm well you reencode 2 of them, you should maybe check that they are the same
[21:16:49] <LuKaRo_> ffprobe says for all three: hevc (Main) (HEVC / 0x43564548), yuv420p(tv, bt709), 1920x1080 [SAR 1:1 DAR 16:9], 60 fps, 60 tbr, 90k tbn, 60 tbc
[21:16:53] <LuKaRo_> Anything else I can check?
[21:17:21] <LuKaRo_> And for audio: aac (LC) ([15][0][0][0] / 0x000F), 48000 Hz, stereo, fltp, 194 kb/s
[21:24:34] *** Joins: waleee (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4)
[21:28:29] *** Joins: Colt (~Colt@user/colt)
[21:29:05] <mhicks> Okay, ffmpeg -follow 1 -rw_timeout 1000000 -f webm -i test.webm -c copy -f rtsp rtsp://localhost:8554/mystream does work! However, it's choppy every second or two it pauses before continuing. After I stop recording and load the video file directly, it's completely smooth though.
[21:31:35] <mhicks> Aha! I added `-re` to it and it's perfectly smooth
[21:33:32] <mhicks> okay, so that works for starting at the beginning of the stream, but can I tell it to start like 2 seconds before the end of the stream to get it as close to realtime as possible?
[21:37:06] <mhicks> Removing `-re` and increasing the frequency of sending data got me up to smooth video quality, but I'm still about 3 seconds lagged
[21:38:10] <mhicks> could I replace `-i test.webm` with `-i -` to directly stream to it?
[21:41:20] <mhicks> apparently not. Getting: [matroska,webm @ 0x55c2a8908080] EBML header parsing failed
[21:41:22] <mhicks> pipe:: Invalid data found when processing input
[21:42:14] <JEEB> pipe is pipe, not file
[21:42:18] <JEEB> so it has no follow
[21:42:40] <JEEB> you could implement that if you really wanted to :P
[21:43:41] *** Quits: kib (~kib@user/kib) (Quit: WeeChat 3.3)
[21:46:43] *** Joins: dreamon (~dreamon@pd9503f67.dip0.t-ipconnect.de)
[21:50:21] <emcodem> @LuKaRo_ i'm not sure if  -start_at_zero  on codec copy and concat...
[21:53:53] <LuKaRo_> emcodem: -start_at_zero does not seem to fix it, unfortunately
[21:54:54] <LuKaRo_> I've simplified my example to concatenate only the fadein and fadeout parts without the main part. Now the frames do not jump anymore at the concatenated positions, but the video freezes for a few seconds. Is this because of missing b-frames or something?
[21:55:07] <emcodem> does ffmpeg -i YOURFILE -f null - complain about pts?
[21:55:34] <emcodem> where do you see the freeze, in vlc?
[21:55:50] <LuKaRo_> mpv, but I could try vlc and ffplay :)
[21:56:01] <emcodem> try ffmpeg
[21:56:02] <emcodem> hehe
[21:56:16] <LuKaRo_> ffmpeg -f null - does not complain about anything
[21:56:28] <emcodem> fooo...
[21:57:03] <emcodem> ah
[21:57:56] <emcodem> so, concating the opener 3 times should work
[21:57:59] <emcodem> can you confirm this?
[21:59:24] <LuKaRo_> Good point, I'll give that a try!
[21:59:48] <LuKaRo_> ffplay and vlc both show the freeze at the cut point as well
[22:00:19] <emcodem> i know freezes at concat points from mid-stream format changes
[22:00:26] *** Joins: ChocolateArmpits (~Chocolate@88.223.162.30)
[22:00:29] <emcodem> but it doesnt have to be the only possible cause
[22:01:24] <LuKaRo_> Concatenating the fadein three times also produces those freezes
[22:02:55] <LuKaRo_> I'm using -f concat -safe 0 -i <file containing the fadein file name three times>
[22:03:16] <emcodem> hm, i never tried concating h265 unfortunately
[22:06:01] *** Joins: blaze (~blaze@user/blaze)
[22:06:29] <LuKaRo_> I've also used mpegts as a containerformat as I thought this is better for concatenating than mkv
[22:09:30] <emcodem> i cannot reproduce
[22:09:57] <emcodem> encoded 1 second to h265 (without audio) and concated the result - no problem
[22:10:06] <emcodem> ffmpeg version?
[22:10:28] <emcodem> btw, the container might not really play a role for concat, i mean the stuff is demuxed anyways
[22:11:51] *** Joins: waleee-cl (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4)
[22:11:57] *** Quits: waleee (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4) (Read error: Connection reset by peer)
[22:12:28] *** Quits: waleee-cl (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4) (Client Quit)
[22:13:17] *** Joins: waleee (~waleee@2001:9b0:21d:fc00:398f:b003:b90d:acf4)
[22:13:20] <LuKaRo_> I'll try omitting the audio :)
[22:20:49] *** Quits: scoobydoo (~scooby@user/scoobydoo) (Read error: Connection timed out)
[22:22:37] *** Joins: scoobydoo (~scooby@user/scoobydoo)
[22:31:17] <LuKaRo_> Even without audio it freezes at the cut points
[22:31:44] <LuKaRo_> Of course I could simply re-encode the entire file, but there must be a better way...
[22:34:44] <emcodem> version?
[22:35:16] <LuKaRo_> ffmpeg version n4.4.1 built with gcc 11.1.0
[22:36:33] <emcodem> https://usercontent.irccloud-cdn.com/file/Wfprs2Va/test.mkv
[22:37:13] <emcodem> this was the file i tested with
[22:38:57] <LuKaRo_> You're right, it works with your file and the following command line: ffmpeg -f concat -safe 0 -i <(for i in {"test.mkv","test.mkv","test.mkv"}; do echo "file $PWD/$i"; done) -c copy final.mkv
[22:40:57] <emcodem> hm, it should be very similar to your opener
[22:42:52] <emcodem> is the opener 3 frames?
[22:42:58] <LuKaRo_> Yeah, I'm trying to figure out while it doesn't work the same with my opener
[22:43:00] <LuKaRo_> 3 frames?
[22:43:08] <emcodem> duration
[22:43:28] <LuKaRo_> 3 second duration, if that's what you mean?
[22:43:49] *** Quits: minimal (~minimal@user/minimal) (Quit: Leaving)
[22:44:27] <emcodem> ah, right i see... trying 3 secs
[22:44:59] <emcodem> no problem
[22:45:25] <LuKaRo_> Yeah, it has to be something else...
[22:46:14] <emcodem> can u share a short file that has the problem?
[22:53:45] <LuKaRo_> yeah, sure!
[22:53:49] <LuKaRo_> thanks for your help btw
[22:55:47] <emcodem> no worries
[22:57:02] <LuKaRo_> https://filehorst.de/d/eEnkvlfo is a random 5 second piece cut out from the original video file. Concatenating this three times also yields the same freezes.
[22:58:17] <LuKaRo_> It was generated using: ffmpeg -ss 00:55:00 -i 2021-12-11\ 17-08-20-H265-Chapters.mkv -to 00:00:05 -c copy -map 0:v random.mkv
[23:01:10] <emcodem> hehe your file makes my windows explorer to freak out
[23:01:36] <emcodem> Timestamps are unset in a packet for stream 0. This is deprecated and will stop working in the future. Fix your code to set the timestamps properly
[23:03:17] <emcodem> i guess this is your problem
[23:03:45] <emcodem> but i doubt that this is the same for opener
[23:04:44] <LuKaRo_> how can I set the timestamps properly?
[23:05:03] <LuKaRo_> I tried something like -fflags +genpts -start_at_zero
[23:09:03] <emcodem> did you extract the raw h265 at some point in time?
[23:09:13] <emcodem> i mean extract to raw and then mux to mkv
[23:10:14] <emcodem> forcing -r for the input works for me
[23:10:16] <emcodem> ffmpeg -safe 0 -f concat -r 25 -i C:\temp\concat.txt -crf 23 -codec copy c:\tmp\concat.mp4
[23:13:55] <emcodem> (omit the crf :D)
[23:18:01] *** Quits: Buster_ (~Buster@46.160.36.66) (Ping timeout: 250 seconds)
[23:19:31] *** Quits: darkstardevx (~darkstard@50.39.115.145) (Quit: Leaving)
[23:19:51] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Quit: https://quassel-irc.org - Chat comfortably. Anywhere.)
[23:21:19] *** Joins: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net)
[23:21:48] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Client Quit)
[23:23:18] *** Joins: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net)
[23:24:09] *** Joins: durandal_1707 (~computer@95.168.116.172)
[23:24:18] *** Quits: durandal_1707 (~computer@95.168.116.172) (Client Quit)
[23:24:52] *** Joins: durandal_1707 (~computer@95.168.116.172)
[23:29:16] <LuKaRo_> What do you mean by "raw"?
[23:29:52] <ChocolateArmpits> unwrapped
[23:30:09] <ChocolateArmpits> literally just a sequence of h265 packets
[23:30:14] <LuKaRo_> How can I extract that?
[23:30:33] *** Quits: blaze (~blaze@user/blaze) (Quit: WeeChat 3.3)
[23:30:41] <ChocolateArmpits> ffmpeg -i input.mkv -codec copy video.h265
[23:30:58] <LuKaRo_> Interesting!
[23:31:08] <LuKaRo_> I'll give that a try
[23:31:28] <LuKaRo_> When I do ffmpeg -f concat -safe 0 -r 60 -i <(for i in {1..3}; do echo "file $PWD/random.mkv"; done) -c copy -map 0:v -fflags +genpts -start_at_zero final.mp4 it doesn't freeze, but the frames skip a bit at the cut positions. Did you also encounter this, @emcodem?
[23:31:45] <LuKaRo_> And then concat the .h265 files?
[23:32:49] *** Joins: Volgaar (~volgaar@193.137.116.78.rev.sfr.net)
[23:33:25] <LuKaRo_> Concatenating the .h265 files doesn't fix it. However, when creating the .h265 samples from the large mkv, I get:
[23:33:32] <LuKaRo_> Application provided invalid, non monotonically increasing dts to muxer in stream 0: -252 >= -253
[23:33:34] <LuKaRo_> Any ideas?
[23:33:44] <LuKaRo_> Maybe this is the cause of the mixed up frames at the cut positions?
[23:34:12] *** Joins: Buster_ (~Buster@buster-net.ru)
[23:36:02] <ChocolateArmpits> maybe the problems arise due to not cutting on a keyframe?
[23:36:16] <LuKaRo_> Yeah, maybe
[23:36:34] <LuKaRo_> I also had that thought and wondered if I can force ffmpeg to create a keyframe?
[23:36:46] <emcodem> yes there was something on the cut points
[23:36:47] <ChocolateArmpits> not while stream copying
[23:37:05] <emcodem> wouldn't -ss take care about the keyframes?
[23:37:21] <emcodem> well ok it's openGOP but we dont have decode issues for the first frames
[23:37:57] <emcodem> but concatting the opener which was transcoded and is a complete file should always work
[23:38:28] <ChocolateArmpits> emcodem, -ss on input seeks by keyframes first and from then on seeks precisely to the frame requested
[23:38:42] *** Quits: beaver (~beaver@user/pong) (Ping timeout: 276 seconds)
[23:38:50] <ChocolateArmpits> or something to that end
[23:39:14] <emcodem> hm, i use ss in mpeg2 and i always get a complete GOP
[23:39:22] *** Joins: softworkz_ (~softworkz@user/softworkz)
[23:39:22] *** Quits: softworkz (~softworkz@user/softworkz) (Killed (iridium.libera.chat (Nickname regained by services)))
[23:39:22] *** softworkz_ is now known as softworkz
[23:39:32] <emcodem> i only have incomplete GOP issues at the end of files
[23:39:45] <emcodem> for missing P frames
[23:40:08] <emcodem> anyway, the opener is transcoded, it should work
[23:40:17] <emcodem> 3x opener i mean
[23:45:20] <emcodem> my question about the raw h265 was actually if you did that to the main file at some time before
[23:45:33] <emcodem> one should avoid extracting to raw and remux then
[23:48:27] *** Quits: bitblit (~bitblit@gateway/tor-sasl/bitblit) (Ping timeout: 276 seconds)
[23:50:28] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Ping timeout: 265 seconds)
[23:50:53] *** Joins: zmt01 (~zmt00@user/zmt00)
[23:54:49] *** Quits: zmt00 (~zmt00@user/zmt00) (Ping timeout: 265 seconds)
[23:58:46] *** Joins: bitblit (~bitblit@gateway/tor-sasl/bitblit)
