[00:00:34] *** Quits: Riz (~Riz@cpc152567-shef18-2-0-cust38.17-1.cable.virginm.net) (Quit: Connection closed)
[00:04:01] <Vall> Hello everyone
[00:04:18] <Vall> specially softworkz
[00:04:31] <Vall> FFMPEG suddenly stopped working here :-/
[00:04:56] <Vall> Here's what it's happening: https://termbin.com/cv5x
[00:05:32] <Vall> Coincidentally or not, earlier today I accepted a massive software update that, among other things, had updates for ffmpeg stuff.
[00:05:36] <Vall> Can anyone help?
[00:07:52] <JEEB> your libva driver doesn't contain that profile
[00:07:58] <JEEB> check `vainfo`
[00:08:52] <JEEB> intel has two drivers, iHD and i965
[00:09:16] <JEEB> you can compare running vainfo with the env var LIBVA_DRIVER_NAME=i965
[00:10:17] <JEEB> if neither driver has VAProfileHEVCMain then that piece of hardware is not capable of it :P
[00:13:01] *** Quits: dreamon (~dreamon@p54b14aac.dip0.t-ipconnect.de) (Remote host closed the connection)
[00:28:07] *** Joins: TheSash__ (~TheSashmo@174.119.184.190)
[00:28:22] *** Quits: TheSashm_ (~TheSashmo@174.119.184.190) (Ping timeout: 252 seconds)
[00:34:57] <GenTooMan> question is their a tutorial on writing an ffmpeg filter? I've looked into it but mostly had the idea that one had to modify the libavfilter library to add a filter.
[00:35:43] <durandal_1707> yes, modify lib
[00:35:45] <JEEB> libavfilter is a library, not a framework
[00:36:00] <JEEB> so you don't get external filters like in gstreamer, avisynth, vapoursynth
[00:37:28] <GenTooMan> hmm well debug and crash, I mean test, will be interesting.
[00:40:36] <JEEB> GenTooMan: doc/filter_design.txt is one document, then there's a wiki article from like ten years ago which might no longer be relevant. I recommend checking out some simple filter like libavfilter/vf_setparams.c (which only touches the metadata of the AVFrames)
[00:42:52] <JEEB> you have an AVFilter, you register it in allfilters.c. for the boring registration stuff check some recent addition like 8f26ebde14132da9b2d19ff691f75850c99de6d3 (asdr)
[00:43:11] <JEEB> your filter code file/Makefile/allfilters
[00:45:23] *** Quits: durandal_1707 (~computer@212.15.178.15) (Read error: Connection reset by peer)
[00:45:28] *** Quits: Seirdy (~Seirdy@sourcehut/user/seirdy) (Quit: exiting 3.2)
[00:46:03] *** Joins: Seirdy (~Seirdy@sourcehut/user/seirdy)
[00:48:41] *** Joins: taupiqueur (~taupiqueu@lmontsouris-659-1-2-186.w193-248.abo.wanadoo.fr)
[00:55:59] *** Quits: blaze (~blaze@user/blaze) (Quit: WeeChat 3.3)
[01:05:29] *** Quits: Aelius (~Aelius@user/aelius) (Quit: quit)
[01:06:58] *** Joins: Aelius (~Aelius@user/aelius)
[01:08:17] <GenTooMan> thanks JEEB I'll see what I can do with that information.
[01:13:23] *** Joins: wyatt8740 (~wyatt8740@192.145.119.194)
[01:26:31] *** Quits: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua) (Quit: Konversation terminated!)
[01:34:41] *** another is now known as another|
[01:35:56] *** Quits: palasso (~palasso@user/palasso) (Quit: I am not a quitter!)
[01:45:08] *** Quits: Volgaar (~volgaar@104.66.13.93.rev.sfr.net) (Quit: WeeChat 3.3)
[01:48:12] *** Quits: vqueiroz (uid340368@id-340368.hampstead.irccloud.com) (Quit: Connection closed for inactivity)
[01:50:55] *** Quits: Buster_ (~Buster@46.160.36.66) (Ping timeout: 252 seconds)
[01:51:29] *** Joins: anotheruser (~user@45.130.83.111)
[01:55:10] *** Quits: someuser (~user@41.239.8.171) (Ping timeout: 265 seconds)
[02:07:51] *** Joins: vqueiroz (uid340368@id-340368.hampstead.irccloud.com)
[02:18:35] *** Quits: cosimone (~user@2001:b07:ae5:db26:a7aa:8027:6b4e:2fb3) (Quit: ERC (IRC client for Emacs 27.1))
[02:25:57] *** Quits: zumba_addict (~zumba_add@c-71-194-58-34.hsd1.il.comcast.net) (Quit: Client closed)
[02:40:05] <gonewest818[m]> I have a quicktime .mov encoded with ffmpeg, and it contains a 2-pop tone that should be exactly 1 frame long and 2 seconds before start of picture.  However, when our assistant editor imports this clip into Adobe Premiere Pro the 2-pop is offset roughly 1/2 frame early...   In Davinci Resolve and other apps the 2-pop lands in the right place.  My first guess is this has to do with edit list metadata in that quicktime file, and Premiere
[02:40:06] <gonewest818[m]> specifically interpreting that edit list differently.  Can ffmpeg or ffprobe dump the edit list in a format I can debug?
[02:49:04] *** Joins: Yonle (~Yonle@user/yonle)
[02:53:01] *** Quits: auth (~auth@user/auth) (Ping timeout: 245 seconds)
[02:53:11] *** Quits: Jerrrk (~Jerrk@45.83.220.203) (Remote host closed the connection)
[02:58:31] *** Quits: waleee (~waleee@h-98-128-228-119.na.cust.bahnhof.se) (Ping timeout: 252 seconds)
[03:03:33] *** Joins: stkrdknmibalz (~test@rrcs-75-87-43-228.sw.biz.rr.com)
[03:03:34] *** Quits: iive (~iive@87.119.101.204.client.entry.bg) (Quit: They came for me...)
[03:26:19] *** Joins: Nact (~l@2a02:2788:11c4:6e6:da42:e753:215e:64e)
[03:29:25] *** Quits: taupiqueur (~taupiqueu@lmontsouris-659-1-2-186.w193-248.abo.wanadoo.fr) (Ping timeout: 265 seconds)
[03:31:50] *** Joins: eschie (~eschie@c-73-202-75-58.hsd1.ca.comcast.net)
[03:32:01] <eschie> Hi all.  Is there a way to offset hls
[03:32:09] <eschie> 's "var_stream_map
[03:32:44] <eschie> " index id?  i'm trying to encode further variant streams, and want to start at the last index position
[03:40:02] *** Joins: taupiqueur (~taupiqueu@lmontsouris-659-1-2-186.w193-248.abo.wanadoo.fr)
[03:41:39] *** Joins: MrZeus__ (~MrZeus@81.92.206.10)
[03:45:06] *** Quits: MrZeus_ (~MrZeus@2a02:c7f:a0aa:4400:6411:e698:ffda:67e3) (Ping timeout: 245 seconds)
[03:46:10] *** Joins: feiw (~Fei.Wang@192.55.46.52)
[03:54:04] *** Joins: lexano (~lexano@cpe00e06722f0e4-cm98524a70e35e.cpe.net.cable.rogers.com)
[04:02:22] *** Quits: taupiqueur (~taupiqueu@lmontsouris-659-1-2-186.w193-248.abo.wanadoo.fr) (Ping timeout: 252 seconds)
[04:05:40] *** Quits: MrZeus__ (~MrZeus@81.92.206.10) (Ping timeout: 252 seconds)
[04:06:34] *** Quits: itsalexjones (~itsalexjo@82.4.99.241) (Quit: Leaving)
[04:09:33] <Vall> JEEB: sorry for the delay in getting back to you... little emergency came up
[04:09:45] *** Quits: Yonle (~Yonle@user/yonle) (Quit: Client Exit)
[04:10:01] *** Joins: Yonle (~Yonle@user/yonle)
[04:11:38] <Vall> JEEB: here are the output of the commands you suggested: https://termbin.com/sbxb
[04:12:24] <Vall> JEEB: the way I interpret it, seems `vainfo` is by default engaging the NVidia driver, which indeed has no VAProfileHEVCMain
[04:13:29] <Vall> When I set the envvar to make it engage the i965, it fails with "libva error: /usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so init failed"
[04:13:48] <Vall> And when I set it to engage with iHD, all goes well (apparently)
[04:14:51] *** Quits: aleek (~aleeksand@185-244-96-87-rev.logitus.pl) (Ping timeout: 265 seconds)
[04:16:11] <Vall> I think I should be using i965, right (for best HEVC hw encoding on my machine, which is a Xeon Skylake)?
[04:17:28] <Vall> If so, seems it isn't working because something in the driver is b0rked
[04:17:38] <Vall> How can I debug this further?
[04:18:20] <Vall> I already checked the file and it seems good to me: -rw-r--r-- 1 root root  8118808 Mar 20  2018 /usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so
[04:18:38] <Vall> /usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, BuildID[sha1]=ce55ebeb4a067850f0ff656591b411a141a58303, stripped
[04:18:46] <Vall> What could be wrong?
[04:26:44] *** Quits: lexano (~lexano@cpe00e06722f0e4-cm98524a70e35e.cpe.net.cable.rogers.com) (Remote host closed the connection)
[04:28:11] <softworkz> you should use the iHD driver. i965 is old and only useful for older CPUs or in case of problems with iHD
[04:30:18] *** Quits: vlm (~vlm@user/vlm) (Quit: "")
[04:33:51] *** Joins: softworkz_ (~softworkz@user/softworkz)
[04:33:51] *** Quits: softworkz (~softworkz@user/softworkz) (Killed (calcium.libera.chat (Nickname regained by services)))
[04:33:51] *** softworkz_ is now known as softworkz
[04:34:29] *** Joins: vlm (~vlm@user/vlm)
[04:38:12] *** Quits: vqueiroz (uid340368@id-340368.hampstead.irccloud.com) (Quit: Connection closed for inactivity)
[04:54:37] *** Quits: realies (~realies@user/realies) (Ping timeout: 252 seconds)
[04:55:31] *** Quits: alphalpha (~michael@dslb-088-076-138-235.088.076.pools.vodafone-ip.de) (Remote host closed the connection)
[04:55:55] *** Joins: alphalpha (~michael@dslb-088-076-138-235.088.076.pools.vodafone-ip.de)
[04:59:01] *** Quits: keypusher (keypusher@user/keypusher) (Ping timeout: 268 seconds)
[05:01:17] *** Joins: keypusher (keypusher@user/keypusher)
[05:04:10] *** Quits: meinside (uid24933@helmsley.irccloud.com) (Ping timeout: 260 seconds)
[05:04:10] *** Quits: raytiley (sid13397@hampstead.irccloud.com) (Ping timeout: 260 seconds)
[05:04:10] *** Quits: woky (~woky@li1651-31.members.linode.com) (Ping timeout: 260 seconds)
[05:04:21] *** Joins: raytiley (sid13397@id-13397.hampstead.irccloud.com)
[05:04:42] *** Joins: woky (~woky@li1651-31.members.linode.com)
[05:05:20] *** Quits: jkqxz (~mrt@jkqxz.net) (Ping timeout: 260 seconds)
[05:05:20] *** Quits: spaam (johan@i19.se) (Ping timeout: 260 seconds)
[05:05:23] *** Joins: meinside (uid24933@id-24933.helmsley.irccloud.com)
[05:05:27] *** Joins: spaam (johan@i19.se)
[05:05:28] *** Joins: jkqxz (~mrt@jkqxz.net)
[05:10:26] *** Joins: Jerrk (~Jerrk@45.83.220.203)
[05:20:07] *** Joins: realies (~realies@user/realies)
[05:34:20] *** Quits: Mister_Magister (~Mister_Ma@user/mister-magister/x-2636733) (Read error: Connection reset by peer)
[05:34:41] *** Joins: Mister_Magister (~Mister_Ma@user/mister-magister/x-2636733)
[05:42:46] *** Quits: Axiomatik (~Axiomatik@83-91-97-60-cable.dk.customer.tdc.net) (Ping timeout: 260 seconds)
[06:01:40] <haihao> Vall: please identify which dri device (/dev/dri/renderDxxx) is your Intel HW, then you may run 'vainfo --display drm --device <your Intel HW>'
[06:19:10] *** Quits: jos1 (~jos3@dyndsl-095-033-174-250.ewe-ip-backbone.de) (Ping timeout: 260 seconds)
[06:32:23] *** Joins: jos1 (~jos3@dyndsl-091-096-039-243.ewe-ip-backbone.de)
[06:56:25] *** Quits: l4yer (~l4yer@159.48.55.9) (Ping timeout: 265 seconds)
[07:05:41] *** Joins: listenurs (~igloo@c-98-240-233-64.hsd1.mn.comcast.net)
[07:06:08] *** Parts: listenurs (~igloo@c-98-240-233-64.hsd1.mn.comcast.net) (Igloo IRC: https://iglooirc.com)
[07:09:20] *** Quits: alphalpha (~michael@dslb-088-076-138-235.088.076.pools.vodafone-ip.de) (Ping timeout: 265 seconds)
[07:09:58] *** Joins: alphalpha (~michael@dslb-178-009-200-117.178.009.pools.vodafone-ip.de)
[07:12:32] *** Joins: deetwelve (~deetwelve@user/deetwelve)
[07:16:06] *** Joins: skybl[m] (~skyblmatr@2001:470:69fc:105::1:173b)
[07:18:41] *** Quits: meepmeep (meepmeep@end.of.cylind.re) (Quit: Yippee-kay-yay)
[07:18:51] *** Joins: meepmeep (meepmeep@end.of.cylind.re)
[07:20:51] *** Quits: milkt (~debian@gateway/tor-sasl/milkt) (Ping timeout: 276 seconds)
[07:23:25] *** Joins: milkt (~debian@gateway/tor-sasl/milkt)
[07:23:26] *** Joins: l4yer (~l4yer@159.48.55.9)
[07:24:50] *** Quits: feiw (~Fei.Wang@192.55.46.52) (Remote host closed the connection)
[07:49:47] *** Quits: arcatech (~arcatech@user/arcatech) (Quit: Bye.)
[08:11:11] *** Bertl_oO is now known as Bertl_zZ
[08:15:02] *** Joins: feiw (~Fei.Wang@192.102.204.53)
[08:17:13] <skybl[m]> good evening. I would like to know why ffmpeg takes very long to export a single frame from a stream of data from stdin when it takes almost no time to export from a file. How can I make it much faster
[08:17:14] <skybl[m]> * much faster?
[08:24:45] *** Quits: betelgeuse (~betelgeus@94-225-47-8.access.telenet.be) (Quit: The Lounge - https://thelounge.chat)
[08:26:07] *** Joins: betelgeuse (~betelgeus@94-225-47-8.access.telenet.be)
[08:30:16] <hyrcanus> idk
[08:30:37] <skybl[m]> okay, thanks
[08:31:17] <hyrcanus> try a different format, idk
[08:31:56] <skybl[m]> i'm using h264 over rtsp, it's in mpegts format over stdin
[08:33:16] <hyrcanus> you're on [m]. why
[08:33:46] <skybl[m]> ...because I use matrix most of the time?
[08:33:58] <skybl[m]> by the way, here is my full setup
[08:34:00] * skybl[m] uploaded an image: (41KiB) < https://libera.ems.host/_matrix/media/r0/download/matrix.org/nUadPKMMpdiXDdmKoXMiBelE/image.png >
[08:34:09] <skybl[m]> wrong screenshot
[08:34:17] * skybl[m] uploaded an image: (20KiB) < https://libera.ems.host/_matrix/media/r0/download/matrix.org/tyuFadZsCYodsOQpSEeWRKOl/Screenshot_20211011_223235.png >
[08:34:18] <skybl[m]> here it is
[09:30:19] <hyrcanus> one hand on the ground ... one hand in space
[09:32:50] *** Quits: blb (~blb@user/blb) (Ping timeout: 260 seconds)
[09:34:01] *** Quits: Seirdy (~Seirdy@sourcehut/user/seirdy) (Ping timeout: 252 seconds)
[09:40:01] *** Joins: Seirdy (~Seirdy@sourcehut/user/seirdy)
[09:50:42] *** Quits: eschie (~eschie@c-73-202-75-58.hsd1.ca.comcast.net) (Quit: Client closed)
[09:52:47] *** Joins: softworkz_ (~softworkz@user/softworkz)
[09:52:47] *** softworkz is now known as Guest5604
[09:52:47] *** Quits: Guest5604 (~softworkz@user/softworkz) (Killed (molybdenum.libera.chat (Nickname regained by services)))
[09:52:47] *** softworkz_ is now known as softworkz
[10:02:48] *** Joins: palasso (~palasso@user/palasso)
[10:04:38] *** Quits: l4yer (~l4yer@159.48.55.9) (*.net *.split)
[10:04:38] *** Quits: deetwelve (~deetwelve@user/deetwelve) (*.net *.split)
[10:04:38] *** Quits: Mister_Magister (~Mister_Ma@user/mister-magister/x-2636733) (*.net *.split)
[10:04:38] *** Quits: realies (~realies@user/realies) (*.net *.split)
[10:04:38] *** Quits: Jerrk (~Jerrk@45.83.220.203) (*.net *.split)
[10:04:38] *** Quits: anotheruser (~user@45.130.83.111) (*.net *.split)
[10:04:38] *** Quits: Aelius (~Aelius@user/aelius) (*.net *.split)
[10:04:39] *** Quits: af (~af@awalgarg.me) (*.net *.split)
[10:04:39] *** Quits: Jan\ (~kvirc@104.204.200.116) (*.net *.split)
[10:04:39] *** Quits: witchcraft (~witch@user/witch) (*.net *.split)
[10:04:39] *** Quits: darkapex_ (~darkapex@user/darkapex) (*.net *.split)
[10:04:39] *** Quits: nillyhan (~00000000@user/nillyhan) (*.net *.split)
[10:04:39] *** Quits: hyrcanus (~hyrcanus@p2e5ae5e8.dip0.t-ipconnect.de) (*.net *.split)
[10:04:39] *** Quits: nitram (~nitram@superblob.com) (*.net *.split)
[10:04:39] *** Quits: ___Myst___ (~Myst@net-93-65-242-136.cust.vodafonedsl.it) (*.net *.split)
[10:04:39] *** Quits: nd (~nd@user/nd) (*.net *.split)
[10:04:39] *** Quits: foonix (1004@ip-86-49-65-192.net.upcbroadband.cz) (*.net *.split)
[10:04:39] *** Quits: intrac (~intracube@user/intracube) (*.net *.split)
[10:04:39] *** Quits: benbrown (~benbrown@user/benbrown) (*.net *.split)
[10:04:39] *** Quits: hendry (~hendry@210.23.22.2) (*.net *.split)
[10:04:39] *** Quits: Freneticks (~Frenetick@gw.ptr-80-238-209-252.customer.ch.netstream.com) (*.net *.split)
[10:04:39] *** Quits: Bertl_zZ (herbert@irc.13thfloor.at) (*.net *.split)
[10:04:39] *** Quits: lullerhaus (SAI@aws.imelik.info) (*.net *.split)
[10:04:39] *** Quits: edenist (~edenist@rdns.robotprofessor.net) (*.net *.split)
[10:04:39] *** Quits: unlord (~nathan@c-76-114-254-99.hsd1.va.comcast.net) (*.net *.split)
[10:04:39] *** Quits: chowbok (~quassel@207.181.244.106) (*.net *.split)
[10:04:39] *** Quits: markvandenborre (~mark@static.88.183.119.168.clients.your-server.de) (*.net *.split)
[10:04:39] *** Quits: TSaari (~tsaari@user/tsaari) (*.net *.split)
[10:04:39] *** Quits: Buliarou1 (~gypsydang@185.207.166.57) (*.net *.split)
[10:04:39] *** Quits: PocketKiller (PacKetIV@user/packetiv) (*.net *.split)
[10:04:39] *** Quits: [R]x (~Positive@user/rx/x-1245542) (*.net *.split)
[10:06:50] *** Joins: af (~af@awalgarg.me)
[10:12:56] *** Quits: af (~af@awalgarg.me) (Ping timeout: 246 seconds)
[10:13:51] *** Joins: af (~af@awalgarg.me)
[10:19:25] *** Quits: af (~af@awalgarg.me) (Ping timeout: 265 seconds)
[10:23:30] *** Joins: nillyhan (~00000000@user/nillyhan)
[10:26:26] *** Joins: l4yer (~l4yer@159.48.55.9)
[10:26:26] *** Joins: deetwelve (~deetwelve@user/deetwelve)
[10:26:26] *** Joins: Mister_Magister (~Mister_Ma@user/mister-magister/x-2636733)
[10:26:26] *** Joins: realies (~realies@user/realies)
[10:26:26] *** Joins: Jerrk (~Jerrk@45.83.220.203)
[10:26:26] *** Joins: anotheruser (~user@45.130.83.111)
[10:26:26] *** Joins: Aelius (~Aelius@user/aelius)
[10:26:26] *** Joins: Jan\ (~kvirc@104.204.200.116)
[10:26:26] *** Joins: witchcraft (~witch@user/witch)
[10:26:26] *** Joins: darkapex_ (~darkapex@user/darkapex)
[10:26:26] *** Joins: hyrcanus (~hyrcanus@p2e5ae5e8.dip0.t-ipconnect.de)
[10:26:26] *** Joins: nitram (~nitram@superblob.com)
[10:26:26] *** Joins: ___Myst___ (~Myst@net-93-65-242-136.cust.vodafonedsl.it)
[10:26:26] *** Joins: nd (~nd@user/nd)
[10:26:26] *** Joins: foonix (1004@ip-86-49-65-192.net.upcbroadband.cz)
[10:26:26] *** Joins: intrac (~intracube@user/intracube)
[10:26:26] *** Joins: benbrown (~benbrown@user/benbrown)
[10:26:26] *** Joins: hendry (~hendry@210.23.22.2)
[10:26:26] *** Joins: Freneticks (~Frenetick@gw.ptr-80-238-209-252.customer.ch.netstream.com)
[10:26:26] *** Joins: Bertl_zZ (herbert@irc.13thfloor.at)
[10:26:26] *** Joins: lullerhaus (SAI@aws.imelik.info)
[10:26:26] *** Joins: edenist (~edenist@rdns.robotprofessor.net)
[10:26:26] *** Joins: unlord (~nathan@c-76-114-254-99.hsd1.va.comcast.net)
[10:26:26] *** Joins: chowbok (~quassel@207.181.244.106)
[10:26:26] *** Joins: markvandenborre (~mark@static.88.183.119.168.clients.your-server.de)
[10:26:26] *** Joins: TSaari (~tsaari@user/tsaari)
[10:26:26] *** Joins: Buliarou1 (~gypsydang@185.207.166.57)
[10:26:26] *** Joins: PocketKiller (PacKetIV@user/packetiv)
[10:26:26] *** Joins: [R]x (~Positive@user/rx/x-1245542)
[10:27:48] *** Joins: durandal_1707 (~computer@95.168.116.127)
[10:28:45] *** Quits: l4yer (~l4yer@159.48.55.9) (Max SendQ exceeded)
[10:29:09] *** Joins: l4yer (~l4yer@159.48.55.9)
[10:31:49] *** Joins: milkt_ (~debian@gateway/tor-sasl/milkt)
[10:31:52] *** Quits: milkt (~debian@gateway/tor-sasl/milkt) (Remote host closed the connection)
[10:34:09] *** Joins: icecoffee (~fruti@125.163.253.12)
[10:48:26] *** Joins: blb (~blb@user/blb)
[10:52:42] *** Joins: af (~af@awalgarg.me)
[10:54:28] *** Joins: cosimone (~user@151.14.38.15)
[10:58:07] *** Quits: af (~af@awalgarg.me) (Ping timeout: 252 seconds)
[10:59:55] *** Joins: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua)
[11:00:52] *** Joins: auth (~auth@user/auth)
[11:04:56] *** Joins: af (~af@awalgarg.me)
[11:11:57] *** Joins: cmp88 (~cmp@lputeaux-658-1-177-87.w92-154.abo.wanadoo.fr)
[11:19:11] *** Quits: AbleBacon (~AbleBacon@user/AbleBacon) (Read error: Connection reset by peer)
[11:23:38] *** Joins: furrymcgee (~devuan@cgn-89-1-209-32.nc.de)
[11:27:16] *** Quits: af (~af@awalgarg.me) (Ping timeout: 252 seconds)
[11:29:05] *** Joins: kib (~kib@user/kib)
[11:29:41] <Vall> haihao: by 'your dri device' I think you mean what I pass on to ffmpeg via `-vaapi_device` option... in this case, it's /dev/dri/renderD128
[11:30:59] <Vall> haihao: here's the output: https://termbin.com/tzdy
[11:33:07] <Vall> oops
[11:33:10] <Vall> that was iHD
[11:34:05] <Vall> here's i965: https://termbin.com/yowy
[11:40:04] *** Joins: af (~af@awalgarg.me)
[11:41:01] *** Joins: thebombzen_ (~thebombze@c-68-41-54-207.hsd1.mi.comcast.net)
[11:41:04] *** Quits: thebombzen (~thebombze@c-68-41-54-207.hsd1.mi.comcast.net) (Ping timeout: 252 seconds)
[11:43:15] *** Joins: Volgaar (~volgaar@104.66.13.93.rev.sfr.net)
[11:50:40] <aphysically> softworkz: iHD and i965 encoder support in ffmpeg don't completely overlap quality wise and even support wise last I checked
[11:51:07] <aphysically> I think you generally want i965 if you're encoding since iHD hasn't implemented everything yet
[11:52:16] <aphysically> although this was on a CPU that's a couple years old now (9900K)
[11:53:48] * aphysically needs to figure out using nv-codec-headers from source instead of system package tomorrow
[11:54:00] <aphysically> can try out the new encoding options
[11:54:14] *** Quits: nillyhan (~00000000@user/nillyhan) (Ping timeout: 260 seconds)
[11:56:32] <Vall> aphysically: you probably meant to highlight me (Vall) and not softworkz, right?
[11:57:02] <aphysically> nah I was responding to soft from like ~5 hours ago :P
[11:58:21] *** Joins: cosimone` (~user@5.170.240.249)
[11:59:43] *** Quits: cosimone (~user@151.14.38.15) (Ping timeout: 252 seconds)
[12:00:01] *** Joins: oops (~oops@2409:8a62:3c19:9590:8575:15d:f559:d2b)
[12:00:31] <oops> how to convert m3u8 file to mp4,
[12:01:59] *** Joins: nillyhan (~00000000@user/nillyhan)
[12:03:19] <oops> i using command : ffmpeg -i sample.m3u8 -vcodec copy -acodec copy sample.mp4,  then error happen , the error prompt like this;https://paste.centos.org/view/5beb7dad
[12:05:00] <haihao> Vall: You may use iHD if it works for you. I'm curious that you are using iHD with /dev/dri/renderD128 but i965 with /dev/dri/renderD129.
[12:07:13] <haihao> Is /dev/dri/renderD129 your Intel HW ?
[12:07:47] <haihao> could you post the output of `lspci -nn | grep VGA`
[12:16:41] *** Quits: durandal_1707 (~computer@95.168.116.127) (Read error: No route to host)
[12:18:36] *** Joins: cosimone (~user@151.14.38.15)
[12:19:16] *** Joins: Blacker47 (~Blacker47@user/blacker47)
[12:21:42] *** Quits: cosimone` (~user@5.170.240.249) (Ping timeout: 265 seconds)
[12:22:53] *** Joins: hardcoresushi (~hardcores@37.164.97.185)
[12:23:23] *** Quits: hardcoresushi (~hardcores@37.164.97.185) (Client Quit)
[12:41:03] <Vall> aphysically: OllKey ;-)
[12:41:49] <Vall> haihao: /dev/dri/renderD128 and /dev/dri/renderD129 gets switched around a lot here. Sometimes one of them works, sometimes the other.
[12:43:21] <Vall> I'm a total ignorant on those matters, until a few days ago I just used a recipe that worked well for me, then I switched to a new camera and the results went downhill quality-wise and I started poking around, including joining this channel
[12:44:06] <Vall> "those matters" -> ffmpeg and video encoding in general. I know my way around Unix generically and Linux specifically.
[12:45:19] <Vall> Just so you have an idea, I didn't even knewn about iHD vs i965 until yesterday ;-)
[12:46:06] <Vall> anyway, /dev/dri/renderD129 seems to be my i965 hardware, and /dev/dri/renderD128 definitely is the iHD according to the output I posted above
[12:47:08] <Vall> Here's the `lspci -nn | grep VGA` output you requested:
[12:47:16] <Vall> 00:02.0 VGA compatible controller [0300]: Intel Corporation HD Graphics P630 [8086:591d] (rev 04)
[12:47:19] <Vall> 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GP104GLM [Quadro P5000 Mobile] [10de:1bb6] (rev a1)
[12:47:33] <Vall> But i965 at least is handled in the CPU, no?
[12:47:46] <BtbN> "handled in the CPU"?
[12:47:56] <BtbN> It's a GPU, that's on the same die as your CPU.
[12:49:49] <Vall> BtbN: hummrmr when people said "Skylake has hardware encoding for X265" I was thought they meant the CPU and not the GPU
[12:51:01] <Vall> I mean, Skylake is supposed to refer to a CPU Microarchitecture, not a GPU: https://en.wikipedia.org/wiki/Skylake_(microarchitecture)
[12:51:15] <BtbN> x265 does not support any hardware acceleration
[12:51:21] <BtbN> It's a dedicated hardware encoder
[12:51:37] *** Quits: oops (~oops@2409:8a62:3c19:9590:8575:15d:f559:d2b) (Quit: Leaving)
[12:51:58] <BtbN> Every Intel-Generation since Sandy Bridge has a GPU
[12:52:00] <BtbN> so, yes it does
[12:52:11] <Vall> heh
[12:52:20] <BtbN> or rather, yes it is
[12:52:43] <Vall> From the wikipedia article I myself referred to above: "The integrated GPU of Skylake's S variant supports on Windows DirectX 12 Feature Level 12_1, OpenGL 4.6 with latest Windows 10 driver update[64] (OpenGL 4.5 on Linux[65]) and OpenCL 3.0 standards, as well as some modern hardware video encoding/decoding formats such as VP9 (GPU accelerated decode only), VP8 and HEVC (hardware accelerated 8-bit encode/decode and GPU accelerated 10-bit decode).[66][67]
[12:53:25] <Vall> I miss the goode-olde PDP-11/70 times... Things used to be simpler by them ;-)
[12:53:36] <Vall> OTOH, there were no action cameras ;-)
[12:54:02] <BtbN> I see no contradiction there?
[12:54:32] <Vall> BtbN: I meant to say it supports what you're stating, to my big surprise
[12:57:49] <BtbN> Can't really stick a CPU and GPU on the same die and not have their generations tightly coupled
[13:06:15] *** Joins: fluffy_unicorn (~fluffy_un@37.164.97.185)
[13:06:58] <fluffy_unicorn> Hi, can I ask for code debugging help here ?
[13:07:28] <furrymcgee> just ask
[13:09:35] <fluffy_unicorn> OK, I try to set video rotation when muxing with libavformat but it's not set in the metadata field (checked with ffprobe). Here is the code: https://forge.chapril.org/hardcoresushi/DroidFS/src/branch/video-rotation/app/src/main/native/libmux.c#L83
[13:13:13] *** Joins: taupiqueur (~taupiqueu@lmontsouris-659-1-2-186.w193-248.abo.wanadoo.fr)
[13:14:56] *** Quits: witchcraft (~witch@user/witch) (Remote host closed the connection)
[13:15:20] *** Joins: witchcraft (~witch@88-106-211-54.dynamic.dsl.as9105.com)
[13:15:20] *** Quits: witchcraft (~witch@88-106-211-54.dynamic.dsl.as9105.com) (Changing host)
[13:15:20] *** Joins: witchcraft (~witch@user/witch)
[13:23:07] <furrymcgee> check return value?
[13:24:34] <fluffy_unicorn> furrymcgee, I did it, it's 0
[13:26:39] <JEEB> rotation has a proper side data field nowadays
[13:26:46] *** Quits: Nact (~l@2a02:2788:11c4:6e6:da42:e753:215e:64e) (Quit: Konversation terminated!)
[13:27:07] <JEEB> depends on the exact input/output what used to/works atm
[13:27:13] <JEEB> I did not look at your code yet
[13:27:32] <BtbN> My immediate guess would be that it has to be a string
[13:27:40] <BtbN> No idea if that's converted internally
[13:28:16] <BtbN> I see no explicit mention of "rotate" in the movenc code, and the only generic looking code is grabbing strings
[13:28:32] <JEEB> AV_PKT_DATA_DISPLAYMATRIX
[13:28:40] <JEEB> is what is utilized for rotation in various things
[13:28:48] <JEEB> setting that to the AVStream
[13:28:56] <BtbN> But does the rotate= metadata end up in that?
[13:29:18] <JEEB> no, I'm just checking what the common thing in lavf is right now
[13:29:39] <JEEB> there's no entries of "rotate" in lavf at all
[13:30:30] *** Joins: nillyhan6 (~00000000@user/nillyhan)
[13:30:32] <JEEB> only ffmpeg.c seems to have the // hand, the legacy API makes demuxers set "rotate" metadata entries
[13:30:51] <JEEB> but rotate as a string is not a thing in lavf
[13:31:30] *** Joins: demon__ (~user@45.130.83.111)
[13:31:30] *** Quits: anotheruser (~user@45.130.83.111) (Read error: Connection reset by peer)
[13:32:22] <JEEB> yea the rotate metadata entry was deprecated in 2017 apparently
[13:32:32] <JEEB> and relatively recently removed I presume
[13:32:40] *** Quits: nillyhan (~00000000@user/nillyhan) (Ping timeout: 252 seconds)
[13:32:40] *** nillyhan6 is now known as nillyhan
[13:32:54] <JEEB> doc/APIchanges-2017-03-27 - ddef3d902f - lavf 57.68.100 - avformat.h
[13:32:57] <JEEB> contains it
[13:33:52] <JEEB> and then in ffprobe it should list the display matrix
[13:34:32] <fluffy_unicorn> So what sould I do to set correct rotation ?
[13:34:47] <JEEB> av_stream_new_side_data with AV_PKT_DATA_DISPLAYMATRIX, and then av_display_rotation_set for that I guess?
[13:34:57] <JEEB> check the docs for av_display_rotation_set
[13:35:10] <fluffy_unicorn> JEEB, thanks, I will try this
[13:35:36] <JEEB> also I do wonder if there's no proper helper for this, ffmpeg.c just utilizes sizeof(int32_t) * 9 as the third argument which is lolwut
[13:35:47] <JEEB> (for the av_stream_new_side_data)
[13:36:28] <BtbN> It's a 3x3 matrix, so 9 somewhat makes sense
[13:36:31] *** Quits: Aelius (~Aelius@user/aelius) (Ping timeout: 252 seconds)
[13:39:32] *** Joins: Aelius (~Aelius@user/aelius)
[13:41:00] <JEEB> BtbN: yea I mean in general there are helpers so that you don't need to know the sizeof
[13:41:16] <JEEB> you just say "I want to have side data of type X"
[13:41:20] <JEEB> I guess in this case it doesn't exist
[13:45:14] <fluffy_unicorn> JEEB, it works !!! thanks a lot :)
[13:47:24] <JEEB> nice
[13:47:45] <JEEB> side data is nicer than just plain metadata strings as they're typed etc :)
[13:47:56] <JEEB> and you can know the meaning of them from the type
[13:50:47] <Vall> JEEB: here are the output of the commands you suggested: https://termbin.com/sbxb
[13:50:48] <fluffy_unicorn> Yeah, I was just following code from https://crates.io/crates/ac-ffmpeg
[13:50:50] <Vall> JEEB: the way I interpret it, seems `vainfo` is by default engaging the NVidia driver, which indeed has no VAProfileHEVCMain
[13:50:53] <Vall> When I set the envvar to make it engage the i965, it fails with "libva error: /usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so init failed"
[13:50:56] <Vall> And when I set it to engage with iHD, all goes well (apparently)
[13:50:58] <Vall> I think I should be using i965, right (for best HEVC hw encoding on my machine, which is a Xeon Skylake)?
[13:51:01] <Vall> If so, seems it isn't working because something in the driver is b0rked
[13:51:04] <Vall> How can I debug this further?
[13:51:06] <Vall> I already checked the file and it seems good to me: -rw-r--r-- 1 root root  8118808 Mar 20  2018 /usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so
[13:51:10] <Vall> usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, BuildID[sha1]=ce55ebeb4a067850f0ff656591b411a141a58303, stripped
[13:51:14] <Vall> So, what could be wrong?
[13:55:07] *** Quits: furrymcgee (~devuan@cgn-89-1-209-32.nc.de) (Quit: leaving)
[13:56:04] <JEEB> you probably need to specify it the DRM device specifically if the i965 driver just attempts to load whatever you have?
[13:56:15] <JEEB> you can check with strace or something when running vainfo which file it tries to open
[14:08:58] <Vall> JEEB: it's quite clear from the output (or at least I think so) that vainfo is using the i965 driver, and it is failing ("libva error: /usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so init failed").
[14:09:21] <Vall> But the only message after that says "libva info: va_openDriver() returns -1
[14:09:50] <Vall> So I'm at a loss trying to understand *why* it's failing and how to fix it.
[14:11:08] <BtbN> Just uninstall that vaapi vdpau wrapper
[14:11:10] <BtbN> it's horrible
[14:12:38] <BtbN> Does that nvidia GPU not support nvenc though?
[14:15:03] <Vall> strace on vainfo doesn't seem to show anything relevant, at least to my ignorant eyes: https://termbin.com/slia
[14:15:35] <BtbN> What are you even looking for in there?
[14:15:58] <Vall> BtbN: JEEB suggested I look at it and try to see what's failing
[14:16:08] <Vall> (see above)
[14:16:14] <BtbN> well, looks like the i965 driver is failing for some reason
[14:17:11] <Vall> BtbN: I can see that ;-) and in its init function, no less ;-)
[14:17:26] <Vall> BtbN: the question is, why is it failing? And how to fix it?
[14:17:53] <Vall> (I'm sincerelly apalled at how little info these things log when stuff goes wrong)
[14:17:54] <BtbN> Does it matter, as long as the iHD works?
[14:18:06] <BtbN> If I had to guess, it's probably trying to talk to the Nvidia-GPU
[14:18:18] <Vall> uh?
[14:18:47] <Vall> You mean, the i965 driver is trying to talk to the nvidia GPU? why in heck?
[14:19:21] <BtbN> Are you using nouveau, or the proprietary driver?
[14:19:35] <Vall> and unfortunatelly ffmpeg isn't working with the iHD driver at all, see here: https://termbin.com/cv5x
[14:19:47] <Vall> BtbN: the proprietary driver
[14:19:57] <BtbN> Do you have the nvidia drm module loaded?
[14:20:04] <Vall> (last time I checked, nouveau simply didn't cut it)
[14:20:12] <Vall> lemme check re: drm module
[14:21:37] <BtbN> With that nvidia GPU in there, if nvenc is not disabled on it, that'd by far be my preferred choice for a hardware encoder.
[14:21:49] <Vall> It seems to be loaded (at least to my ignorant eyes): https://termbin.com/7e1n
[14:22:42] <Vall> BtbN: last time I checked, nvenc was heads-and-shoulders worst than i965 for HEVC encoding. Has this changed?
[14:22:44] <BtbN> So it's possible that the i965 driver for some reason defaults to the nvidia drm device, and obviously fails horrible trying to talk to it
[14:22:55] <BtbN> No idea when you checked that
[14:23:04] <Vall> About 3 years ago ;-)
[14:23:05] <BtbN> pascal nvenc is absolutely fine, specially when using hevc
[14:23:28] <BtbN> Just -preset slow and encode away
[14:24:11] <BtbN> It's no match to what x265 can do, bue neither is the intel hwenc
[14:24:31] <Vall> yep, GPU here is a NVIDIA Corporation GP104GLM [Quadro P5000 Mobile] (rev a1)
[14:25:01] <Vall> I think it should be fine re nvenc, no?
[14:25:35] <BtbN> I'd even expect Pascal nvenc to outperform old intel hwenc
[14:25:55] <BtbN> no idea what current intel GPUs can do, but nvenc is generally considered to be the best hwenc, specially since turing
[14:26:23] <Vall> so, how do I use it? Being a real ignorant klutz in all things video-encoding, I would really appreciate a recipe ;-)
[14:26:24] *** Joins: furrymcgee (~devuan@cgn-89-1-209-32.nc.de)
[14:26:39] <BtbN> a what?
[14:26:47] <BtbN> The nvenc hevc encoder is called hevc_nvenc
[14:27:36] <BtbN> And I'd expect the slow preset to still be plenty fast enough
[14:28:24] <Vall> OK, so OK, so '-c:v:0 hevc_vaapi' becomes '-c:v:0 hevc_nvenc', right?
[14:31:34] <Vall> And what do I specify to '-vaapi_device'? I have just two /dev/dri/renderD*, and none of them seem to be the nVidia GPU (one seems to be i965 and the other, iHD)
[14:36:33] <BtbN> Nothing. nvenc is not vaapi
[14:36:56] <BtbN> If you want to do full hw-transcode, you can set hwaccel and hwaccel_output_device to cuda, and that's it
[14:37:15] <BtbN> would recommend setting -threads 2 as well, to work around weird multithreading interactions
[14:37:26] <Vall> oh man
[14:37:39] <Vall> holy different command, Batman ;-)
[14:38:39] <Vall> Trying to adapt my 'recipe' (meaning, the command I typed without really understanding every detail in it) from vaapi to nvenc
[14:43:05] <Vall> BtbN: here's what I came up with:
[14:43:13] <Vall>     ffmpeg -v verbose -hide_banner -y -nostdin -i "$input_file" -c:v:0 hevc_nvenc  -hwaccel:v:0 cuda -hwaccel_output_device cuda -preset slow -b:v:0 ${nbr}  -maxrate:v:0 ${nbr}  -bufsize:v:0 `expr ${nbr} \* 2` -compression_level 3 -c:a copy "$output_file"
[14:43:24] <Vall> Does that look good to you?
[14:45:14] <Vall> Tried it, aborts with the error "Unrecognized option 'hwaccel_output_device'.
[14:46:51] <Vall> Ommitting '-hwaccel_output_device cuda', then it aborts with "Option hwaccel:v:0 (use HW accelerated decoding) cannot be applied to output url null.mp4 -- you are trying to apply an input option to an output file or vice versa. Move this option before the file it belongs to.
[14:47:13] <Vall> Changed the order of arguments to `ffmpeg -v verbose -hide_banner -y -nostdin -c:v:0 hevc_nvenc  -hwaccel:v:0 cuda -preset slow -i "$f" -b:v:0 ${nbr}  -maxrate:v:0 ${nbr}  -bufsize:v:0 `expr ${nbr} \* 2` -compression_level 3 -c:a copy null.mp4`
[14:47:38] <Vall> And then it aborts with "Unknown decoder 'hevc_nvenc'
[14:47:41] <Vall> :-(
[14:48:39] <Vall> Seems the road to HEVC hardware-encoding Nirvana is filled with a lot of Sansara... :-/
[14:49:46] <BtbN> Most of those options are input options
[14:49:57] <BtbN> And it seems like you got yourself an ffmpeg build without nvenc support
[14:50:03] <Vall> nope
[14:50:25] <BtbN> ah, decoder.
[14:50:31] <BtbN> It's an encoder!
[14:50:42] <Vall> huh?
[14:50:51] <BtbN> you're telling it to decode with hevc_nvenc
[14:50:54] <BtbN> but it's a pure encoder
[14:50:57] <Vall> sure
[14:51:02] <BtbN> just leave the decoder unspecified, the default is fine
[14:51:23] <Vall> I'm trying to see where I speced it as decoder
[14:51:38] <Vall> isn't `-c:v:0 hevc_nvenc` specifying the encoder?
[14:51:58] <BtbN> You're passing it as input option. Then it means decoder.
[14:52:11] <Vall> hummmrmmr
[14:52:28] <BtbN> Every options affects the next input/output after it
[14:52:38] <BtbN> so if you put -c before an input, it specifies the decoder.
[14:54:21] <BtbN> And nvenc has no idea about compression_level
[14:54:37] <BtbN> the preset is the closest thing to it
[14:55:33] *** Bertl_zZ is now known as Bertl
[15:05:20] <Vall> Ok, here's the adjusted command:
[15:07:18] <Vall> ffmpeg -v verbose -hide_banner -y -nostdin -hwaccel:v:0 cuda -c:v:0 hvec_nvenc -preset slow -i "$f" -b:v:0 ${nbr} -maxrate:v:0 ${nbr} -bufsize:v:0 `expr ${nbr} \* 2` -c:a copy null.mp4
[15:07:29] <Vall> And here's its output:
[15:07:31] <BtbN> you're still passing -c:v to -i
[15:07:45] <Vall>   oops
[15:07:47] <Vall> OK
[15:08:14] <BtbN> And I'm not 100% sure if nvenc understands those bitrate arguments, but I _think_ it does
[15:08:48] <BtbN> I'd suggests replacing them entirely with -cq N, where N is an x264/x265 crf like number
[15:08:53] <BtbN> higher = smaller and worse quality
[15:09:03] <Vall> OK
[15:09:04] <Vall> ffmpeg -v verbose -hide_banner -y -nostdin -hwaccel:v:0 cuda -i "$f" -c:v:0 hevc_nvenc -preset slow -b:v:0 ${nbr} -maxrate:v:0 ${nbr} -bufsize:v:0 `expr ${nbr} \* 2` -c:a copy null.mp4
[15:09:10] <Vall> And... it's running!
[15:09:27] <Vall> Speed is ~7x, HOLY COW
[15:09:48] <BtbN> Add -hwaccel_output_format cuda and it should go a bit faster
[15:10:04] <BtbN> Might have to add "-threads 2 -extra_hw_frames 10" though, on the input side
[15:11:52] <Vall> Added `-hwaccel_output_format cuda` right after `-hwaccel:v:0 cuda` and it became a little slower... around ~6.5X
[15:11:56] <Vall> anyway, keeping it
[15:12:09] <BtbN> weird. It removes an entire copy to RAM and back to VRAM
[15:12:15] <BtbN> so it going slower is rather unexpected
[15:13:32] <Vall> changing the "-maxrate:v:0 ${nbr} -bufsize:v:0 `expr ${nbr} \* 2`" part to "-cq 28" (I'm using 28 because that was what I used with `-q` back in the pre-hwenc days)
[15:14:02] <Vall> if `-cq 28` is not the best (I would like something like ~6Mbps) please advise
[15:14:25] <BtbN> You'll have to play around with the value to meet your needs
[15:14:34] <BtbN> The lower, the better quality you get
[15:15:35] <BtbN> But encoders generally perform a better job if you don't constrain them in bitrate, but give a target quality level instead
[15:15:41] <Vall> OK, experimenting... with `-cq 28`, it's bitrating at about 8Mbps
[15:15:54] <Vall> And speed went down to about ~6x
[15:15:58] <hyrcanus> constrain max bitrate only for a good reason
[15:16:19] <hyrcanus> 1) streaming limits 2) cpu decoder limits
[15:16:51] <Vall> `cq 30` goes down to ~4Mbps
[15:17:18] <BtbN> You'll have to give it time to encode the whole file to see the final bitrate
[15:17:23] <BtbN> it can still spike at a later point
[15:17:45] <Vall> OK
[15:17:59] <Vall> encoding the whole file now
[15:18:20] <Vall> Man, I love this ~6x speed ;-)
[15:20:22] <Vall> hyrcanus: I'm not streaming... my main objective is to save HDD space, as I generate about 12h of 1080p30fps video every day
[15:20:52] <hyrcanus> then the maxbitrate generates suboptimal visual quality.  let the algorithm choose.
[15:21:32] <Vall> BtbN: OK, finished with `-cq 30`, here's the final stat lines:
[15:21:33] <Vall> frame=40710 fps=185 q=30.0 Lsize= 1244670kB time=00:22:36.96 bitrate=7514.1kbits/s speed=6.17x
[15:21:36] <Vall> video:1222758kB audio:20767kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.092079%
[15:21:51] *** Quits: nillyhan (~00000000@user/nillyhan) (Ping timeout: 265 seconds)
[15:22:14] <Vall> Trying with `-cq 31` now, to see whether it comes close to my 6Mbps goal
[15:26:16] <Vall> frame=40710 fps=192 q=31.0 Lsize= 1100321kB time=00:22:36.96 bitrate=6642.6kbits/s speed= 6.4x
[15:26:19] <Vall> video:1078408kB audio:20767kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.104172%
[15:26:22] <Vall> So, closer
[15:26:31] <Vall> perhaps `-cq 32` will do the trick
[15:26:47] <BtbN> Is the quality any good though?
[15:28:06] <Vall> I'm aiming at size first, then I will check quality, and if it's not good enough, I will then try to balance between the two
[15:28:24] <Vall> Speed definitely rocks, tho
[15:30:27] <Vall> yeah, `-cq 32` seem to have done it:
[15:30:28] <Vall> frame=40710 fps=199 q=32.0 Lsize=  965350kB time=00:22:36.96 bitrate=5827.8kbits/s speed=6.63x
[15:30:31] <Vall> video:943438kB audio:20767kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.118754%
[15:31:00] <Vall> Checking quality now
[15:35:05] <Vall> Quality is OK, much better than what I was getting with vaapi
[15:35:25] *** Joins: Arifd (~Arifd@2a0c:5a80:360e:fa00:c796:2bd:48ed:1c5e)
[15:39:39] *** Joins: ^-^hi (~nikw@user/-hi/x-1729478)
[15:39:48] *** Quits: Yonle (~Yonle@user/yonle) (Read error: Connection reset by peer)
[15:40:10] <^-^hi> Just asking here since you tend to know more about codecs
[15:41:10] <^-^hi> Is there any codec where you can some parts of a frame in good quality and the rest in less quality?
[15:41:25] <Vall> In case you want to see for yourself:
[15:41:31] <Vall>    Original: https://i.ibb.co/GskZx5H/2021-1004-090300-015-A-ORIGINAL-NORM0015-SAMPLE-FRAME-Screenshot-from-2021-10-10-03-16-55.png
[15:41:49] <hyrcanus> ^-^hi: i'd like to know that also
[15:42:09] *** Joins: Yonle (~Yonle@user/yonle)
[15:42:13] <Vall>     Enc with -cq 32: https://i.ibb.co/nbF8w7k/Screenshot-from-2021-10-12-09-05-42.png
[15:42:20] <^-^hi> I realized that my only problem with 144p is reading text
[15:42:38] <Vall> Some softening on the details, but nothing deal-breaking IMHO
[15:42:51] <hyrcanus> why drop resolution so much, you can drop quality to hit a filesize target ^-^hi
[15:43:01] <Vall> BtbN: any comments on the quality?
[15:43:31] <^-^hi> If there was a program that could compress everything but detect text and keep it well, it would save so much
[15:43:38] <^-^hi> hyrcanus: why not both?
[15:44:25] <^-^hi> What kind of quality do you mean though? It would be probably useful to know.
[15:44:28] <hyrcanus> because the way these codecs work means they can do gradients to a higher target resolution without using more bits
[15:44:44] <hyrcanus> look into how jpeg works for a basis
[15:45:10] <hyrcanus> they don't work pixel-by-pixel
[15:45:17] <^-^hi> Aha, jpeg-ish compressing
[15:45:30] <^-^hi> Wouldn't the artifacts become worse?
[15:45:34] <hyrcanus> well most don't.  huffyuv does.
[15:45:55] *** Quits: fluffy_unicorn (~fluffy_un@37.164.97.185) (Remote host closed the connection)
[15:46:05] <^-^hi> What is huffyuv?
[15:46:37] *** Joins: fluffy_unicorn (~fluffy_un@37.164.97.185)
[15:46:40] <hyrcanus> a codec
[15:48:33] <Vall> OK, so here's my final command:
[15:48:37] <Vall>    ffmpeg -v verbose -hide_banner -y -nostdin -hwaccel:v:0 cuda -hwaccel_output_format cuda -threads 2 -extra_hw_frames 10 -i "$f" -c:v:0 hevc_nvenc -preset slow -cq 32 -c:a copy null.mp4
[15:48:53] <Vall> And its final stat lines after encoding my test file:
[15:49:02] <Vall> frame=40710 fps=199 q=32.0 Lsize=  965350kB time=00:22:36.96 bitrate=5827.8kbits/s speed=6.64x
[15:49:05] <Vall> video:943438kB audio:20767kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.118754%
[15:49:21] <Vall> BtbN: thank you very much for your help, you really made my day
[15:49:59] <Vall> (and I just revised my initial opinion of you: you are not really an a*hole, you just sounded that way at first ;-) )
[15:50:55] <Vall> And if you can offer any comments re: quality on the original vs encoded sample frames I posted above, I will be much obliged.
[15:51:23] <Vall> Now I have to get on the road. See y'all later, in about 10-12 hours I think
[15:57:02] <BtbN> Not much more to comment there. You play with the -cq value until the result satisfies you in quality vs. bitrate
[15:57:23] <BtbN> If you are super motivated, you can break up the slow preset into its components and start ultra fine tuning
[15:57:39] <Vall> kk, thanks again, and have a great one (morning or evening or whatever re: your timezone) ;-)
[15:57:44] * Vall waves
[15:59:06] *** Joins: nillyhan (~00000000@user/nillyhan)
[15:59:56] <BtbN> I think it's something like -preset p7 -multipadd fullres
[16:00:02] <BtbN> *-multipass
[16:08:02] *** Quits: fluffy_unicorn (~fluffy_un@37.164.97.185) (Quit: save RAM)
[16:11:37] *** Quits: nillyhan (~00000000@user/nillyhan) (Ping timeout: 252 seconds)
[16:17:02] *** Joins: listenurs (~igloo@c-98-240-233-64.hsd1.mn.comcast.net)
[16:17:19] *** Quits: milkt_ (~debian@gateway/tor-sasl/milkt) (Quit: leaving)
[16:17:46] *** Joins: milkt (~debian@gateway/tor-sasl/milkt)
[16:17:55] *** Joins: zsoltiv_ (~zsoltiv@fibhost-67-12-35.fibernet.hu)
[16:18:30] *** Quits: kib (~kib@user/kib) (Quit: WeeChat 3.3)
[16:18:39] *** Joins: nillyhan (~00000000@user/nillyhan)
[16:18:55] *** Joins: jkwnki (~jkwnki@p2e57959a.dip0.t-ipconnect.de)
[16:18:55] *** Joins: jkwnki1 (~jkwnki@p2e57959a.dip0.t-ipconnect.de)
[16:27:20] *** Quits: taupiqueur (~taupiqueu@lmontsouris-659-1-2-186.w193-248.abo.wanadoo.fr) (Quit: taupiqueur)
[16:27:35] *** Joins: taupiqueur (~taupiqueu@lmontsouris-659-1-2-186.w193-248.abo.wanadoo.fr)
[16:28:51] *** Quits: jkwnki (~jkwnki@p2e57959a.dip0.t-ipconnect.de) (Ping timeout: 245 seconds)
[16:28:51] *** Quits: jkwnki1 (~jkwnki@p2e57959a.dip0.t-ipconnect.de) (Ping timeout: 245 seconds)
[16:29:27] *** Quits: milkt (~debian@gateway/tor-sasl/milkt) (Ping timeout: 276 seconds)
[16:38:14] <Arifd> Yeah the people here are awesome
[16:39:04] <Arifd> btw I finally figured out how YUYV422 buffers are laid out in data, it's the most engineering/like low-level stuff i've done yet, and i was quickly able to implement to_rgb, v_flip, h_flip, rotate and blend! :D
[16:40:24] <hyrcanus> now do it optimally fast
[16:40:52] <hyrcanus> which reminds me i have to fix 24bpp rendering in an emu
[16:41:59] *** Joins: milkt (~debian@gateway/tor-sasl/milkt)
[16:42:13] *** Joins: kib (~kib@user/kib)
[16:44:59] <Arifd> hahaha yes, I could fold all the operations into one loop, but that's genius level math
[16:45:37] <Arifd> The other thing i want to look at is SIMD/parallelization. but the intention is for this to run as a lib on android, so i'm gonna hold off until i understand android a bit better
[16:52:26] *** Quits: icecoffee (~fruti@125.163.253.12) (Ping timeout: 260 seconds)
[16:54:01] *** Joins: minimal (~minimal@user/minimal)
[17:03:19] *** Quits: Yonle (~Yonle@user/yonle) (Ping timeout: 252 seconds)
[17:03:29] *** Joins: Yonle (~Yonle@user/yonle)
[17:03:59] *** Joins: lexano (~lexano@cpe00e06722f0e4-cm98524a70e35e.cpe.net.cable.rogers.com)
[17:05:35] *** Joins: mickey84 (~user@user/mickey)
[17:05:43] *** Quits: mickey8 (~user@user/mickey) (Remote host closed the connection)
[17:05:44] *** mickey84 is now known as mickey8
[17:07:10] *** Quits: nillyhan (~00000000@user/nillyhan) (Ping timeout: 252 seconds)
[17:15:02] *** Joins: zumba_addict (~zumba_add@c-71-194-58-34.hsd1.il.comcast.net)
[17:24:17] *** Quits: Yonle (~Yonle@user/yonle) (Read error: Connection reset by peer)
[17:24:31] *** Joins: Yonle (~Yonle@user/yonle)
[17:29:50] *** Joins: nillyhan (~00000000@user/nillyhan)
[17:39:31] *** Quits: kib (~kib@user/kib) (Quit: WeeChat 3.3)
[17:44:29] *** Joins: arcatech (~arcatech@user/arcatech)
[18:03:44] *** Joins: kib (~kib@user/kib)
[18:08:47] *** Quits: thebombzen_ (~thebombze@c-68-41-54-207.hsd1.mi.comcast.net) (Quit: Quit)
[18:11:10] *** Quits: witchcraft (~witch@user/witch) (Quit: Leaving)
[18:18:06] *** Joins: MrZeus__ (~MrZeus@81.92.206.10)
[18:19:03] *** Quits: Yonle (~Yonle@user/yonle) (Read error: Connection reset by peer)
[18:19:19] *** Joins: Yonle (~Yonle@user/yonle)
[18:20:11] *** Quits: Yonle (~Yonle@user/yonle) (Read error: Connection reset by peer)
[18:20:33] *** Joins: Yonle (~Yonle@user/yonle)
[18:21:03] *** Quits: Yonle (~Yonle@user/yonle) (Read error: Connection reset by peer)
[18:21:18] *** Joins: Yonle (~Yonle@user/yonle)
[18:21:25] *** Quits: Yonle (~Yonle@user/yonle) (Client Quit)
[18:21:34] *** Quits: af (~af@awalgarg.me) (Ping timeout: 260 seconds)
[18:21:58] *** Quits: nillyhan (~00000000@user/nillyhan) (Ping timeout: 252 seconds)
[18:22:20] *** Quits: cosimone (~user@151.14.38.15) (Remote host closed the connection)
[18:27:17] *** Joins: af (~af@awalgarg.me)
[18:28:58] *** Joins: nillyhan (~00000000@user/nillyhan)
[18:30:58] *** Joins: aleek (~aleeksand@user-5-173-0-46.play-internet.pl)
[18:32:36] *** Quits: auth (~auth@user/auth) (Ping timeout: 245 seconds)
[18:33:08] *** Joins: thebombzen (~thebombze@c-68-41-54-207.hsd1.mi.comcast.net)
[18:34:02] *** Quits: linext_ (~linext@pool-108-53-128-199.nwrknj.fios.verizon.net) (Ping timeout: 268 seconds)
[18:48:22] *** Quits: taupiqueur (~taupiqueu@lmontsouris-659-1-2-186.w193-248.abo.wanadoo.fr) (Ping timeout: 252 seconds)
[18:55:35] *** Quits: minimal (~minimal@user/minimal) (Quit: Leaving)
[18:55:37] *** Bertl is now known as Bertl_oO
[19:03:53] *** Quits: arcatech (~arcatech@user/arcatech) (Quit: Bye.)
[19:36:22] *** Joins: AbleBacon (~AbleBacon@user/AbleBacon)
[19:48:23] *** Joins: durandal_1707 (~computer@212.15.178.140)
[19:51:40] *** Quits: durandal_1707 (~computer@212.15.178.140) (Read error: Connection reset by peer)
[19:53:29] *** Quits: stkrdknmibalz (~test@rrcs-75-87-43-228.sw.biz.rr.com) (Ping timeout: 265 seconds)
[19:54:34] *** Joins: durandal_1707 (~computer@212.15.178.140)
[19:59:32] *** Quits: durandal_1707 (~computer@212.15.178.140) (Read error: Connection reset by peer)
[20:00:54] *** Joins: durandal_1707 (~computer@95.168.116.141)
[20:14:00] *** Joins: rsx (~dummy@ppp-188-174-132-206.dynamic.mnet-online.de)
[20:14:28] *** Joins: waleee (~waleee@2001:9b0:216:8200:d457:9189:7843:1dbd)
[20:31:09] *** Quits: milkt (~debian@gateway/tor-sasl/milkt) (Remote host closed the connection)
[20:35:16] *** Quits: youmustrust (~nobody@ec2-18-182-239-10.ap-northeast-1.compute.amazonaws.com) (Ping timeout: 250 seconds)
[20:36:05] *** Joins: youmustrust (~nobody@ec2-18-182-239-10.ap-northeast-1.compute.amazonaws.com)
[20:36:46] *** Quits: Blacker47 (~Blacker47@user/blacker47) (Ping timeout: 252 seconds)
[20:37:05] *** Joins: Blacker47 (~Blacker47@user/blacker47)
[20:40:32] *** Quits: lexano (~lexano@cpe00e06722f0e4-cm98524a70e35e.cpe.net.cable.rogers.com) (Remote host closed the connection)
[20:45:41] *** Joins: milkt (~debian@gateway/tor-sasl/milkt)
[20:51:49] *** Joins: MrZeus_ (~MrZeus@2a02:c7f:a0aa:4400:290b:e0a5:a3d4:4cc9)
[20:51:55] *** Joins: lexano (~lexano@cpe00e06722f0e4-cm98524a70e35e.cpe.net.cable.rogers.com)
[20:55:58] *** Quits: MrZeus__ (~MrZeus@81.92.206.10) (Ping timeout: 252 seconds)
[20:56:02] *** Quits: arbitercoin (~Rheanna@123.158.85.177) (Ping timeout: 260 seconds)
[20:57:49] *** Quits: rsx (~dummy@ppp-188-174-132-206.dynamic.mnet-online.de) (Quit: rsx)
[21:04:12] *** pong is now known as beaver
[21:15:49] *** Quits: nillyhan (~00000000@user/nillyhan) (Ping timeout: 252 seconds)
[21:18:42] *** Joins: nillyhan (~00000000@user/nillyhan)
[21:34:08] *** Joins: taupiqueur (~taupiqueu@lmontsouris-659-1-2-186.w193-248.abo.wanadoo.fr)
[21:38:42] *** Quits: zumba_addict (~zumba_add@c-71-194-58-34.hsd1.il.comcast.net) (Quit: Client closed)
[21:39:15] *** Quits: Arifd (~Arifd@2a0c:5a80:360e:fa00:c796:2bd:48ed:1c5e) (Ping timeout: 256 seconds)
[21:45:21] *** Quits: durandal_1707 (~computer@95.168.116.141) (Read error: No route to host)
[21:48:08] *** Joins: cosimone (~user@2001:b07:ae5:db26:d50b:b9d7:e822:c65a)
[21:48:18] *** Quits: softworkz (~softworkz@user/softworkz) (Killed (calcium.libera.chat (Nickname regained by services)))
[21:48:27] *** Joins: softworkz (~softworkz@user/softworkz)
[21:52:19] *** Joins: durandal_1707 (~computer@212.15.178.140)
[21:52:59] *** Quits: furrymcgee (~devuan@cgn-89-1-209-32.nc.de) (Quit: leaving)
[21:57:32] *** Quits: waleee (~waleee@2001:9b0:216:8200:d457:9189:7843:1dbd) (Ping timeout: 268 seconds)
[22:05:47] *** Quits: kpuc (1011@46-97-229-216.sr2.pon.net) (Ping timeout: 240 seconds)
[22:08:37] *** Joins: kpuc (1011@46-97-229-216.sr2.pon.net)
[22:13:26] *** Quits: bpmedley (~bpmedley@2600:1700:e2c:8410:6932:8372:87a8:48b2) (Ping timeout: 245 seconds)
[22:19:05] *** Quits: cosimone (~user@2001:b07:ae5:db26:d50b:b9d7:e822:c65a) (Remote host closed the connection)
[22:19:45] *** Joins: waleee (~waleee@2001:9b0:216:8200:d457:9189:7843:1dbd)
[22:31:02] *** Quits: kib (~kib@user/kib) (Quit: WeeChat 3.3)
[22:32:09] *** Joins: arbitercoin (~Rheanna@123.158.85.213)
[22:46:14] *** Joins: a0z (~a0z@87.74.81.189)
[23:04:21] <znf> "The specified session has been invalidated for some reason." this is basically the server closing the connection, is it?
[23:07:42] <JEEB> or just the TLS session
[23:08:09] <JEEB> sounds like an error string from a TLS library such as gnutls
[23:08:19] <JEEB> esp. since that message doesn't pop up from FFmpeg itself
[23:27:04] *** Quits: Blacker47 (~Blacker47@user/blacker47) (Quit: Life is short. Get a V.90 modem fast!)
[23:27:10] *** Joins: markizano (markizano@2600:3c00::f03c:92ff:fe86:b66e)
[23:28:48] *** Quits: l4yer (~l4yer@159.48.55.9) (Ping timeout: 268 seconds)
[23:28:48] *** Parts: slima (~slima@user/slima) ()
[23:32:17] *** Joins: l4yer (~l4yer@213.232.87.181)
[23:32:48] *** Quits: betelgeuse (~betelgeus@94-225-47-8.access.telenet.be) (Quit: The Lounge - https://thelounge.chat)
[23:34:24] <znf> wonder what's causing it, I can't replicate it with curl
[23:34:36] <znf> no wait, I was able to
[23:35:58] <znf> guess Cloudflare didn't like me doing that
[23:45:45] *** Joins: twiclo (~twiclo@2604:7b80:2000:1069:52fc:cedd:fbeb:10c)
[23:46:08] <twiclo> Does anyone know how to disable the warning message "Non-monotonous DTS in output stream"?
[23:47:53] *** Joins: cosimone (~user@2001:b07:ae5:db26:c24a:d20:4d91:1e20)
[23:52:56] <durandal_1707> -v fatal
[23:53:09] <znf> lol
[23:53:17] <znf> or, you know, fix the stream? :P
[23:53:41] *** Quits: keypusher (keypusher@user/keypusher) (Ping timeout: 268 seconds)
[23:54:58] <durandal_1707> since no sample provided, i can only guess using my magic wand
[23:56:30] *** Joins: keypusher (keypusher@user/keypusher)
[23:56:51] <twiclo> I don't care to fix the stream. Timestamps aren't important to me
[23:57:06] <twiclo> durandal_1707 what do you need>
[23:57:09] <twiclo> *?
[23:57:33] <durandal_1707> than you can set timestamps - pts and dts to random value with setts bitstream filter
[23:57:51] <durandal_1707> if you have recent enough ffmpeg version
[23:58:24] <durandal_1707> if this happens in output only, post your filtergraph
