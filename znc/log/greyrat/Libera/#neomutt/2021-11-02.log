[15:15:57] *** Joins: greyrat (~greyrat@ip202.ip-51-178-215.eu)
[15:15:57] *** Server sets mode: +Cnt 
[15:32:48] <kushal> gahr, first I will have to figure out the steps for building it. 
[15:34:22] <flatcap> https://neomutt.org/distro/fedora
[15:34:39] <flatcap> has a list of most things you'll need to install for a full build
[15:35:15] <flatcap> `neomutt -v` shows the `./configure` options for the Fedora build
[15:35:50] <flatcap> though I'd change `full-doc` to `disable-doc`
[17:08:06] *** Joins: reset (~reset@user/reset)
[17:15:12] <gahr> flatcap: I'm looking into #3116
[17:15:13] <neo-bot> Issue by @0-wiz-0 "neomutt core dump in mx_mbox_find": https://github.com/neomutt/neomutt/issues/3116
[17:15:20] <gahr> are you too?
[17:17:00] <flatcap> no, but I glanced at it
[17:17:59] <flatcap> we alloc a Buffer, then resize it and we end up with a pointer of 0x5!
[17:18:10] <flatcap> have you discovered anything?
[17:18:53] <gahr> no
[17:18:53] <gahr> url_parse(np->mailbox->realpath);
[17:19:00] <gahr> I just noticed how realpath is 5
[17:19:14] <flatcap> yeah
[17:19:54] <gahr> looking into the canon functions now
[17:32:44] *** Joins: bsd4me (~bsduser@user/bsd4me)
[17:37:58] *** Quits: todd (~todd@gateway/tor-sasl/toddf) (Remote host closed the connection)
[17:41:44] <kushal> flatcap, understood, I will do that in some time 
[17:44:12] *** Joins: todd (~todd@gateway/tor-sasl/toddf)
[17:44:26] <flatcap> ok
[17:51:30] *** Joins: mord0d_ (~mord0d@gateway/tor-sasl/mord0d)
[17:51:35] *** Quits: mord0d[x230] (~mord0d@gateway/tor-sasl/mord0d) (Remote host closed the connection)
[18:01:56] <kushal> flatcap, On fedora 35 I can not find kyotocabinet-devel 
[18:02:01] <kushal> Can I build without it?
[18:03:17] <kushal> gahr, what is the branch name do you want me to test?
[18:03:58] *** Joins: rgrinberg (~textual@190.113.111.74)
[18:06:45] <gahr> oh, just master :)
[18:07:06] <gahr> I just want asan enabled, so we can track better the allocs/frees
[18:08:34] <kushal> Okay
[18:09:01] <flatcap> yes, you don't need that
[18:11:21] <kushal> Okay, building now
[18:11:36] <kushal> Error: Unable to compile with -fsanitize=address
[18:11:59] <kushal> ^^ while checking for ASAN
[18:12:39] * flatcap looks which rpms he has installed......
[18:12:59] <flatcap> libasan
[18:16:12] <flatcap> I also have some asan options set in my env: export ASAN_OPTIONS="color=never:log_path=asan:print_legend=false:print_summary=false"
[18:16:15] <kushal> heh, no crash on master 
[18:16:23] <flatcap> great :-)
[18:17:02] <flatcap> if neomutt were to crash, the asan output can get garbled, so the "log_path=asan" option puts it in a file
[18:17:14] <kushal> Oh okay
[18:18:51] <flatcap> if it's no trouble, please keep running the asan version...
[18:19:06] <flatcap> if anything goes wrong we'll get LOTS of useful info
[18:19:51] <flatcap> (and any slowdown caused by asan should't be noticeable)
[18:20:59] *** Quits: madage (~madage@user/madage) (Remote host closed the connection)
[18:21:21] *** Joins: madage (~madage@user/madage)
[18:30:07] <kushal> flatcap, yup, will do so
[18:31:53] <flatcap> thanks
[18:32:20] <gahr> great!
[18:32:22] <gahr> thanks!
[18:49:08] *** Quits: jstanek (~jstanek@sourcehut/user/khardix) (Quit: WeeChat 3.2)
[18:51:13] *** Quits: krisk (~krisk@user/krisk) (Quit: ZNC 1.8.2 - https://znc.in)
[18:52:46] *** Joins: krisk (~krisk@user/krisk)
[19:10:06] *** Quits: rgrinberg (~textual@190.113.111.74) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[19:50:06] *** Quits: kzak (~kzak@nat-37.starnet.cz) (Ping timeout: 260 seconds)
[19:57:06] *** Joins: antineutrino (~antineutr@14.139.190.82)
[19:57:34] <antineutrino> why is mutt opening the mailbox faster than neomutt ?
[19:57:47] <antineutrino> like its noticable difference
[20:00:30] <antineutrino> im not using inbuilt imap 
[20:01:08] <antineutrino> im talking about the initial opening where it shows progress at the bottom for example ... (1234/5678)
[20:01:25] <antineutrino> mutt seems to reach (5678/5678) much faster
[20:07:44] <flatcap> hi antineutrino.  er, dunno...
[20:08:02] <flatcap> you using the same config?  right :-)
[20:08:25] <flatcap> do you have header caching enabled?
[20:14:54] <antineutrino> yes using the same config
[20:14:59] <antineutrino> flatcap: 
[20:16:12] <antineutrino> its the default, i havent added anything to muttrc for header caching
[20:16:14] <flatcap> good, just checking
[20:18:16] <flatcap> using the header cache will speed things up, after the first read (for both mutt and neomutt)
[20:18:28] <antineutrino> cool 
[20:18:51] <flatcap> but neomutt shouldn't be much different in raw reading speed
[20:18:53] <antineutrino> but hmm even when using an external imap tool ?
[20:19:03] <antineutrino> im suing mbsync to fetch mail 
[20:19:40] <antineutrino> *using
[20:19:52] <flatcap> ok
[20:20:39] <flatcap> the parses the headers once, so the next time you open a folder, neomutt just fills the index from the cache
[20:20:51] <antineutrino> ah 
[20:20:53] <flatcap> neomutt parses the*
[20:21:18] <flatcap> so even local mail is quicker with the cache
[20:21:30] <antineutrino> right , it did make a big diff
[20:21:36] <antineutrino> just tried it
[20:21:37] <flatcap> great :-)
[20:21:42] <flatcap> roughly how many emails do you have?
[20:21:55] <antineutrino> 12k
[20:22:29] <flatcap> ok, not an insane number
[20:23:44] <flatcap> could you try some timings?
[20:23:54] <antineutrino> how do i time them ?
[20:24:10] <flatcap> time neomutt -n -F /dev/null -f /PATH/TO/ONE/FOLDER -e "exec exit"
[20:24:25] <flatcap> no config, one folder, immediately exit
[20:25:04] <flatcap> if you run it a few times so that your OS has cached everything it's going to
[20:25:08] <antineutrino> one folder should be empty ?
[20:25:25] <flatcap> run that on a big folder
[20:26:07] <flatcap> then if you run plain mutt the same way, we can see how much slower things are
[20:26:16] <flatcap> (and decide if we should worry :-)
[20:26:19] <antineutrino> sorry not clear what one folder should be 
[20:26:34] <antineutrino> can it be my home folder ?
[20:26:43] <antineutrino> or should it be a mailbox ?
[20:26:45] <flatcap> sorry, any big *mail* folder
[20:26:50] <antineutrino> okay
[20:28:38] <antineutrino> neomutt -n -F /dev/null -f  -e "exec exit"  1.03s user 0.24s system 98% cpu 1.299 total
[20:28:48] <antineutrino> mutt -n -F /dev/null -f  -e "exec exit"  0.35s user 0.13s system 95% cpu 0.498 total
[20:29:09] <antineutrino> (also removed header_cache for this one)
[20:29:20] <antineutrino> (for both)
[20:29:39] <antineutrino> i mean while testing the speed for both i havent enabled headercache
[20:30:29] <flatcap> good thinking.  the "-n -F /dev/null" turns off all config reading :-)
[20:30:53] <antineutrino> oh yes ofcourse
[20:31:07] <antineutrino> what are results typically for you ?
[20:31:26] <antineutrino> this is on a folder with 14k mails 
[20:31:51] <antineutrino> mutt seems to faster by a factor of 2
[20:32:13] <gahr> did you build mutt and neomutt yourself? Same optimization levels?
[20:32:55] <antineutrino> haven't built them myself 
[20:33:02] <antineutrino> its from archlinux repos
[20:33:15] <gahr> what's ./neomutt -v | grep CFLAGS
[20:34:04] <gahr> I don't see archlinux adding O2 to cflags anywhere
[20:34:12] <gahr> looking at https://archlinux.org/packages/community/x86_64/neomutt/ which points to https://github.com/archlinux/svntogit-community/tree/packages/neomutt/trunk
[20:34:45] <antineutrino> Compilation CFLAGS: -march=x86-64 -mtune=generic -O2 -pipe -fno-plt -std=c99 -fno-delete-null-pointer-checks -D_ALL_SOURCE=1 -D_GNU_SOURCE=1 -D__EXTENSIONS__ -I/usr/include -I/usr/include/lua5.3 -DNCURSES_WIDECHAR -I/include -I/usr/include/
[20:34:53] <gahr> ok O2 is there :)
[20:35:08] <antineutrino> gahr: the O2 flags come from makepkg i think 
[20:35:53] <antineutrino> this is for mutt : Compilation CFLAGS: -Wall -pedantic -Wno-long-long -march=x86-64 -mtune=generic -O2 -pipe -fno-plt
[20:35:56] <gahr> and what's mutt -v | grep CFLAGS?
[20:36:01] <gahr> ah, thanks
[20:36:02] <antineutrino> :)
[20:36:39] <antineutrino> ill post exact o/p for both 
[20:36:42] <antineutrino> $ mutt -v | grep CFLAGS
[20:36:44] <antineutrino> Configure options: '--prefix=/usr --sysconfdir=/etc --enable-debug --enable-gpgme --enable-pop --enable-imap --enable-smtp --enable-hcache --enable-sidebar --enable-autocrypt --with-curses=/usr --with-gss=/usr --with-ssl=/usr --with-sqlite3 --with-sasl --with-idn2 '\''CFLAGS=-march=x86-64 -mtune=generic -O2 -pipe -fno-plt'\'' LDFLAGS=-Wl,-O1,--sort-common,--as-needed,-z,relro,-z,now
[20:36:46] <antineutrino> CPPFLAGS=-D_FORTIFY_SOURCE=2'
[20:36:48] <antineutrino> Compilation CFLAGS: -Wall -pedantic -Wno-long-long -march=x86-64 -mtune=generic -O2 -pipe -fno-plt
[20:36:53] <antineutrino> and for neomutt ....
[20:37:01] <antineutrino> $ neomutt -v | grep CFLAGS
[20:37:04] <antineutrino> Compilation CFLAGS: -march=x86-64 -mtune=generic -O2 -pipe -fno-plt -std=c99 -fno-delete-null-pointer-checks -D_ALL_SOURCE=1 -D_GNU_SOURCE=1 -D__EXTENSIONS__ -I/usr/include -I/usr/include/lua5.3 -DNCURSES_WIDECHAR -I/include -I/usr/include/
[20:38:24] <flatcap> 23126 emails, NeoMutt: 1.95s; Mutt 1.20s
[20:40:30] <flatcap> hmm...
[20:43:02] <gahr> 10k emails, NeoMutt: 12.93s; Mutt: 1.00s
[20:44:09] *** Quits: antineutrino (~antineutr@14.139.190.82) (Ping timeout: 268 seconds)
[20:44:53] <flatcap> wtf?
[20:45:39] <gahr> my point exactly :)
[20:45:49] <flatcap> is that after multiple runs?  or did neomutt get the cold uncached filesystem?
[20:45:59] <bookworm> ^ that
[20:47:02] <gahr> repeatedly
[20:48:34] <flatcap> is that an ASAN build?
[20:50:11] <gahr> no
[20:50:13] *** Joins: antineutrino (~antineutr@14.139.190.82)
[20:50:20] <antineutrino> oops got disconnected
[20:50:41] <antineutrino> flatcap: gahr what are your neomutt/mutt startup times like ?
[20:50:42] <gahr> I see we're doing more gettimeofday than mutt
[20:51:05] <gahr> antineutrino: I can see mutt 1s vs neomutt 13s
[20:51:15] <antineutrino> !!
[20:51:25] <flatcap> https://pastebin.com/raw/0uU8ZhaZ
[20:54:48] <gahr> let me try one thing real quick
[20:55:06] <antineutrino> these are without configs right ?
[20:55:14] <antineutrino> these tests youll posted
[20:55:29] <flatcap> yes
[20:55:31] <antineutrino> flatcap has 23k mails and seems to not have much of a difference 
[20:56:13] <antineutrino> is there a way to make a "fake mailbox" with many mails ?
[20:56:26] <antineutrino> want to test it for much larger numbers
[20:59:58] <flatcap> you can download the LKML (linux kerne mailing list) (~3 million emails)
[21:00:14] <antineutrino> ah yes
[21:01:51] <bremner> there is a mail corpus we use for notmuch, it's about 400M to download
[21:02:01] <bremner> has some lkml, some enron, some misc
[21:02:01] <flatcap> gahr: where did you see the gettimeofday()s. I've just strace'd both and see negligible differences (for 23K emails)
[21:02:19] <gahr> I brought NeoMutt down to 1.32s
[21:02:31] <gahr> let me double check that 
[21:02:55] <gahr> mh something's strange
[21:03:26] <gahr> I build neomutt and it's around 1 or 2 secs
[21:03:32] <gahr> the one I installed from pacakges is 12sec
[21:04:27] <flatcap> urgh!
[21:09:31] <gahr> got to run, tty tomorrow
[21:09:58] <flatcap> bye gahr 
[21:20:30] <antineutrino> the timestamps that neomutt shows are they derived from the mail header?
[21:20:56] <antineutrino> or do mails have additional metadata that have timestamps in them 
[21:28:19] *** Joins: matthugh (~matthugh@cpc97202-walt22-2-0-cust249.13-2.cable.virginm.net)
[21:44:16] *** Quits: darkstardevx (~darkstard@2601:1c2:300:c8a0::6c32) (Ping timeout: 245 seconds)
[21:48:33] *** Joins: strajder (~strajder@user/strajder)
[22:05:12] *** Joins: darkstardevx (~darkstard@50.39.114.152)
[22:25:38] *** Quits: antineutrino (~antineutr@14.139.190.82) (Remote host closed the connection)
[22:33:33] *** Joins: tech_exorcist (~tech_exor@user/tech-exorcist/x-0447479)
[22:51:42] *** Quits: polve (~polve@twcitalia/polve) (Ping timeout: 260 seconds)
[22:57:11] *** Joins: polve (~polve@twcitalia/polve)
[23:03:14] *** Joins: darklands (~darklands@gateway/vpn/pia/darklands)
[23:14:02] *** Quits: tech_exorcist (~tech_exor@user/tech-exorcist/x-0447479) (Remote host closed the connection)
[23:14:37] *** Quits: matthugh (~matthugh@cpc97202-walt22-2-0-cust249.13-2.cable.virginm.net) (Ping timeout: 268 seconds)
[23:14:42] *** Joins: tech_exorcist (~tech_exor@user/tech-exorcist/x-0447479)
[23:14:46] *** Joins: matthugh (~matthugh@194.110.113.93)
[23:17:25] *** Quits: tech_exorcist (~tech_exor@user/tech-exorcist/x-0447479) (Remote host closed the connection)
[23:17:46] *** Joins: tech_exorcist (~tech_exor@user/tech-exorcist/x-0447479)
[23:19:13] *** Quits: darklands (~darklands@gateway/vpn/pia/darklands) (Quit: Leaving)
[23:19:33] *** Quits: matthugh (~matthugh@194.110.113.93) (Ping timeout: 268 seconds)
[23:21:03] *** Joins: matthugh (~matthugh@194.110.113.77)
