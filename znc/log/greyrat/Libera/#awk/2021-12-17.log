[00:11:28] *** Joins: Everything (~Everythin@37.115.210.35)
[00:39:07] *** Quits: Torr (~Torr@user/torr) ()
[00:39:19] *** Joins: Torr (~Torr@user/torr)
[00:55:35] *** Joins: kensanata (~user@user/kensanata)
[00:57:14] *** Quits: user51 (~user51@176.228.151.30) (Remote host closed the connection)
[01:00:00] *** Quits: lavaball (felix@31.204.155.215) (Remote host closed the connection)
[01:08:29] *** Joins: juno__ (~junebug@104-0-169-217.lightspeed.miamfl.sbcglobal.net)
[01:10:37] *** Quits: junebug (~junebug@2600:1700:3db0:2540:8370:a76b:ff1f:221c) (Ping timeout: 240 seconds)
[01:18:29] *** Quits: rendar (~rendar@user/rendar) (Quit: Leaving)
[01:20:59] *** Quits: Everything (~Everythin@37.115.210.35) (Quit: leaving)
[01:41:32] *** Quits: juno__ (~junebug@104-0-169-217.lightspeed.miamfl.sbcglobal.net) (Ping timeout: 240 seconds)
[02:11:26] *** Joins: seninha (~seninha@user/seninha)
[02:15:13] *** Joins: BSaboia (~bsaboia@187.18.140.125)
[02:20:28] *** Quits: kensanata (~user@user/kensanata) (Remote host closed the connection)
[03:12:04] *** Quits: lockywolf (~lockywolf@vultr-seoul-openbsd.lockywolf.net) (Ping timeout: 268 seconds)
[04:09:06] *** Quits: seninha (~seninha@user/seninha) (Quit: Leaving)
[04:30:32] *** Joins: lockywolf (~lockywolf@vultr-seoul-openbsd.lockywolf.net)
[04:41:21] *** Joins: juno__ (~junebug@2600:1700:3db0:2540:c301:1f00:85dc:f710)
[04:46:08] *** Joins: seninha (~seninha@user/seninha)
[04:56:18] *** Quits: seninha (~seninha@user/seninha) (Quit: Leaving)
[05:23:40] *** Quits: juno__ (~junebug@2600:1700:3db0:2540:c301:1f00:85dc:f710) (Remote host closed the connection)
[05:24:31] *** Joins: junebug (~junebug@2600:1700:3db0:2540:3491:9fc6:cfd7:84b6)
[05:27:17] *** Quits: emanuele6 (~emanuele6@user/emanuele6) (Ping timeout: 240 seconds)
[05:29:43] *** Joins: emanuele6 (~emanuele6@net-93-71-98-153.cust.vodafonedsl.it)
[05:29:55] *** Quits: emanuele6 (~emanuele6@net-93-71-98-153.cust.vodafonedsl.it) (Changing host)
[05:29:55] *** Joins: emanuele6 (~emanuele6@user/emanuele6)
[05:54:20] *** Quits: BSaboia (~bsaboia@187.18.140.125) (Quit: This computer has gone to sleep)
[05:57:57] *** Quits: earnestly (~earnest@user/earnestly) (Ping timeout: 240 seconds)
[06:21:11] *** Quits: ljharb (sid43720@user/ljharb) (Ping timeout: 245 seconds)
[06:21:55] *** Joins: ljharb (sid43720@user/ljharb)
[06:26:39] *** Quits: odc (sid197788@helmsley.irccloud.com) (Ping timeout: 256 seconds)
[06:26:50] *** Quits: lockywolf (~lockywolf@vultr-seoul-openbsd.lockywolf.net) (Quit: ZNC 1.8.2 - https://znc.in)
[06:28:39] *** Joins: lockywolf (~lockywolf@vultr-seoul-openbsd.lockywolf.net)
[06:29:29] *** Joins: odc (sid197788@id-197788.helmsley.irccloud.com)
[07:12:07] *** Joins: mrlemke (~quassel@208.74.105.200)
[07:30:57] *** Quits: junebug (~junebug@2600:1700:3db0:2540:3491:9fc6:cfd7:84b6) (Ping timeout: 240 seconds)
[08:31:02] *** Quits: fford (~fford@p200300c6ff35820060d8bedc1c419ec5.dip0.t-ipconnect.de) (Quit: WeeChat 1.5)
[08:51:26] *** Joins: tangyQED (~tangy@user/tangy)
[09:10:44] *** Joins: junebug (~junebug@2600:1700:3db0:2540:d740:c638:c76a:37cb)
[09:25:11] *** Joins: user51 (~user51@176.228.151.30)
[09:31:19] *** Quits: junebug (~junebug@2600:1700:3db0:2540:d740:c638:c76a:37cb) (Quit: Leaving)
[10:02:51] *** Quits: Thanatermesis (~Thanaterm@191.92.148.122) (Ping timeout: 245 seconds)
[11:50:46] *** Quits: llua (~llua@zsh/developer/llua) (Ping timeout: 245 seconds)
[12:16:04] *** Joins: earnestly (~earnest@user/earnestly)
[12:29:42] *** Joins: otisolsen70 (~otisolsen@xd4ed80b5.cust.hiper.dk)
[12:31:21] <otisolsen70> I have a file that contains lines such as foo.$N="foobar", where $N is some serial number, and foobar can be any random text. So example of such a file here: https://paste.yt/p17617.html  Can I use awk to go through such a file and cound up the N's and get the next N and add a line with the N+1? 
[12:31:29] <otisolsen70> Hope this makes sense
[12:32:32] <Patsie> sure
[12:35:49] <Patsie> BEGIN { FS="[.=]" } { max = ($2 > max) ? $2 : mox } END { printf("foo.%d=\"foobar\"\n", max+1) }
[12:35:54] <Patsie> sonething like this perhaps
[12:38:32] <Patsie> minus the typo
[12:44:56] <otisolsen70> Thanks. Trying to modify this to my use case
[12:48:03] *** Joins: lavaball (~Melissa@31.204.155.215)
[13:57:24] *** Joins: BSaboia (~bsaboia@187.18.140.125)
[14:00:46] <otisolsen70> Patsie, I fix the s/mox/mas/ typo. But I cannot really make this work...
[14:01:24] <otisolsen70> Patsie, it seems to match number 4 in the file. Even though there are many more.
[14:01:34] <otisolsen70> So for some reason it stops at .4= 
[14:02:01] <otisolsen70> Patsie, I think FS might not be right.
[14:02:10] <otisolsen70> Oh wait..
[14:03:20] <otisolsen70> Does the current FS match any character before =? So for example "foo=bar", then this FS matches "o=" ?
[14:11:27] <Patsie> FS="[.=]" separates each 'field' or 'colum' based on either a '.' or '=' character
[14:11:46] <Patsie> so in your example: foo.1="foobar"
[14:11:59] <Patsie> $1 = foo
[14:12:02] <Patsie> $2 = 1
[14:12:09] <Patsie> $3 = "foobar"
[14:12:13] <otisolsen70> Patsie, oh. Problem is, the file contains many other lines that may match this...
[14:12:17] <Patsie> (including the double quotes)
[14:12:28] <Patsie> well, then you didn't give a good example
[14:12:44] <otisolsen70> Patsie, yeah, I know. Totally my bad.
[14:12:45] <Patsie> give a good real-world example and a good real-world explanation of what you want
[14:12:50] <Patsie> preferably with an example output
[14:13:04] <otisolsen70> Patsie, so I need to match only lines that start with '^foo'
[14:13:41] <Patsie> awk '/^foo/ { do something }'
[14:15:12] <otisolsen70> Patsie, real world explanation: I have a config file with a lot of options in it. Some of these options are all called foo.bar.$n="some option". So I want to edit a bunch of files inserting an additional line with foo.bar.$n+1="some additional option"
[14:15:35] <otisolsen70> foo.bar. can be different for different use cases.
[14:15:46] <otisolsen70> I hope this makes sense.
[14:17:21] <Patsie> so, put the config online somewhere and show us the data
[14:21:08] <otisolsen70> Patsie, example config file: https://paste.yt/p17619.html
[14:21:48] <otisolsen70> Patsie, so in this case, the last option is "wrapper.java.additional.12=-Djava.net.preferIPv6Addresses=false
[14:21:48] <otisolsen70> ". I want to add wrapper.java.additional.13=foobar
[14:25:50] <otisolsen70> Hope this makes sense
[14:26:22] <otisolsen70> I have truncated the config as the real one is pretty big
[14:26:39] <otisolsen70> fg
[14:28:42] <Patsie> lets have a look
[14:30:58] <otisolsen70> I now have a shellscript like this: 
[14:30:59] <otisolsen70> awkscript='BEGIN { FS="[.=]" } { max = ($2 > max) ? $2 : max } END { printf("\nwrapper.java.additional.%d=\"FOOBAR\"\n", max+1) }'
[14:31:08] <otisolsen70> grep '^wrapper.java.additional' "$wrapper_conf" | awk "$awkscript"
[14:31:21] <otisolsen70> And it produces this: wrapper.java.additional.1="FOOBAR"
[14:31:34] <otisolsen70> So does not seem to use max+1?
[14:33:43] <Patsie> BEGIN { FS = "="; key = "wrapper.java.additional" }
[14:33:43] <Patsie> ($1 ~ key) {n=split($1, arr, "."); max = (arr[n] > max) ? arr[n] : max }
[14:33:43] <Patsie> END { printf("%s.%d=\"foobar\"\n", key, max+1) }
[14:33:47] <Patsie> something like that
[14:57:31] <otisolsen70> Yeah! That does seem to work. Thanks!
[15:19:01] <otisolsen70> Patsie, I currently use it like this: grep '^wrapper.java.additional' "$wrapper_conf" | awk "$awkscript" >> "$wrapper_conf"
[15:19:14] <otisolsen70> This inserts the new option at the bottom of the file. And this works. But is not elegant.
[15:19:48] <otisolsen70> Is it possible using awk to insert the line in one go? Not having to use grep and >>? And then also have awk insert the new line immediately after the n=max line?
[15:20:13] <otisolsen70> If not, I will figure out something using grep combined with head -n / tail -n
[15:26:31] <geirha> # printf '%s\n' ignore.this=\"line\" wrapper.java.additional.{1,2}=\"...\" | awk -F= '$1 ~ /^wrapper\.java\.additional\.[0-9]+/ { print; sub(/.*\./, "", $1); max = $1 > max ? $1 : max } END { printf("wrapper.java.additional.%d=\"FOOBAR\"\n", max+1) }'
[15:26:32] <shbot> geirha: wrapper.java.additional.1="..."
[15:26:32] <shbot> geirha: wrapper.java.additional.2="..."
[15:26:32] <shbot> geirha: wrapper.java.additional.3="FOOBAR"
[15:27:07] <geirha> ah, but you want all the other lines printed too
[15:28:15] <geirha> # printf '%s\n' ignore.this=\"line\" wrapper.java.additional.{1,2}=\"...\" | awk -F= '$1 ~ /^wrapper\.java\.additional\.[0-9]+/ { n = $1 ; sub(/.*\./, "", n); max = n > max ? n : max } {print} END { printf("wrapper.java.additional.%d=\"FOOBAR\"\n", max+1) }'
[15:28:18] <shbot> geirha: ignore.this="line"
[15:28:18] <shbot> geirha: wrapper.java.additional.1="..."
[15:28:18] <shbot> geirha: etc... ( http://ix.io/3IF0 )
[15:44:01] *** Quits: asdflkj_sh (asdflkj@bsdforall.org) (Ping timeout: 250 seconds)
[15:45:43] *** Joins: Everything (~Everythin@37.115.210.35)
[16:07:41] *** Quits: lockywolf (~lockywolf@vultr-seoul-openbsd.lockywolf.net) (Read error: Connection reset by peer)
[16:08:31] *** Joins: lockywolf (~lockywolf@vultr-seoul-openbsd.lockywolf.net)
[16:45:02] *** Joins: llua (~llua@zsh/developer/llua)
[16:45:49] <otisolsen70> geirha, not sure I understand how to use that....
[16:47:13] <otisolsen70> I am trying this: wrapper_opts="$(grep '^wrapper.java.additional' "$wrapper_conf" | awk "$awkscript" )" ; target_line=$(grep "^wrapper.java.additional" "$wrapper_conf" -n | awk -F ":" 'END{print $1 }') ; awk "(c==$target_line) { print "$wrapper_opts" } (c!=$target_line) { print $0 } { c++ }" $wrapper_conf
[16:47:46] <otisolsen70> But that gives me a syntax error in the first print statement of the last line
[16:48:01] <otisolsen70> print "$wrapper_opts" 
[16:55:03] <geirha> my awk takes the original config file as input and prints it with an added, calculated wrapper.java.addition.X line at the end
[16:57:11] <geirha> so you'd do   awk '...' "$wrapper_conf" > "$wrapper_conf.tmp" && mv "$wrapper_conf.tmp" "$wrapper_conf"
[16:59:44] *** Joins: asdflkj_sh (asdflkj@bsdforall.org)
[17:04:08] *** Joins: axisys_ (~axisys@ec2-52-207-123-244.compute-1.amazonaws.com)
[17:05:05] <axisys_> how to print next line when matches a pattern ... so if a line matches with FOO, I like to print the next line
[17:05:41] <axisys_> awk '/FOO/ {getline;print}' file worked
[17:05:43] <axisys_> thanks
[17:18:07] *** Joins: seninha (~seninha@user/seninha)
[17:58:04] *** Joins: Thanatermesis (~Thanaterm@191.92.148.122)
[18:08:29] <otisolsen70> geirha, thanks
[18:09:03] *** Parts: Everything (~Everythin@37.115.210.35) ()
[18:15:08] *** Quits: otisolsen70 (~otisolsen@xd4ed80b5.cust.hiper.dk) (Quit: Leaving)
[18:15:18] <geirha> axisys_: and edge case with that is if there are two consecutive lines matching FOO, then it won't print the line following the second FOO
[18:16:06] <geirha> *an
[18:17:55] *** Joins: otisolsen70 (~otisolsen@xd4ed80b5.cust.hiper.dk)
[18:27:59] <otisolsen70> Patsie, you still here?
[18:28:21] <otisolsen70> Patsie, this works really well: awkscript='BEGIN { FS = "="; key = "wrapper.java.additional" } ($1 ~ key) {n=split($1, arr, "."); max = (arr[n] > max) ? arr[n] : max } END  { printf("%s.%d=-Dlog4j2.formatMsgNoLookups=true\n", key, max+1) }'
[18:28:31] <otisolsen70> Patsie, but it fails in a wierd case: 
[18:29:10] <otisolsen70> Patsie, in this config file: https://paste.yt/p17620.html
[18:29:21] <otisolsen70> It fails when these ".stripquotes" are there.
[18:29:49] <otisolsen70> So, for example when "wrapper.java.additional.2.stripquotes=TRUE" exist as a line, then 'n' does simply not seem to be added correctly. So 'max' ends up being 1.
[18:31:08] <geirha> because it uses the last field as the number; "stripquotes"
[18:31:47] <otisolsen70> I guess this is due to key matching the start of the line and then we separate on "=". But then what is selected is  "2.stripgoutes". So I guess there should be some sort of matching so that only lines that exactly start with "wrapper.java.additional." and then followed by exactly "[0-9]+=" are matched?
[18:31:50] <geirha> you'll have to additionally tell it to use the fourth field after splitting on . instead of always using the last
[18:32:09] <otisolsen70> Oh. right. Using the fourth field might work.
[18:32:41] <otisolsen70> split($4, arr, ".") ?
[18:32:48] <otisolsen70> Not sure how split() works....
[18:33:08] <geirha> $1 is "wrapper.java.additional.2.stripquotes"
[18:33:22] <otisolsen70> Oh. Right.
[18:33:23] <geirha> split("$1", arr, ".") splits it on "." and stores the result in arr
[18:33:33] <geirha> the return value is how many fields arr contains (n)
[18:34:12] <geirha> err, sneaking in shellisms there, I meant split($1 without "" quotes around $1
[18:35:42] <otisolsen70> So I need to change this: 
[18:35:43] <otisolsen70> {n=split($1, arr, "."); max = (arr[n] > max) ? arr[n] : max }
[18:35:49] <geirha> so BEGIN { FS = "="; key ="wrapper.java.additional"; field = 4 } index($1, key) == 1 { split($1, arr, "."); max = arr[field] > max ? arr[field] : max } ...
[18:35:52] <otisolsen70> Into this: {n=split($1, arr, "."); max = (arr[4] > max) ? arr[4] : max }
[18:35:52] <otisolsen70> ?
[18:36:05] <geirha> or hardcode it like that, yes
[18:39:19] <otisolsen70> Thanks
[20:17:29] *** Joins: junebug (~junebug@2600:1700:3db0:2540:bf7b:a967:4977:2346)
[20:41:17] *** Quits: user51 (~user51@176.228.151.30) (Ping timeout: 240 seconds)
[20:43:37] *** Quits: elastic_dog (~elastic_d@2a01:118f:822:9c00:f583:aa51:9ad4:d4fb) (Ping timeout: 240 seconds)
[20:48:49] *** Joins: elastic_dog (~elastic_d@2a01:118f:822:9c00:f583:aa51:9ad4:d4fb)
[20:51:57] *** Quits: junebug (~junebug@2600:1700:3db0:2540:bf7b:a967:4977:2346) (Ping timeout: 240 seconds)
[20:57:08] *** Joins: junebug (~junebug@2600:1700:3db0:2540:b3c4:bac4:2686:e215)
[21:07:57] *** Quits: junebug (~junebug@2600:1700:3db0:2540:b3c4:bac4:2686:e215) (Ping timeout: 240 seconds)
[21:12:29] *** Joins: junebug (~junebug@2600:1700:3db0:2540:a680:fb27:d4a4:ebf0)
[21:23:55] *** Quits: BSaboia (~bsaboia@187.18.140.125) (Quit: This computer has gone to sleep)
[21:25:05] *** Joins: BSaboia (~bsaboia@187.18.140.125)
[21:34:37] *** Quits: junebug (~junebug@2600:1700:3db0:2540:a680:fb27:d4a4:ebf0) (Ping timeout: 240 seconds)
[22:06:21] *** Quits: seninha (~seninha@user/seninha) (Quit: Leaving)
[22:13:59] *** Quits: lockywolf (~lockywolf@vultr-seoul-openbsd.lockywolf.net) (Quit: ZNC 1.8.2 - https://znc.in)
[22:45:54] *** Quits: BSaboia (~bsaboia@187.18.140.125) (Quit: This computer has gone to sleep)
[22:52:02] *** Joins: user51 (~user51@176.228.151.30)
[23:11:53] *** Joins: junebug (~junebug@2600:1700:3db0:2540:3705:6def:beff:fd)
[23:16:22] *** Joins: seninha (~seninha@user/seninha)
[23:31:43] *** Joins: fford (~fford@p200300c6ff35820060d8bedc1c419ec5.dip0.t-ipconnect.de)
[23:53:28] *** Joins: bud (~bud@user/bud)
[23:53:40] *** Parts: bud (~bud@user/bud) (Leaving.)
[23:53:41] *** Joins: bud (~bud@user/bud)
[23:53:52] *** Parts: bud (~bud@user/bud) (Leaving.)
[23:53:53] *** Joins: bud (~bud@user/bud)
[23:55:30] *** Quits: bud (~bud@user/bud) (Quit: Leaving.)
[23:58:06] *** Quits: otisolsen70 (~otisolsen@xd4ed80b5.cust.hiper.dk) (Quit: Leaving)
