[00:13:17] *** Quits: Kruppt (~Kruppt@50.111.1.161) (Quit: Leaving)
[00:26:58] *** Joins: Xanthaos (~ke4nhw@user/ke4nhw)
[00:37:46] *** Joins: vlm (~vlm@user/vlm)
[00:40:31] <Xanthaos> I have a question. My home network is, for example, 192.168.0.0/24, and my openvpn is, for example, 10.22.33.0/24. I am connecting my laptop to my home network via the OpenVPN tunnel, giving it an address of 10.22.33.25. I have devices in the home network, for example, 192.168.0.100, that I want to access. I have ip forwarding turned on in the OS (centos 7 btw), and I have the following rules 
[00:40:31] <Xanthaos> in the firewall, *filter:
[00:41:16] <Xanthaos> -A FORWARD -s 192.168.0.0/24 -d 10.22.33.0/24 -j ACCEPT
[00:41:36] <Xanthaos> and its reverse (reverse the -s and -d so it's the other way). 
[00:42:08] <rob0> !whatis welcome 8
[00:42:08] <vpnHelper> rob0: Don't use 192.168.1.0/24 or 192.168.0.0/24 (too much potential for conflict)
[00:42:13] <Xanthaos> However I cannot ping or otherwise access any device on the 192.168
[00:42:37] <Xanthaos> Use specific IP's?
[00:43:02] <Xanthaos> so two rules for each IP pair I want to forward?
[00:43:42] <rob0> Don't use the most common RFC 1918 networks, especially if you plan to make it available on a VPN
[00:44:00] <rob0> !serverlan
[00:44:01] <vpnHelper> rob0: (#1) for a lan behind a server, the server must have ip forwarding enabled (!ipforward), the server needs to push a route for its lan to clients, and the router of the lan the server is on needs a route added to it (!route_outside_openvpn), or (#2) Handy troubleshooting flowchart: http://www.ircpimps.org/serverlan.png
[00:44:09] <rob0> see the flowchart
[00:44:22] <Xanthaos> The addresses I gave are "for example" as I mentioned. I have a different networking scheme.
[00:51:44] <Xanthaos> On the server, in ccd, I am using for this client 'ifconfig-push 10.22.33.25 255.255.255.0' (again example IP)
[00:55:40] <Xanthaos> I have the 'push "route IP NM" commented out, does that need to be uncommented then?
[00:56:38] <rob0> how far did you get on the flowchart?
[01:00:09] <Xanthaos> i just lost the whole thing. It's failing to restart, and it's not even logging. Gimme a minute to get this corrected and I'll brb...
[01:16:45] *** Joins: ke4nhw (~ke4nhw@user/ke4nhw)
[01:17:14] *** Quits: ke4nhw (~ke4nhw@user/ke4nhw) (Remote host closed the connection)
[01:19:13] *** Quits: Xanthaos (~ke4nhw@user/ke4nhw) (Ping timeout: 246 seconds)
[01:19:48] *** Quits: vlm (~vlm@user/vlm) (Quit: "")
[01:50:37] *** Joins: Xanthaos (~ke4nhw@user/ke4nhw)
[01:51:24] <Xanthaos> Okay I am back, the vpn server went apepoop. Okay it's back up. I have reached the point that I can: ping the lan address of the server, but no other lan addresses
[01:53:08] <Xanthaos> You still here rob0?
[01:53:45] <Xanthaos> Is this a failure in my iptables?
[02:16:18] <ordex> BtbN: I Am testing 5.10.109 and for some reason i cannot trigger the v6/v4 bug mah mah
[02:17:04] <BtbN> Maybe they backported?
[02:17:09] <Xanthaos> I've done this before, and I don't remember having to make any changes to the router itself. However I just added a route in the router (destination 10.22.33.0 255.255.255.0 gateway server-lan-ip
[02:17:16] <Xanthaos> It's still not working
[02:17:17] <ordex> BtbN: nope
[02:17:22] <ordex> BtbN: they asked me to test first
[02:17:22] <BtbN> I was on 5.10.96
[02:17:34] <ordex> but I checked the code and it contains indeed the bug
[02:17:35] <ordex> mah mah
[02:17:43] <ordex> maybe I am doing something that is circumventing the issue
[02:17:45] <Xanthaos> I can ping the server lan address, but not any other lan address
[02:18:28] <BtbN> Maybe it's important that the connection comes via an actual interface?
[02:18:35] <BtbN> like, a physical one
[02:18:40] <ordex> hmhmh
[02:18:48] <ordex> I am testing across namespaces with veth
[02:18:57] <ordex> I was thinking something along these lines
[02:19:01] <ordex> but the bug is really in a generic code
[02:19:09] <ordex> mah mah, will do some more attempt
[02:19:09] <ordex> s
[02:19:20] <BtbN> Very weird bug. I wonder what triggers it.
[02:19:39] <ordex> I can explain if you want
[02:20:10] <BtbN> No, I mean for it to manifest. Since clearly there's situations where it doesn't.
[02:20:26] <ordex> but I remember this was pretty consistent tbh
[02:20:31] <ordex> maybe it's just a pebcak
[02:20:38] <ordex> at this time of the day..
[02:24:19] <Xanthaos> I can't figure it out. I've followed the instructions but I can't get this to work. I can't access lan ip's from the vpn connection. it's pretty much refusing to work.
[02:26:02] *** Quits: DoucheEnrique (~quassel@i5C756186.versanet.de) (Quit: I'm quitting.)
[02:26:11] <ordex> Xanthaos: did you check the flowchart?
[02:27:14] <Xanthaos> yes, and I made it to the end, but still no dice
[02:27:47] <BtbN> Xanthaos, the PCs in your home LAN have no idea about the VPN network, so they can't reach it
[02:27:59] <BtbN> You need a route to the VPN network on your default gateway of that LAN
[02:28:33] <Xanthaos> I did
[02:29:14] <BtbN> So on the router of 192.168.0.0/24 you added a route to 10.22.33.0/24, via the 192.168... address of the VPN Server?
[02:30:00] <BtbN> And are you pushing a route to 192.168.0.0/24 to the VPN clients? (Don't actually do that with that network, use something less common)
[02:30:35] <Xanthaos> yes, it is: destination 10.22.33.0 255.255.255.0 gateway server-lan-ip interface lan metric 2 active yes
[02:30:36] *** Joins: DoucheEnrique (~quassel@i5C7567C5.versanet.de)
[02:31:40] <Xanthaos> I am using 'push "route 192.168.0.0 255.255.255.0" in the server config
[02:31:52] <Xanthaos> these being example ip's of course.
[02:32:37] <BtbN> Yeah, that sounds like all the parts you need to me
[02:33:30] <Xanthaos> ip forwarding is turned on, I put rules in the *filter FORWARD chain that include the entirety of both subnets (for now until I get it working), still not working though
[02:34:05] <BtbN> Check traceroutes from both ends, and see where stuff gets lost
[02:35:21] <Xanthaos> sucky part is my client is a Windows 10 laptop
[02:35:41] <BtbN> Windows can traceroute just fine
[02:35:51] <Xanthaos> hope
[02:35:53] <Xanthaos> nope
[02:35:57] <BtbN> ?
[02:35:57] <Xanthaos> not a valid command
[02:36:07] <BtbN> It's called tracert...
[02:36:16] <Xanthaos> 'traceroute' is not recognized as an internal or external command,
[02:36:16] <Xanthaos> operable program or batch file.
[02:36:36] <Xanthaos> ohh, dang, it's been forever since I've used it on windows...
[02:36:49] <Xanthaos> I usually just use windows as a client to my linux stuff...
[02:37:59] <Xanthaos> One hop. the vpn IP of the server. Not even the lan ip
[02:38:57] <ordex> you have two options: packets are being filtered on the server, or packets are not coming back after reaching the LAN host
[02:39:19] <ordex> Xanthaos: maybe the LANhost has a firewall that prevents traceroute/ping from working?
[02:39:25] <Xanthaos> I'm wondering if they're being filtered on the server.
[02:39:51] <Xanthaos> shouldn't, I can ping it just fine from machines on the lan.
[02:39:59] <Xanthaos> so it accepts ping requests.
[02:41:28] <Xanthaos> forwarding is turned on, and I have two forward rules for now: -s 10.22.33.0/24 -d 192.168.0.0/24 -j ACCEPT and the reverse of that: -s lan_ip -d vpn_ip
[02:41:42] <Xanthaos> default policy for forward it drop.
[02:41:59] <Xanthaos> I figure that should be broad enough for it to work, or one would think...
[02:42:33] <BtbN> time to turn on iptables logging and see what it's doing
[02:42:48] <BtbN> The counters of the rules are also a good indication
[02:43:00] <BtbN> If they are all still 0, the rules don't apply
[02:43:34] <ordex> you can also run tcpdumpo on the lan interface to see if ping are going out
[02:43:39] <ordex> (and nothing comes back in)
[02:44:07] <ordex> Xanthaos: if you run traceroute on the LAN host towards a VPNIP, where does it stop ?
[02:46:54] <ordex> BtbN: I think I know what the problem is
[02:47:15] <ordex> by using a v6 and a v4 socket on the same host, I am toggling the kernel flags for both families, so defeating the bug
[02:47:25] <ordex> the kernel flags are global
[02:47:42] <ordex> so as long as one socket does v4, also the others will have a working v4
[02:47:49] <BtbN> So a corner case on top of the corner case. Fun
[02:47:56] <ordex> :D
[02:48:04] <ordex> I need to test between two different VMs
[02:48:07] <BtbN> But that gives a fascinating way to work around the bug if you can't fix the kernel
[02:48:08] <ordex> rather than using the same
[02:48:14] <ordex> hehe
[02:48:20] <ordex> nah, the kernel is gonna get fixed ;)
[02:48:33] <BtbN> I'm thinking of cases where you can't. Managed VMs or some shit
[02:48:41] <BtbN> though you won't be using dco there anyway
[02:49:02] <Xanthaos> I tried the tracert (and traceroute from a linux machine) going towards the vpnip of this client, and it failed completely
[02:49:05] <Xanthaos> It went nowhere.
[02:49:21] <BtbN> it should at the very least go to that clients default gateway on the first hop
[02:49:26] <BtbN> If it doesn't, something is very wrong
[02:53:37] <rob0> If thine firewall offend thee, cut it off and cast it from thee.
[02:54:14] <rob0> What were you trying to do with the firewall?
[02:55:02] <Xanthaos> Okay the linux lan machine made it to the gateway, that's it, using mtr vpnip
[02:55:20] <ordex> if it stops at the GW, then the GW has no route towards the VPN network
[02:55:30] <ordex> because the second hop should be the VPN server in your LAN
[02:55:36] <ordex> but you don't get there
[02:56:06] <Xanthaos> I stopped iptables, no change
[02:56:13] <BtbN> define "stopped iptables"
[02:56:24] <BtbN> it's not a daemon that's running
[02:56:25] <Xanthaos> I stopped the service
[02:56:29] <ordex> Xanthaos: but you don't even reach the VPN server
[02:56:41] <Xanthaos> yeah, process of elimination
[02:56:43] <BtbN> well, if the VPN server has a rampant firewall, it would explain things
[02:57:08] <BtbN> Xanthaos, what did you actually do? Iptables is a set of rules loaded into the kernel. Not something you stop
[02:57:20] <Xanthaos> That's the machine that I just use 'systemctl stop iptables'
[02:57:29] <BtbN> that's not something you can do
[02:57:46] <BtbN> you'll need to flush all chains, and set the default policy of all of them to ACCEPT, if you want to "disable" it
[02:58:20] <rob0> iptables is not a daemon
[03:00:06] <Xanthaos> Okay this is crazy. I shouldn't have to cut off my whole head just to get rid of a pimple. Let's start from the beginning. What conditions need to be in place, from the vpn server to the lan machines, to allow them to talk to one another.
[03:00:27] <rob0> ip forwarding and routes
[03:00:32] <Xanthaos> Config files, ccd files, kernel modules, flags, firewall rules
[03:00:40] <ordex> can I guys stop you for a second
[03:00:41] <ordex> :D
[03:00:50] <ordex> I thought the traceroute clearly pointed where the problem was
[03:00:51] <Xanthaos> sure
[03:00:57] <ordex> no?
[03:01:05] <rob0> ok, I didn't look at it
[03:01:13] <ordex> the traceroute reached the LAN GW, but did not hop on the VPN server
[03:01:20] <Xanthaos> correct
[03:01:22] <ordex> this should mean that the GW hasno route to the VPN network
[03:01:40] <Xanthaos> okay i might not have the route correct but it's there
[03:01:44] <ordex> otherwise it would at least send the packets to the VPN server and show the hop 2
[03:01:45] <Xanthaos> I'm staring at it.
[03:02:09] <ordex> hm
[03:02:14] <ordex> what does the route look like?
[03:02:49] <rob0> if the route is not correct, the correct route is not there :)
[03:03:00] <ordex> :D
[03:03:02] <BtbN> ordex, it could also mean the firewall on the VPN server is too restrictive
[03:03:16] <BtbN> that's lead to the same missing reply from it
[03:03:19] <BtbN> *d
[03:03:21] <ordex> BtbN: right, but he said the VPN server was replying to other traceroute attempts, from the other side
[03:03:45] <BtbN> I guess the question is... does it reply to pings from within the lan?
[03:03:55] <ordex> still possible the firewall is the culprit, but given all the symptoms, it is very likely that the route is not properly setup
[03:04:01] <BtbN> And even then, it might react differently to a package with a non-lan destination
[03:04:19] <ordex> BtbN: right, even though I expect the LAN to be the least firewalle'd
[03:04:20] <ordex> anyway
[03:04:22] <BtbN> But yeah, the issue is either the Firewall on the VPN server, or the routing on the LANs gateway
[03:04:31] <ordex> let's look at the route first, then we can draw a conclusion
[03:04:47] <ordex> Xanthaos: ?
[03:05:08] <Xanthaos> I'm using a gui to set it, so if you want me to get the actual route line I'll have to access the router commandline. But it is: Destination: 10.22.33.0 255.255.255.0    Gateway 192.168.0.100  (vpn svr ip address)    Interface: LAN (as both exist in the lan)    metric: 2    Active:yes
[03:05:32] <ordex> maks sense
[03:05:35] <ordex> makes
[03:12:06] <Xanthaos> Okay, straight from the router's routing table: Destination 10.22.33.0   Gateway 192.168.0.100   Genmask 255.255.255.0   Flags UG   Metric 2   Ref 0   Use 0   iface eth0.1
[03:16:51] <Xanthaos> brb
[03:16:56] *** Quits: Xanthaos (~ke4nhw@user/ke4nhw) (Remote host closed the connection)
[03:20:13] *** Joins: gast0n (~g4570n@user/gast0n)
[03:21:13] *** Joins: Xanthaos (~ke4nhw@user/ke4nhw)
[03:22:28] <Xanthaos> Okay now its working
[03:23:35] <Xanthaos> I removed the route from the router, restarted it, added the same exact route back to the router, restarted it, and it works exactly like I need.
[03:24:15] <Xanthaos> so I guess it was and wasn't the route. For some reason it wasn't using it, even though it was right there in the table.
[03:36:01] <Xanthaos> any idea why it did this, for future reference? Isn't a change in the routing table supposed to be active immediately?
[03:42:52] <BtbN> Maybe that GUI of yours is broken?
[03:52:44] *** Quits: becm (~becm@55d4e494.access.ecotel.net) (Quit: quit)
[03:57:33] <Xanthaos> possibly
[03:58:14] <Xanthaos> I usually use the cli access for the router, but I was already aggravated and feeling lazy. 
[04:36:18] *** Quits: eelstrebor (~eelstrebo@198-178-29-136.scb.ne.static.allophone.net) (Quit: Ex-Chat)
[04:39:01] *** Quits: Bebef (sbreit@phobos.bebef.de) (Quit: bye)
[04:43:37] *** Joins: Bebef (sbreit@phobos.bebef.de)
[04:52:57] *** Quits: sepulchralDrake_ (~unkown@user/sepulchralDrake) (Quit: ZNC - https://znc.in)
[04:53:09] *** Joins: sepulchralDrake (~unkown@user/sepulchralDrake)
[05:11:28] *** Quits: nitro_ (~nitro_@c-73-165-183-88.hsd1.pa.comcast.net) (Read error: Connection reset by peer)
[05:16:07] *** Joins: vlm (~vlm@user/vlm)
[05:58:21] *** Joins: ikwyl6 (~ikwyl6@195.206.105.22)
[05:59:34] *** Quits: krzee (~k@openvpn/krzee) (Ping timeout: 246 seconds)
[06:07:45] *** Joins: krzee (~k@openvpn/krzee)
[06:08:13] *** Quits: jkotra (~jkotra@122.176.152.121) (Ping timeout: 260 seconds)
[06:45:34] *** Quits: winstonsmith (~winstonsm@gateway/vpn/pia/winstonsmith) (Quit: .)
[06:49:21] *** Joins: winstonsmith (~winstonsm@gateway/vpn/pia/winstonsmith)
[06:49:37] *** Quits: vectr0n (~vectr0n@user/vectr0n) (Ping timeout: 240 seconds)
[07:06:47] *** Joins: adeliktas9 (~adeliktas@i59F52E5A.versanet.de)
[07:08:27] *** Quits: adeliktas (~adeliktas@i59F52D90.versanet.de) (Ping timeout: 260 seconds)
[07:08:28] *** adeliktas9 is now known as adeliktas
[07:10:56] *** Joins: vectr0n (~vectr0n@user/vectr0n)
[07:34:23] *** Quits: gast0n (~g4570n@user/gast0n) (Quit: Bye, see you soon! ðŸ‘‹)
[07:35:40] *** Quits: krzee (~k@openvpn/krzee) (Ping timeout: 272 seconds)
[08:09:52] *** Joins: eelstrebor (~eelstrebo@198-178-29-136.scb.ne.static.allophone.net)
[08:48:30] *** Quits: eelstrebor (~eelstrebo@198-178-29-136.scb.ne.static.allophone.net) (Remote host closed the connection)
[09:08:33] *** Quits: toulene (~toulene@user/toulene) (Quit: The Lounge - https://thelounge.chat)
[10:26:29] *** Quits: Xanthaos (~ke4nhw@user/ke4nhw) (Remote host closed the connection)
[10:48:42] *** Joins: nerozero (~nerozero@87.253.63.54)
[10:54:43] <ordex> Xanthaos: lazyness can bring all sort of problems :-P
[11:06:16] *** Quits: jmcgnh (~jmcgnh@wikipedia/jmcgnh) (Remote host closed the connection)
[11:10:50] *** Joins: jmcgnh (~jmcgnh@wikipedia/jmcgnh)
[12:27:39] *** Quits: Mister_Magister (~Mister_Ma@user/mister-magister/x-2636733) (Ping timeout: 260 seconds)
[12:35:01] *** Joins: Mister_Magister (~Mister_Ma@user/mister-magister/x-2636733)
[12:37:10] *** Quits: jmcgnh (~jmcgnh@wikipedia/jmcgnh) (Ping timeout: 246 seconds)
[12:43:36] *** Joins: jmcgnh (~jmcgnh@wikipedia/jmcgnh)
[13:52:01] *** Quits: zulutango (~zulutango@static-n58-105-160-58.mas4.nsw.optusnet.com.au) (Ping timeout: 245 seconds)
[13:53:40] *** Joins: zulutango (~zulutango@static-n58-105-160-58.mas4.nsw.optusnet.com.au)
[14:00:14] *** Joins: mannequin (uid453465@id-453465.helmsley.irccloud.com)
[14:05:50] *** Joins: jkotra (~jkotra@106.212.230.185)
[14:22:27] *** Quits: zulutango (~zulutango@static-n58-105-160-58.mas4.nsw.optusnet.com.au) (Remote host closed the connection)
[14:23:08] *** Joins: zulutango (~zulutango@static-n58-105-160-58.mas4.nsw.optusnet.com.au)
[14:31:55] *** Quits: fling (~fling@user/fling) (Ping timeout: 240 seconds)
[14:35:17] *** Joins: fling (~fling@user/fling)
[15:30:16] *** Quits: csrf (~csrf@user/csrf) (Quit: ZNC 1.7.2+deb3 - https://znc.in)
[15:30:59] *** Joins: csrf (~csrf@user/csrf)
[15:36:15] *** Quits: fling (~fling@user/fling) (Ping timeout: 240 seconds)
[15:38:05] *** Joins: fling (~fling@user/fling)
[16:29:12] *** Joins: toulene (~toulene@user/toulene)
[16:35:38] *** Joins: becm (~becm@55d4fad7.access.ecotel.net)
[16:40:01] *** Quits: fling (~fling@user/fling) (Remote host closed the connection)
[16:40:29] *** Joins: fling (~fling@user/fling)
[17:37:35] *** Joins: Pippin__ (Pippin_@openvpn/community/Pippin)
[17:37:35] *** Quits: Pippin_ (Pippin_@openvpn/community/Pippin) (Killed (tantalum.libera.chat (Nickname regained by services)))
[17:37:35] *** ChanServ sets mode: +o Pippin__
[17:37:35] *** Pippin__ is now known as Pippin_
[17:40:11] *** Joins: eelstrebor (~eelstrebo@198-178-29-136.scb.ne.static.allophone.net)
[17:44:14] *** Quits: fling (~fling@user/fling) (Quit: ZNC 1.8.2+deb2+b1 - https://znc.in)
[17:44:39] *** Joins: fling (~fling@user/fling)
[17:56:47] *** Quits: eelstrebor (~eelstrebo@198-178-29-136.scb.ne.static.allophone.net) (Quit: Ex-Chat)
[17:57:37] *** Quits: moffa (~quassel@2607:fea8:a340:871:329c:23ff:fe45:6567) (Ping timeout: 240 seconds)
[17:58:13] *** Joins: moffa (~quassel@cpef02f747ae4a8-cm6c55e88da378.cpe.net.cable.rogers.com)
[18:25:28] *** Quits: Haxxa (~Haxxa@202-130-210-100.ip4.superloop.com) (Ping timeout: 272 seconds)
[18:35:04] *** Joins: yogg (~yogg@cm70-202.liwest.at)
[18:39:07] *** Joins: Haxxa (~Haxxa@202-65-73-230.ip4.superloop.com)
[18:48:15] *** Quits: fling (~fling@user/fling) (Ping timeout: 240 seconds)
[18:51:32] *** Joins: fling (~fling@user/fling)
[19:22:59] *** Quits: fling (~fling@user/fling) (Remote host closed the connection)
[19:23:16] *** Joins: fling (~fling@user/fling)
[19:29:55] *** Quits: Tuvix (~Tuvix@gateway/tor-sasl/tuvix) (Ping timeout: 240 seconds)
[19:33:12] *** Joins: Tuvix (~Tuvix@gateway/tor-sasl/tuvix)
[19:33:50] *** Quits: yogg (~yogg@cm70-202.liwest.at) (Quit: Client closed)
[19:52:35] *** Quits: fling (~fling@user/fling) (Ping timeout: 240 seconds)
[19:54:24] *** Joins: fling (~fling@user/fling)
[20:05:55] *** Joins: krzee (~k@openvpn/krzee)
[21:30:50] *** Quits: doogiehausermd (~doogiehau@user/Dougy) (Quit: Outta here)
[22:28:12] *** Quits: phenom (~primus@user/phenom) (Ping timeout: 240 seconds)
[22:38:48] *** Joins: nitro_ (~nitro_@c-73-165-183-88.hsd1.pa.comcast.net)
[22:45:13] *** Joins: phenom (~primus@user/phenom)
[23:08:35] *** Quits: mannequin (uid453465@id-453465.helmsley.irccloud.com) (Quit: Connection closed for inactivity)
[23:36:36] *** Quits: nerozero (~nerozero@87.253.63.54) (Ping timeout: 240 seconds)
[23:37:01] *** Joins: Pippin__ (Pippin_@openvpn/community/Pippin)
[23:37:01] *** Pippin_ is now known as Guest1990
[23:37:01] *** Quits: Guest1990 (Pippin_@openvpn/community/Pippin) (Killed (mercury.libera.chat (Nickname regained by services)))
[23:37:01] *** ChanServ sets mode: +o Pippin__
[23:37:01] *** Pippin__ is now known as Pippin_
[23:58:44] *** Joins: mannequin (uid453465@id-453465.helmsley.irccloud.com)
