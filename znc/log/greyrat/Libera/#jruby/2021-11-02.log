[04:54:18] *** Joins: subbu (~subbu@user/subbu)
[05:37:17] *** Quits: subbu (~subbu@user/subbu) (Quit: Leaving)
[18:17:23] <headius> good morning!
[18:17:50] <headius> edipo.federle: yeah this would be fixed with a larger project I have wanted to do
[18:18:11] <headius> basically need a way to track instance variables on a per-instance basis rather than having the table be in the class
[18:19:29] <edipofederle[m]> Morning, yes, I'm exploring MRI to see if I can check how they do it. If I find something, I share will share here
[18:43:08] <headius> enebo: so 9.2.20, ready to release?
[18:43:13] <headius> I can put notes together
[18:43:37] <enebo[m]> headius: I actually still need to do some testing on windows but it is up so yeah release notes would be great
[18:43:43] <headius> there are two issues still marked for 9.2.20
[18:43:58] <headius> one is launcher but other seems to be parser related so not sure if you got to that
[18:45:18] <headius> I moved the launcher issue to 9.2.21... but it may be a while before we can fully resolve it because it is waiting on a change to freebsd's java-selecting commands
[18:45:47] <enebo[m]> shoot I missed the parser one
[18:46:37] <enebo[m]> the freebsd one is more icky since we are looking at JAVA_HOME for more than just invoking (like looking for module support)
[18:46:48] <headius> yeah
[18:47:04] <headius> though it did occur to me today this will all be over once we use modules all the time and drop 8
[18:47:19] <enebo[m]> The parser issue itself is so unusual though I think we can punt it
[18:47:27] <headius> ok
[18:47:39] <enebo[m]> You see it was Exc => ///nothing
[18:47:57] <headius> yeah it is a syntax error in CRuby too?
[18:48:22] <enebo[m]> so it sucks we do not return a nice exception and crash but it is not valid syntax
[18:48:45] <enebo[m]> yeah MRI will return 
[18:48:45] <enebo[m]> syntax error, unexpected '\n', expecting '.' or &. or :: or '['
[18:48:49] <enebo[m]> which honestly is not a crash but not helpful at all either
[18:49:24] <headius> heh yeah generic unexpected newline
[18:50:03] <enebo[m]> jruby 9.4.0.0-SNAPSHOT (3.0.2) 2021-10-29 1ad025fd94 OpenJDK 64-Bit Server VM 16.0.2+7 on 16.0.2+7 +jit [linux-x86_64]
[18:50:03] <enebo[m]> SyntaxError: ../../../snippets/pars1.rb:6: syntax error, unexpected '\n'
[18:50:18] <enebo[m]> So it is for sure fixed in 9.4 already
[18:50:32] <enebo[m]> I do not have a 9.3 handy to see if somehow it is already fixed for 9.3
[18:51:10] <enebo[m]> Not entirely sure why we don't provide the expected list but I also never find these expected values to be useful :)
[18:52:55] <headius> hmm
[18:53:17] <headius> shoot
[18:53:31] <headius> bit of a problem
[18:53:50] <headius> the backtrace fix I patched for 9.3.1 also affects 9.2.20
[18:53:57] <headius> https://github.com/jruby/jruby/issues/6846
[18:55:44] <enebo[m]> so while this may be true I think we have to consider that we can put out a 9.2.21.0 after rubyconf and that it has been in 9.2 the entire time right?  So people noticed when they tried 9.3 but did not report it against 9.2
[18:56:10] <headius> 9.2 never had this in a release
[18:56:21] <enebo[m]> OH you backported it
[18:56:25] <headius> it was fixed on 9.2 for 9.2.20 but first went out in 9.3
[18:56:38] <enebo[m]> ok then we should fix it
[18:56:59] <headius> ok, should be an easy backport
[18:57:01] <enebo[m]> ok
[18:58:18] <enebo[m]> going to look at axact AIIOBE error on that parsing issue
[18:58:27] <headius> ok
[19:43:14] *** Quits: sagax (~sagax_nb@user/sagax) (Remote host closed the connection)
[19:46:45] <headius> something failing in backport PR, looking into it
[19:53:48] <headius> of course it passes locally
[19:53:53] <enebo[m]> sure.  I fixed the other issue
[19:54:45] <enebo[m]> It begs a question about why column == 0 but there is no actual harm in the fix since at worst it will not provide an extra line of output in the error stmt
[19:59:18] *** Joins: sagax (~sagax_nb@user/sagax)
[20:03:05] <headius> enebo: https://gist.github.com/headius/35777ee9558844b4d88b6ea5f16e3936
[20:03:15] <headius> almost final
[20:03:42] <enebo[m]> nice
[20:11:43] <headius> ok not sure what's up here
[20:11:56] <headius> this test is just to confirm that extensions will not be attempted to be loaded if we have disabled C ext support
[20:12:14] <headius> it is supposed to fail with a LoadError but is failing with a FrozenError on GHA
[20:12:23] <headius> Travis does not appear to be running PR builds for 9.2 anymore
[20:12:53] <headius> it also does not appear to be running for the commit you just pushed to 9.2
[20:24:44] <headius> oh FFS
[20:24:45] <headius> enebo: "Owner jruby does not have an active subscription."
[20:24:57] <headius> looks like about 6 days ago Travis started rejecting JRuby builds
[20:25:11] <headius> actually no, just a day ago or so
[20:25:59] <headius> yup they kicked us off on the 30s
[20:26:01] <headius> 30th
[20:26:02] <headius> "Expired October 30, 2021"
[20:27:14] <kares[m]> yeah I've been trying to trigger jossl builds since the weekend - thought it would reset on November but not luck
[20:27:27] <headius> kares: wonderful
[20:27:43] <headius> I don't even see how to get a subscription... amazing how much they have killed this thing
[20:27:49] <kares[m]> looking into GH actions, but yet again spending time elsewhere than I had hoped for ...
[20:28:19] <headius> I am trying to activate the free plan now
[20:29:08] <kares[m]> yeah shamy what Travis is doing ... been hit by this several times already - they promised free credits but apparently that went away.
[20:29:08] <kares[m]> maybe the reset period for JRuby is some other date than the 1st
[20:30:19] <headius> "You exceeded the number of users allowed for your plan. Please switch to a bigger plan"
[20:30:30] <headius> "Trial Plan
[20:30:30] <headius> Unlimited unique users"
[20:30:40] <headius> what a clusterfrak
[20:34:11] <headius> I sent a support message asking them to reinstate our service or we'll have to leave... the equivalent to the free plan they had been giving us would be almost $6000/year now
[20:34:58] <headius> running some suites locally to make up for the missing CI now
[20:35:11] <headius> enebo: I merged that PR since other stuff seems to be passing, but I am trying to verify now
[20:35:25] <headius> I guess it is really time to get off travis
[20:51:32] <headius> the same change has been on master and shipped in 9.3.1 so it should be fine but not having CI to verify is rough
[21:07:55] <enebo[m]> yowch
[22:46:59] <enebo[m]> headius: https://gist.github.com/enebo/cd789ecfc67dada96b9b7ec79806164d
[22:47:13] <enebo[m]> Does not happen on linux
[22:48:09] <enebo[m]> going back on linux box to for a bit to try and figure out what is happening
[22:51:20] <headius> if you can get a jit trace it would help
[22:54:33] <headius> tests seem to pass fine locally (macOS) after that backtrace patch merge
[22:55:02] <headius> I'm not sure what causes this failure on GHA
[22:57:18] <enebo[m]> I looked up past references to this method missing and it shows up around openssl not loading
[22:57:33] <enebo[m]> which could have absolutely nothing to do with it obviously
[22:57:41] <headius> yeah it is a pretty generic error
[22:58:30] <enebo[m]> Any other options you are interested in?
[22:59:40] <headius> just jit=0 should show us where it is
[23:06:35] <enebo[m]>   I get no output from setting threshold to 0.  
[23:07:49] <headius> no output??
[23:08:30] <enebo[m]> just the error output itself
[23:08:39] <enebo[m]> derp wait a sec
[23:09:10] <headius> does not repro on macOS either, installs fine
[23:10:13] <enebo[m]>  https://gist.github.com/enebo/34750d822452e075000eb3f594828d26
[23:10:22] <enebo[m]> I am guessing find_command is failing
[23:11:27] <headius> this is a different error
[23:11:43] <headius> it was looking for [] before and now it's looking for this build_args thing
[23:12:38] <enebo[m]> this was in the original error too but lost down below
[23:13:35] <enebo[m]> https://gist.github.com/enebo/cd789ecfc67dada96b9b7ec79806164d#file-err-txt-L490
[23:14:24] <headius> if we could see the trace for that error it might be a root cause
[23:14:51] <headius> it fails to call [] because it gets nil somewhere, which could be causing the later call to fail too
[23:15:31] <enebo[m]> just reading the backtrace it looks like it makes it through find_command without raising so it does self[possibilities.first] which returns nil
[23:15:56] <enebo[m]> I am going to go back to windows side and put in some prints
[23:18:58] <headius> that's pretty weird
[23:22:42] <headius> enebo: MRI core tests, JRuby tests, and RubySpec are green on macOS for me
[23:24:34] <headius> nothing comes to mind as a possible cause
[23:24:45] <headius> for your issue
[23:25:05] <enebo[m]>        https://gist.github.com/enebo/cd789ecfc67dada96b9b7ec79806164d#file-err-txt-L490
[23:25:09] <enebo[m]> whoops
[23:25:12] <enebo[m]> ignore that
[23:25:18] <enebo[m]> It is something with ffi
[23:25:42] <enebo[m]> https://gist.github.com/enebo/19c93950ec3ceeabf6a40392587ada58
[23:25:49] <headius> hmmm
[23:26:03] <headius> GHA may have run on that PR only because it was marked to merge to master at first
[23:26:13] <headius> we do not run GHA for 9.2 branch it seems
[23:26:38] <headius> so that failure may have been a temporary glitch
[23:26:43] <enebo[m]>       crtname = RbConfig::CONFIG["RUBY_SO_NAME"][/msvc\w+/] || 'ucrtbase'
[23:26:54] <headius> I am going to focus on your issue instead
[23:26:56] <headius> hmmm
[23:27:30] <headius> that line does not appear in my copy of 9.2
[23:27:37] <headius> where is it?
[23:28:09] <enebo[m]> lib/ruby/stdlib/ffi/platform.rb
[23:28:13] <headius> FFI would make sense as a cause because it was updated to match the gem
[23:28:36] <enebo[m]> I am looking at this from untar'ing the source dist
[23:29:16] <enebo[m]> ah yeah it is also in my jruby-9.2 dev dir
[23:29:48] <enebo[m]> this logic assumes there will be a RBUY_SO_NAME entry that can be arefed
[23:30:14] <headius> I found it in ffi files
[23:30:17] <enebo[m]> I am going to just fix this on my windows install and make sure nothing else is wrong
[23:30:40] <headius> so that config value is not there
[23:31:03] <headius> it is there in the RbConfigLibrary
[23:31:08] <enebo[m]> I am making that assumption that is it the second call to []
[23:31:23] <enebo[m]> otherwise CONFIG would have gotten blown away
[23:31:27] <enebo[m]> or not loaded
[23:31:46] <headius> yeah which would break a lot of other stuff
[23:31:46] <headius> setConfig(context, mkmfHash, "RUBY_SO_NAME", "jruby");
[23:31:57] <enebo[m]> I will fix it and see ... I will pop back quick if it is even weirder
[23:32:17] <headius> that is a different constant though
[23:32:21] <headius> MAKEFILE_CONFIG
[23:33:16] <headius> aha FFI does modify it
[23:33:46] <headius> nevermind it does not modify but it reads it in a few places
[23:34:14] <enebo[m]>  I just removed the CONFIG lookup and I can see the runner script installing gems now
[23:34:38] <headius> [] ~/projects/jruby-9.2 $ rvm ruby-2.5.7 do ruby -e 'p RbConfig::CONFIG["RUBY_SO_NAME"]'
[23:34:39] <headius> "ruby.2.5.7"
[23:34:39] <headius> [] ~/projects/jruby-9.2 $ ruby -e 'p RbConfig::CONFIG["RUBY_SO_NAME"]'
[23:34:39] <headius> nil
[23:34:40] <enebo[m]> I will go back and verify RUBY_SO_NAME is not an entry though
[23:34:47] <headius> not sure what would have changed here but CRuby does define this
[23:34:53] <enebo[m]> yeah it had to be the case
[23:35:06] <enebo[m]> We probably never had anything query it until now
[23:35:31] <headius> aha that is a good theory
[23:35:35] <headius> it only does that section on Windows
[23:35:47] <headius> so we just need to populate it
[23:36:19] <enebo[m]> https://github.com/ffi/ffi/blame/master/lib/ffi/platform.rb#L135
[23:36:21] <enebo[m]> 5 months old
[23:36:42] <enebo[m]> So this is first time pulling this in and seeing it on windows to break
[23:36:42] <headius> jruby-9.3 $ ruby -e 'p RbConfig::CONFIG["RUBY_SO_NAME"]'
[23:36:43] <headius> "ruby"
[23:36:51] <enebo[m]> HAHA
[23:36:57] <enebo[m]> YAY...upgrade!
[23:37:17] <enebo[m]> may be interesting to see what else happened when that entry was added
[23:38:25] <enebo[m]> rails ran to completion and my simple app is working
[23:38:55] <headius> https://github.com/jruby/jruby/pull/6063
[23:39:30] <headius> so those didn't get picked up when I did the FFI backport
[23:40:24] <headius> I can cp those to 9.2 branch
[23:40:27] <enebo[m]> RUBY_BASE_NAME
[23:40:38] <enebo[m]> yeah
[23:42:27] <headius> pushed those changes
[23:42:40] <enebo[m]> cool...third time will be a charm
[23:57:53] <headius> I am done fiddling with 9.2 and the release notes stand
