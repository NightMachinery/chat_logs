[00:00:36] <doogienz> Command line includes the following ' -map 0:v:0 -map 0:a -c:v hevc_nvenc -preset p4 -profile:v main10 -tier high -rc constqp -rc-lookahead 40 -no-scenecut 1 -init_qpP 23 -init_qpB 25 -init_qpI 21 -weighted_pred 1 -vf scale=1920:1080 -c:a copy -c:s copy -max_muxing_queue_size 9999'
[00:03:27] *** Quits: softworkz (~softworkz@user/softworkz) (Remote host closed the connection)
[00:03:57] *** Joins: softworkz (~softworkz@user/softworkz)
[00:09:14] <jkqxz> doogienz:  Maybe the input to the encoder somehow isn't YUV 4:2:0 10-bit, so it has to use a rext profile rather than main10?  (Might be able to tell if you can find which rext subprofile got used?)
[00:11:02] <doogienz> jkqxz I've checked the source, and they're all YUV 4:2:0 (Type 2) Main 10.
[00:14:43] <doogienz> Source that's always ending up as rext is " Stream #0:0(eng): Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/smpte2084), 3840x2160 [SAR 1:1 DAR 16:9], 23.98 fps, 23.98 tbr, 1k tbn"
[00:15:31] <doogienz> And it always ends up as " Stream #0:0(eng): Video: hevc (Rext), yuv444p16le(tv, bt2020nc/bt2020/smpte2084, progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 2000 kb/s, 23.98 fps, 1k tbn"
[00:15:59] *** Quits: GuiToris (~GuiToris@user/guitoris) (Ping timeout: 265 seconds)
[00:18:31] *** Quits: Flabb (~Flabb@89.169.42.92) (Quit: Leaving)
[00:25:19] <doogienz> I might just force "-pix_fmt p010le"
[00:38:48] *** Quits: Volgaar (~volgaar@104.66.13.93.rev.sfr.net) (Ping timeout: 258 seconds)
[00:43:17] *** Quits: Blacker47 (~Blacker47@user/blacker47) (Quit: Life is short. Get a V.90 modem fast!)
[00:45:17] *** Parts: phinxy (~phinxy@78-71-229-90-no500.tbcn.telia.com) ()
[00:45:23] *** Joins: phinxy (~phinxy@78-71-229-90-no500.tbcn.telia.com)
[01:25:31] *** Joins: GuiToris (~GuiToris@user/guitoris)
[01:30:27] *** Joins: Vonter_ (~Vonter@user/vonter)
[01:34:54] *** Quits: Vonter_ (~Vonter@user/vonter) (Ping timeout: 260 seconds)
[01:41:14] *** Joins: Hello71 (~Hello71@wireguard/contributor/hello71)
[01:48:37] *** Quits: durandal_1707 (~computer@95.168.118.18) (Read error: No route to host)
[02:06:55] *** Quits: nmz1 (~nmz@24.137.228.140) (Quit: EXIT)
[02:07:59] *** Quits: phinxy (~phinxy@78-71-229-90-no500.tbcn.telia.com) (Quit: Client closed)
[02:08:37] *** Quits: palasso (~palasso@user/palasso) (Remote host closed the connection)
[02:18:02] *** Quits: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua) (Quit: Konversation terminated!)
[02:49:59] *** Quits: betelgeuse (~betelgeus@94-225-47-8.access.telenet.be) (Quit: The Lounge - https://thelounge.chat)
[03:01:28] *** Quits: GuiToris (~GuiToris@user/guitoris) (Quit: Sieben Acht Gute Nacht!)
[03:02:33] *** Quits: jkwnki (~jkwnki@p2e5793bc.dip0.t-ipconnect.de) (Ping timeout: 258 seconds)
[03:03:17] *** Joins: causasui (~causasui@c-68-60-125-136.hsd1.mi.comcast.net)
[03:17:36] *** Joins: orthoplex64 (~crm@70.120.0.94)
[03:30:03] *** Joins: unmanbearpig (~unmanbear@user/unmanbearpig)
[03:37:09] *** Joins: sbrown (~sbrown@66.44.16.44)
[03:49:18] *** Quits: auth (~auth@user/auth) (Ping timeout: 260 seconds)
[04:30:29] *** Quits: vlm (~vlm@user/vlm) (Quit: "")
[04:34:39] *** Joins: vlm (~vlm@user/vlm)
[04:43:03] *** Quits: luni-4 (uid453292@id-453292.ilkley.irccloud.com) (Quit: Connection closed for inactivity)
[04:48:26] *** Quits: nrg (~NRG@user/nrg) (Quit: ZNC - https://znc.in)
[04:54:11] *** Joins: softworkz_ (~softworkz@user/softworkz)
[04:54:11] *** Quits: softworkz (~softworkz@user/softworkz) (Killed (molybdenum.libera.chat (Nickname regained by services)))
[04:54:11] *** softworkz_ is now known as softworkz
[04:54:23] *** Quits: realies (~realies@user/realies) (Ping timeout: 264 seconds)
[04:57:33] *** Joins: nrg (~NRG@user/nrg)
[05:01:15] *** Quits: nrg (~NRG@user/nrg) (Client Quit)
[05:04:22] *** Joins: nrg (~NRG@user/nrg)
[05:20:45] *** Joins: realies (~realies@user/realies)
[06:04:52] <aphysically> doogienz: high tier is a bit weird, are you encoding really excessive bitrates?
[06:05:58] *** Quits: jos1 (~jos3@dyndsl-178-142-070-064.ewe-ip-backbone.de) (Ping timeout: 252 seconds)
[06:06:32] <doogienz> aphysically I probably don't need too - it was more copying someone else's configs (tbh it's a frankenstein of 10 different examples) and getting a result that looked good.  I end up with on avg 8mbit - 15mbit depending on the source, so pretty happy with the result.
[06:06:36] <aphysically> at 1080p isn't that indicating you're encoding at bitrates of over 50 megabit or something?
[06:07:20] <aphysically> yeah then you're nowhere in the ballpark of needing to limit your decoders to supporting high tier
[06:07:21] <doogienz> Yeah the media info vs what it actually is certainly differ.
[06:08:11] <aphysically> afaik that does nothing except set a bit in the final product that tells decoders "hey you need to be able to decode at least 50 megabit/s to be able to read this"
[06:08:36] <aphysically> which would just create incompatibilities at worst and do nothing at best
[06:08:36] <doogienz> Okay cool, I'll remove it as main is default right?
[06:08:48] <aphysically> ye
[06:09:15] <aphysically> I need to rerun all my nvenc encoding tests ;[
[06:09:46] <aphysically> they fixed the rc-lookahead parameter so my parameter tuning needs to be redone
[06:10:13] <doogienz> Yeah I'm just trying to get a good compromise.  This is what I've ended up with - removing that tier (I never looked at what it did).
[06:10:26] <doogienz> "-map 0:v:0 -map 0:a -c:v hevc_nvenc -preset p4 -profile:v main10 -pix_fmt p010le -rc constqp -rc-lookahead 40 -no-scenecut 1 -init_qpP 23 -init_qpB 25 -init_qpI 21 -weighted_pred 1 -b:v:0 10M -maxrate:v:0 25M -vf "zscale=-1:1080:f=spline36" -c:a copy -c:s copy -max_muxing_queue_size 9999 "
[06:12:42] <doogienz> That seems to have removed it trying to create a rext profile and quality is a good compromise.  Avg 8-15mbit.
[06:13:02] <aphysically> does that scale really do what you want?
[06:13:51] <aphysically> it creates video with 1080p height but not that fit in a 16:9 1080p screen in case the input is widescreen e.g.
[06:14:01] <doogienz> Yes, it deals with anything that's a non standard size - not everything is a correct ratio unfortunately.
[06:14:19] <aphysically> aren't you creating nonstandard sizes?
[06:15:18] <aphysically> maybe I misremember what zscale does but I thought -1 meant it kept the aspect ratio while scaling to the other value
[06:15:29] <aphysically> so if you have widescreen content you aren't going to get a standard resolution
[06:16:17] <aphysically> like for 2.35:1 video you're making a 2538x1080 video
[06:16:22] <doogienz> I was getting some weird results on pure 1920:1080 scale so that solved it on all those.  Not all my content is correct, it definitely isn't correct I know, but that's what worked for some of my content.
[06:16:38] <doogienz> I wouldn't recommend it for someones 'pure' library.
[06:17:10] <aphysically> yeah as long as you only use it on 16:9 input video it should be fine
[06:17:36] <furq> yeah you want something like scale=1920:1080:force_original_aspect_ratio=decrease
[06:17:41] <furq> although i notice zscale doesn't have that option
[06:17:43] <aphysically> zscale doesn't support that actually
[06:17:57] <aphysically> jinx? :P
[06:18:48] <furq> in that case something like zscale=if(gt(dar,16/9),-2,1920),if(gt(dar,16/9),1080,-2)
[06:18:53] <furq> plus whatever quoting/escaping
[06:18:57] <aphysically> doogienz: im glad removing high tier fixed the problem; I wasn't sure it would but I knew it almost certainly wasn't what you wanted so it never hurt to try
[06:19:28] <doogienz> My biggest fix was actually specifying the output pix_fmt - I was getting rext and no idea why.
[06:19:34] *** Joins: jos1 (~jos3@dyndsl-091-248-050-224.ewe-ip-backbone.de)
[06:19:48] <hyrcanus> i specify it also
[06:19:50] <doogienz> And one of the TV's just HATED rext.
[06:19:54] <furq> "zscale='if(gt(dar,16/9),-2,1920)':'if(gt(dar,16/9),1080,-2)':f=spline36
[06:19:57] <furq> "
[06:20:03] <aphysically> furq: i have something like this https://dpaste.com/GBZ5KPV5P
[06:20:21] <furq> that seems overly complicated
[06:20:27] <aphysically> idk maybe trunc not needed
[06:20:40] <aphysically> yeah it's overly complicated because it avoids upscaling
[06:20:55] <aphysically> it just exclusively downscales to fit in a 1920x1080 box
[06:21:04] <aphysically> I think I can do without the trunc though....I never played with it much
[06:21:45] <aphysically> ah wait, I do want the trunc; I forgot I'm using the trunc to enforce divisible by 2
[06:21:49] <furq> the one i posted should work with min(iw,1920) for the dimensions
[06:21:58] <furq> -2 is the same as -1 but mod2
[06:22:40] <aphysically> yep, I wrote this like a year or so ago so I'm trying to remember what I was thinking :D
[06:23:08] <aphysically> I was probably thinking something like "I wish this damned filter supported the same syntax as the other scale filters"
[06:23:15] <furq> yeah idk what's going on there
[06:23:25] <furq> zscale is a bit weird to say the least
[06:43:17] <doogienz> Now to setup tdarr to do this automagically!
[06:44:06] *** Quits: kilobyte_ch (~kbch@77.109.171.167) (Ping timeout: 265 seconds)
[06:47:30] *** Joins: kilobyte_ch (~kbch@77.109.171.167)
[06:48:59] *** Quits: waleee (~waleee@2001:9b0:216:8200:d457:9189:7843:1dbd) (Ping timeout: 264 seconds)
[06:51:10] *** Quits: sbrown (~sbrown@66.44.16.44) (Quit: Leavingâ€¦)
[07:11:14] *** Joins: alphalpha (~michael@dslb-088-077-182-234.088.077.pools.vodafone-ip.de)
[07:13:04] *** Quits: michael_ (~michael@ipservice-092-209-179-113.092.209.pools.vodafone-ip.de) (Ping timeout: 252 seconds)
[07:13:06] *** Quits: someuser (~user@197.54.29.21) (Read error: Connection reset by peer)
[07:14:36] *** Quits: darkapex (~darkapex@user/darkapex) (Quit: ZNC 1.7.2+deb3 - https://znc.in)
[07:14:48] *** Joins: darkapex_ (~darkapex@user/darkapex)
[07:15:56] *** Quits: video2go (sid515994@id-515994.lymington.irccloud.com) (Ping timeout: 258 seconds)
[07:16:19] *** Quits: linjie (sid455360@id-455360.helmsley.irccloud.com) (Ping timeout: 258 seconds)
[07:17:05] *** Quits: jbg (sid494673@user/jbg) (Ping timeout: 258 seconds)
[07:17:11] *** Quits: fannagoganna (uid110488@id-110488.tinside.irccloud.com) (Ping timeout: 264 seconds)
[07:17:24] *** Joins: video2go (sid515994@lymington.irccloud.com)
[07:18:57] *** Joins: linjie (sid455360@helmsley.irccloud.com)
[07:19:38] *** Joins: jbg (sid494673@user/jbg)
[07:19:40] *** Joins: Vonter_ (~Vonter@user/vonter)
[07:19:41] *** Joins: fannagoganna (uid110488@id-110488.tinside.irccloud.com)
[07:22:58] *** Joins: deepin (~deepin@119.4.240.125)
[07:23:59] *** Quits: Vonter_ (~Vonter@user/vonter) (Ping timeout: 258 seconds)
[07:34:17] *** Quits: blinky42 (~quassel@user/blinky42) (Ping timeout: 264 seconds)
[07:35:43] *** Joins: blinky42 (~quassel@jabber.blinkylight.net)
[07:35:43] *** Quits: blinky42 (~quassel@jabber.blinkylight.net) (Changing host)
[07:35:43] *** Joins: blinky42 (~quassel@user/blinky42)
[07:38:22] *** Joins: someuser (~user@197.54.11.122)
[07:47:38] *** graphitemaster_ is now known as graphitemaster
[08:29:15] *** Joins: nmz (~nmz@24.137.228.140)
[08:33:42] *** Quits: doogienz (~doogienz@114.23.104.82) (Quit: Connection closed)
[08:38:00] *** Quits: zmt00 (~zmt00@user/zmt00) (Read error: Connection reset by peer)
[08:42:12] *** Joins: zmt00 (~zmt00@user/zmt00)
[08:48:47] *** Joins: yeirr (~yeirr@user/yeirr)
[08:52:08] *** Bertl_oO is now known as Bertl_zZ
[08:59:34] *** Joins: furrymcgee (~devuan@cgn-89-1-210-103.nc.de)
[09:01:41] *** Joins: vocalfan (~vocalfan@199-66-65-93.iplwin75.metronetinc.net)
[09:02:34] <vocalfan> Heyya
[09:03:05] <vocalfan> I've been mainly having an issue with H264 decoding via Ryujinx, not even the leading dev knows why the error occurs.
[09:03:19] <vocalfan> Ryujinx.NvdecProcessor Application : Unhandled exception caught: System.ArgumentNullException: Value cannot be null. (Parameter 'ptr')
[09:03:27] *** Joins: vqueiroz (uid340368@id-340368.hampstead.irccloud.com)
[09:05:58] <vocalfan> If you need any more details, just ask :3
[09:08:46] <hyrcanus> hi vocalfan the ryujinx emulator is emulating nvidia gpu hardware?
[09:09:02] <hyrcanus> i have similar tegra hardware here
[09:09:06] <vocalfan> Yes, due to the Switch using an Nvidia chip
[09:09:50] <hyrcanus> good luck i guess
[09:10:22] <hyrcanus> there's nvidia/ffmpeg decoding using that gpu but..
[09:10:36] <vocalfan> https://pastebin.com/jYFBSt0F
[09:10:37] <hyrcanus> so far i only have gstreamer working
[09:10:41] <vocalfan> Here's my system info
[09:10:48] <vocalfan> FFMpeg info is a the bottom
[09:14:15] <hyrcanus> if possible see if ffmpeg can be invoked to not use the 'hardware acceleration' in that emulator
[09:14:36] <vocalfan> Hmm? How would I do so?
[09:14:52] <hyrcanus> forward that to the emu author
[09:15:02] <hyrcanus> you're not getting a performance gain
[09:15:06] <vocalfan> It's just a ./Ryujinx for executing -w-
[09:15:20] <hyrcanus> are you using tegra /hardware/?
[09:16:10] <vocalfan> *You could look at the pastebin*
[09:16:19] <vocalfan> Ryzen 9 3900x, 5700xt
[09:16:41] <hyrcanus> then the emulator isn't getting any performance gain by invoking ffmpeg with HWdec
[09:18:41] <vocalfan> "it should be already disabled I believe?
[09:18:41] <vocalfan> it doesnt request an hw accelerated decoder" -Gdkchan (Main dev)
[09:18:47] *** Joins: softworkz_ (~softworkz@user/softworkz)
[09:18:47] *** Quits: softworkz (~softworkz@user/softworkz) (Killed (tungsten.libera.chat (Nickname regained by services)))
[09:18:47] *** softworkz_ is now known as softworkz
[09:19:24] <furq> NvdecProcessor sure sounds like it's requesting hwdec
[09:19:38] <furq> i have no idea how that would even work through an emulator
[09:20:52] <vocalfan> Hmm... Would you like the open-source code?
[09:21:35] <furq> i suspect it'll be something only the emulator devs can deal with
[09:21:45] <hyrcanus> ^
[09:21:56] <vocalfan> When GDK has no fucking idea-
[09:22:14] <furq> trying to emulate whatever hwdec asic the switch is using on generic pc hardware sounds extremely specific
[09:22:15] <vocalfan> He can't reproduce it, it seems to be people only with AMD gpus, GDK has Nvidia
[09:22:30] <vocalfan> https://github.com/Ryujinx/Ryujinx/blob/master/Ryujinx.Graphics.Nvdec.FFmpeg/FFmpegContext.cs#L27
[09:22:34] <vocalfan> Here's where it crashes
[09:25:55] <hyrcanus> it's possible that the software running on the switch assumes nvdec, so he has to run it with emulated GPU
[09:26:11] *** Quits: causasui (~causasui@c-68-60-125-136.hsd1.mi.comcast.net) (Ping timeout: 264 seconds)
[09:26:17] <vocalfan> Why...
[09:26:26] <vocalfan> Why do you think we have an entire section just for NVDec?
[09:26:50] <hyrcanus> i don't know
[09:26:57] <hyrcanus> possibly an error
[09:27:03] <vocalfan> Because we emulate NVDec-
[09:27:09] <hyrcanus> do you need to?
[09:27:21] <vocalfan> You hurt me.
[09:27:30] <vocalfan> The switch has an NVidia GPU.
[09:27:33] <vocalfan> It uses NVdec.
[09:27:43] <vocalfan> SO WE ARE EMULATING IT.
[09:27:46] <hyrcanus> this is #ffmpeg btw :)
[09:27:50] <vocalfan> Because this is a switch emulator.
[09:28:01] <vocalfan> Yes, and we use FFMpeg for some parts of NVDec
[09:28:06] <vocalfan> Mister #ffmpeg
[09:28:28] <hyrcanus> if ffmpeg is being called in order to do video decoding, then ffmpeg can use software decoding
[09:28:30] <hyrcanus> which will be faster
[09:28:46] <hyrcanus> is what i'm saying
[09:29:19] <vocalfan> And gdk literally said it doesn't request an hw accelerated decoder.
[09:29:39] <hyrcanus> but Nvdec is the hw accelerated decoder
[09:29:47] <vocalfan> Holy fucking shit.
[09:29:49] <hyrcanus> so something isn't adding up
[09:29:55] <vocalfan> We are E M U L A T I N G nvdec
[09:30:02] <vocalfan> We're not actually using the bitch.
[09:30:35] <hyrcanus> yes and if you could avoid that, you'd do better
[09:30:42] <hyrcanus> performancewise
[09:30:43] <vocalfan> But we can't.
[09:30:46] <hyrcanus> ok
[09:30:52] <vocalfan> Because we're emulating the switch
[09:30:56] <vocalfan> That has an nvidia chip
[09:30:59] <vocalfan> That uses NVdec
[09:31:15] <vocalfan> So stop trying to make us drop something to make a lot of games work
[09:31:23] <vocalfan> And tell me how tf to fix the ptr crash.
[09:31:36] <hyrcanus> i'll stop discussing a topic not related to ffmpeg now
[09:31:59] <vocalfan> Holy shit you're braindead.
[09:32:01] *** Parts: vocalfan (~vocalfan@199-66-65-93.iplwin75.metronetinc.net) (Leaving)
[09:44:21] *** nobody is now known as youmustrust
[09:45:31] *** Joins: durandal_1707 (~computer@95.168.120.83)
[09:46:03] <youmustrust> when transcoding AAC adts <> AAC asc, all i see is 'aac_adtstoasc'. is ther other way around automatically done by ffmpeg?
[09:46:36] *** Joins: kib (~kib@user/kib)
[09:46:44] *** yukon_ is now known as valdez
[09:47:53] *** Joins: vocalfan (~vocalfan@199-66-65-93.iplwin75.metronetinc.net)
[09:48:32] <vocalfan> Sorry just... After explaining like.. 10 times why we have touse NVDec, then you immediately disagreeing and being stubborn, kind of... Annoys me.
[09:51:36] <vocalfan> Like, we can't just... Not emulate NVDec.
[09:51:47] <vocalfan> When it's literally a part of the console we're emulating.
[09:52:03] <vocalfan> We use FFMpeg for the H264 decoding, which is what's crashing.
[09:56:28] *** Quits: AbleBacon (~AbleBacon@user/AbleBacon) (Read error: Connection reset by peer)
[09:58:37] *** Joins: Jerrk (~Jerrk@185.213.154.237)
[10:04:13] *** Quits: gucky-chat-laden (~gucky-cha@46.41.28.214) (Ping timeout: 258 seconds)
[10:05:47] *** Quits: yeirr (~yeirr@user/yeirr) (Ping timeout: 264 seconds)
[10:06:22] *** Quits: unmanbearpig (~unmanbear@user/unmanbearpig) (Ping timeout: 260 seconds)
[10:08:26] *** Joins: Vonter_ (~Vonter@user/vonter)
[10:12:39] *** Quits: Vonter_ (~Vonter@user/vonter) (Ping timeout: 258 seconds)
[10:17:38] *** Quits: Trieste_ (T@user/pilgrim) (Ping timeout: 258 seconds)
[10:17:56] *** Joins: Trieste (T@user/pilgrim)
[10:21:11] *** Quits: vocalfan (~vocalfan@199-66-65-93.iplwin75.metronetinc.net) (Quit: Leaving)
[10:22:19] *** Quits: Jerrk (~Jerrk@185.213.154.237) (Remote host closed the connection)
[10:23:50] *** Joins: SimAV (~SimAV@ip1f10fb08.dynamic.kabel-deutschland.de)
[10:28:36] *** Quits: morpheuz (~morpheuz@user/morpheuz) (Quit: --)
[10:29:26] *** Joins: yeirr (~yeirr@user/yeirr)
[10:32:31] *** Joins: Jerrk (~Jerrk@185.213.154.231)
[10:38:24] *** Joins: Flabb (~Flabb@89.169.42.92)
[10:42:18] *** Joins: morpheuz (~morpheuz@user/morpheuz)
[10:42:42] *** Joins: softworkz_ (~softworkz@user/softworkz)
[10:42:42] *** softworkz is now known as Guest4596
[10:42:42] *** Quits: Guest4596 (~softworkz@user/softworkz) (Killed (molybdenum.libera.chat (Nickname regained by services)))
[10:42:42] *** softworkz_ is now known as softworkz
[10:43:22] *** Joins: palasso (~palasso@user/palasso)
[10:44:19] *** Quits: palasso (~palasso@user/palasso) (Remote host closed the connection)
[10:49:05] *** Joins: palasso (~palasso@user/palasso)
[10:54:16] *** Quits: morpheuz (~morpheuz@user/morpheuz) (Quit: --)
[10:57:04] *** Joins: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua)
[11:03:22] *** Joins: cmp99 (~cmp@lputeaux-658-1-177-87.w92-154.abo.wanadoo.fr)
[11:09:03] *** Joins: jkwnki (~jkwnki@p2e5793bc.dip0.t-ipconnect.de)
[11:10:58] *** Quits: durandal_1707 (~computer@95.168.120.83) (Read error: Connection reset by peer)
[11:13:42] *** Joins: softworkz_ (~softworkz@user/softworkz)
[11:13:42] *** Quits: softworkz (~softworkz@user/softworkz) (Killed (tungsten.libera.chat (Nickname regained by services)))
[11:13:42] *** softworkz_ is now known as softworkz
[11:15:48] *** Joins: Volgaar (~volgaar@nat-wifi-eduroam.reseau.univ-paris13.fr)
[11:28:10] *** Joins: morpheuz (~morpheuz@user/morpheuz)
[11:29:12] *** Joins: softworkz_ (~softworkz@user/softworkz)
[11:29:12] *** softworkz is now known as Guest8629
[11:29:12] *** Quits: Guest8629 (~softworkz@user/softworkz) (Killed (molybdenum.libera.chat (Nickname regained by services)))
[11:29:12] *** softworkz_ is now known as softworkz
[11:35:47] *** Joins: auth (~auth@user/auth)
[11:38:39] *** Joins: doogienz (~doogienz@162.251.238.146)
[11:43:15] *** Joins: softworkz_ (~softworkz@user/softworkz)
[11:43:15] *** softworkz is now known as Guest7906
[11:43:15] *** Quits: Guest7906 (~softworkz@user/softworkz) (Killed (sodium.libera.chat (Nickname regained by services)))
[11:43:15] *** softworkz_ is now known as softworkz
[11:51:03] *** Joins: unmanbearpig (~unmanbear@user/unmanbearpig)
[11:53:49] <youmustrust> Guys, what can I do if duration does not match pts gaps? I'm transcoding a video, and aac pts graps are sometimes shorter than pkt->duration. Is there any flags/options I can use?
[12:03:34] *** Joins: waagrr (~stoutcho2@220.85.70.23)
[12:03:50] <hyrcanus> sorry i can't give info
[12:07:12] *** Joins: softworkz_ (~softworkz@user/softworkz)
[12:07:12] *** Quits: softworkz (~softworkz@user/softworkz) (Killed (tungsten.libera.chat (Nickname regained by services)))
[12:07:12] *** softworkz_ is now known as softworkz
[12:09:57] <JEEB> youmustrust: if you are transcoding you're re-encoding the audio so AVFrame number of samples is your point of truth
[12:10:10] <JEEB> I mean, it's shit, but what can you do :P
[12:11:57] <youmustrust> Aha, I see... so it's possible that some samples are missing.
[12:23:27] *** Quits: ivanich (~ivanich@45-140-123-239.broadband.tenet.odessa.ua) (Read error: Connection reset by peer)
[12:23:32] *** Joins: ivanich_ (~ivanich@45-140-123-239.broadband.tenet.odessa.ua)
[12:32:07] *** Joins: TheSash__ (~TheSashmo@158.106.77.7)
[12:34:49] *** Quits: TheSashmo (~TheSashmo@158.106.77.7) (Ping timeout: 252 seconds)
[12:36:21] *** Quits: yeirr (~yeirr@user/yeirr) (Quit: yeirr)
[12:40:44] *** Quits: kib (~kib@user/kib) (Read error: Connection reset by peer)
[12:46:13] *** Joins: kib (~kib@user/kib)
[13:05:52] *** Quits: doogienz (~doogienz@162.251.238.146) (Quit: Connection closed)
[13:07:17] *** Quits: mickey8 (~user@user/mickey) (Quit: Ping timeout (120 seconds))
[13:08:12] *** Joins: mickey8 (~user@user/mickey)
[13:11:01] *** Quits: jos1 (~jos3@dyndsl-091-248-050-224.ewe-ip-backbone.de) ()
[13:12:30] *** Joins: gucky-chat-laden (~gucky-cha@46.41.28.214)
[13:24:35] *** Parts: gucky-chat-laden (~gucky-cha@46.41.28.214) ()
[13:50:19] *** Joins: softworkz_ (~softworkz@user/softworkz)
[13:50:19] *** softworkz is now known as Guest7084
[13:50:19] *** Quits: Guest7084 (~softworkz@user/softworkz) (Killed (molybdenum.libera.chat (Nickname regained by services)))
[13:50:19] *** softworkz_ is now known as softworkz
[14:06:42] *** Joins: gucky-chat-laden (~gucky-cha@46.41.28.214)
[14:10:42] <pagios> hi guys, how can i keep playing a given mp4 file over and over, want to read from the network and not replay the cached / downloaded mp4
[14:10:50] <pagios> i want to keep consuming from the network
[14:11:58] *** Joins: jos1 (~jos3@dyndsl-091-248-050-224.ewe-ip-backbone.de)
[14:20:23] *** Quits: bpmedley (~bpmedley@2600:1700:e2c:8410:745a:eb38:aacf:8895) (Ping timeout: 246 seconds)
[14:32:09] <hyrcanus> idk
[14:41:06] <furrymcgee> a loop?
[14:42:30] *** Joins: bpmedley (~bpmedley@2600:1700:e2c:8410:85b:ac46:bf79:4c0a)
[14:45:12] *** Joins: mikisid (~mikisid@178-221-173-138.dynamic.isp.telekom.rs)
[14:47:44] *** Quits: bpmedley (~bpmedley@2600:1700:e2c:8410:85b:ac46:bf79:4c0a) (Read error: Connection reset by peer)
[14:48:44] *** Joins: bpmedley (~bpmedley@2600:1700:e2c:8410:85b:ac46:bf79:4c0a)
[14:54:56] *** Joins: iive (~iive@87.119.101.204.client.entry.bg)
[14:57:45] *** Joins: Vonter_ (~Vonter@user/vonter)
[15:02:04] *** Quits: Vonter_ (~Vonter@user/vonter) (Ping timeout: 258 seconds)
[15:02:04] *** Quits: SimAV (~SimAV@ip1f10fb08.dynamic.kabel-deutschland.de) (Ping timeout: 258 seconds)
[15:22:57] *** Quits: mikisid (~mikisid@178-221-173-138.dynamic.isp.telekom.rs) (Remote host closed the connection)
[15:23:18] *** Joins: mikisid (~mikisid@178-221-173-138.dynamic.isp.telekom.rs)
[15:24:42] *** Bertl_zZ is now known as Bertl
[15:26:54] *** Quits: mikisid (~mikisid@178-221-173-138.dynamic.isp.telekom.rs) (Remote host closed the connection)
[15:27:18] *** Joins: mikisid (~mikisid@178-221-173-138.dynamic.isp.telekom.rs)
[15:29:47] *** Quits: bpmedley (~bpmedley@2600:1700:e2c:8410:85b:ac46:bf79:4c0a) (Ping timeout: 264 seconds)
[15:31:24] <roxlu> Hey, I'm trying to integrate ffmpeg logging with a logging library but it always triggers a segfault. I don't see anything wrong with the av_log() line but not sure what is causing this segfault. I've pasted the segfault and relevant code here: https://gist.github.com/roxlu/681ecafe7e2dd6c32e7ef3565be11d34  Any thoughts what might trigger this segfault?
[15:31:59] <roxlu> I'm not entirely sure about this: https://gist.github.com/roxlu/681ecafe7e2dd6c32e7ef3565be11d34#file-crash-log-L7  e.g. Why does it show \'030 there.
[15:35:37] *** Joins: waleee (~waleee@2001:9b0:216:8200:d457:9189:7843:1dbd)
[15:35:59] <roxlu> It's not an threading issue as far as I can say; I've wrapped the log around a mutex currently.
[15:40:00] <BtbN> Looks like something is calling strlen on something invalid
[15:40:24] *** Quits: mikisid (~mikisid@178-221-173-138.dynamic.isp.telekom.rs) (Read error: Connection reset by peer)
[15:40:55] <jkqxz> Does ZF_LOGV() actually take a va_list?  Frame 5 doesn't have it, so maybe it's really a vararg function.
[15:44:29] <roxlu> thanks! I was reading this post https://github.com/wonder-mice/zf_log/issues/10 where the author uses something similar; only difference is that I already receive a va_list.
[15:47:26] <jkqxz> Right.  So unless you want to do something much more complex to try to link whatever this library wants to what ffmpeg gives you then you should probably just vsnprintf() into a buffer and log that.
[15:49:45] *** Joins: bpmedley (~bpmedley@2600:1700:e2c:8410:85b:ac46:bf79:4c0a)
[15:52:46] <roxlu> hmm I just cleaned my build dir and recompiled; now I'm seeing: `10-19 14:21:20.722 224520 224520 V ffmpeg_log_callback@log.c:54 Opening '' for HMHU??uHEH}WA~`
[15:53:34] <roxlu> But interstingly I also see lots of other messages. Ofc. there is something wrong ... I'll use vsnprintf() or `av_log_format_line(`
[16:10:14] *** Quits: waleee (~waleee@2001:9b0:216:8200:d457:9189:7843:1dbd) (Ping timeout: 265 seconds)
[16:11:58] *** Joins: waleee (~waleee@h-98-128-228-119.NA.cust.bahnhof.se)
[16:12:05] <roxlu> Using `av_log_format_line()` works, but is there a way to get the line and filename from the log callback? I don't think that ffmpeg supports this but I could be wrong.
[16:12:57] <pagios> furrymcgee: yes
[16:12:58] <pagios> loop
[16:13:01] *** Joins: cosimone (~user@2001:b07:ae5:db26:c24a:d20:4d91:1e20)
[16:14:23] <furrymcgee> running on server or client?
[16:23:34] *** Quits: tar_xvf (~tar_xvf@ec2-3-136-243-174.us-east-2.compute.amazonaws.com) (Ping timeout: 252 seconds)
[16:26:44] *** Joins: tar_xvf (~tar_xvf@ec2-3-136-243-174.us-east-2.compute.amazonaws.com)
[16:28:43] *** Joins: minimal (~minimal@user/minimal)
[17:15:33] *** Quits: Hello71 (~Hello71@wireguard/contributor/hello71) (Remote host closed the connection)
[17:16:05] *** Joins: Hello71 (~Hello71@wireguard/contributor/hello71)
[17:31:16] *** Quits: troyt (troyt@2601:681:4100:d591:44dd:acff:fe85:9c8e) (Ping timeout: 252 seconds)
[17:42:23] *** Quits: bpmedley (~bpmedley@2600:1700:e2c:8410:85b:ac46:bf79:4c0a) (Ping timeout: 264 seconds)
[17:45:10] *** Joins: bpmedley (~bpmedley@2600:1700:e2c:8410:85b:ac46:bf79:4c0a)
[17:49:34] *** Joins: nillyhan (~00000000@user/nillyhan)
[17:51:21] *** Quits: thunfisch (~thunfisch@user/thunfisch) (Ping timeout: 245 seconds)
[17:53:16] *** Joins: thunfisch (~thunfisch@user/thunfisch)
[17:58:19] *** Joins: ASSISTENZA (~Username@net-47-53-74-164.cust.vodafonedsl.it)
[17:58:19] *** Quits: ASSISTENZA (~Username@net-47-53-74-164.cust.vodafonedsl.it) (Excess Flood)
[18:08:50] *** Joins: rsx (~dummy@ppp-188-174-140-121.dynamic.mnet-online.de)
[18:12:29] *** Joins: ASSISTENZA (~Username@net-47-53-74-164.cust.vodafonedsl.it)
[18:12:30] *** Quits: ASSISTENZA (~Username@net-47-53-74-164.cust.vodafonedsl.it) (Excess Flood)
[18:20:39] *** Quits: Keshl (~Purple@idlerpg/player/Keshl) (Quit: Konversation terminated!)
[18:26:24] *** Joins: SimAV (~SimAV@bt-nac-6041.nac.uni-bayreuth.de)
[18:37:30] *** Quits: Volgaar (~volgaar@nat-wifi-eduroam.reseau.univ-paris13.fr) (Ping timeout: 258 seconds)
[18:59:01] *** Quits: cosimone (~user@2001:b07:ae5:db26:c24a:d20:4d91:1e20) (Read error: Connection reset by peer)
[19:10:51] *** Quits: jkwnki (~jkwnki@p2e5793bc.dip0.t-ipconnect.de) (Ping timeout: 265 seconds)
[19:12:23] *** Quits: furrymcgee (~devuan@cgn-89-1-210-103.nc.de) (Quit: leaving)
[19:18:36] *** Joins: Keshl (~Purple@idlerpg/player/Keshl)
[19:28:47] *** Joins: AbleBacon (~AbleBacon@user/AbleBacon)
[19:32:48] *** Quits: vqueiroz (uid340368@id-340368.hampstead.irccloud.com) (Quit: Connection closed for inactivity)
[19:50:24] *** Joins: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net)
[19:57:56] *** Quits: cmp99 (~cmp@lputeaux-658-1-177-87.w92-154.abo.wanadoo.fr) (Quit: Ping timeout (120 seconds))
[19:58:42] *** Joins: softworkz_ (~softworkz@user/softworkz)
[19:58:42] *** softworkz is now known as Guest5775
[19:58:42] *** softworkz_ is now known as softworkz
[20:02:11] *** Quits: Guest5775 (~softworkz@user/softworkz) (Ping timeout: 264 seconds)
[20:02:41] *** Joins: cosimone (~user@93-47-230-89.ip115.fastwebnet.it)
[20:03:12] *** Joins: softworkz_ (~softworkz@user/softworkz)
[20:03:12] *** softworkz is now known as Guest6485
[20:03:13] *** softworkz_ is now known as softworkz
[20:06:23] *** Quits: Guest6485 (~softworkz@user/softworkz) (Ping timeout: 264 seconds)
[20:16:49] *** Joins: durandal_1707 (~computer@95.168.120.92)
[20:18:00] *** softworkz is now known as Guest7217
[20:18:10] *** Joins: softworkz (~softworkz@user/softworkz)
[20:20:13] *** Joins: troyt (troyt@2601:681:4100:d591:44dd:acff:fe85:9c8e)
[20:20:30] *** Quits: Guest7217 (~softworkz@user/softworkz) (Ping timeout: 260 seconds)
[20:29:20] *** Quits: kib (~kib@user/kib) (Quit: WeeChat 3.3)
[20:36:14] *** Quits: mickey8 (~user@user/mickey) (Quit: Ping timeout (120 seconds))
[20:38:18] *** Quits: minimal (~minimal@user/minimal) (Quit: Leaving)
[20:38:57] *** Joins: mickey8 (~user@user/mickey)
[20:41:25] *** Joins: sbrown (~sbrown@66.44.16.44)
[20:43:37] *** Quits: Keshl (~Purple@idlerpg/player/Keshl) (Ping timeout: 258 seconds)
[20:44:40] *** Joins: Keshl (~Purple@idlerpg/player/Keshl)
[20:45:10] *** Joins: betelgeuse (~betelgeus@94-225-47-8.access.telenet.be)
[20:53:15] *** Joins: vagrantc (~vagrant@2600:3c01:e000:21:21:21:0:100b)
[20:53:15] *** Parts: vagrantc (~vagrant@2600:3c01:e000:21:21:21:0:100b) ()
[20:54:23] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Ping timeout: 264 seconds)
[20:54:28] *** Quits: mickey8 (~user@user/mickey) (Remote host closed the connection)
[20:55:05] *** Joins: mickey8 (~user@user/mickey)
[20:59:05] *** Joins: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net)
[21:02:56] *** Joins: zsoltiv_ (~zsoltiv@fibhost-67-12-35.fibernet.hu)
[21:03:59] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Ping timeout: 264 seconds)
[21:08:12] *** Joins: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net)
[21:10:27] *** Quits: SimAV (~SimAV@bt-nac-6041.nac.uni-bayreuth.de) (Ping timeout: 258 seconds)
[21:14:49] *** NaviTheFairy is now known as ScareSquirrel
[21:24:53] *** Joins: softworkz_ (~softworkz@user/softworkz)
[21:24:53] *** Quits: softworkz (~softworkz@user/softworkz) (Killed (molybdenum.libera.chat (Nickname regained by services)))
[21:24:53] *** softworkz_ is now known as softworkz
[21:25:29] *** Joins: phinxy (~phinxy@78-71-229-90-no500.tbcn.telia.com)
[21:29:10] <phinxy> Can anyone give me a ballpark figure on how much CPU would be relieved with GPU accelerated "motion compensation" only?  The GPU is old and has no h264 decoding.  Is it worth trying to get working, the CPU is only fast enough for 720p.
[21:30:17] *** Joins: jkwnki (~jkwnki@p2e5793bc.dip0.t-ipconnect.de)
[21:32:30] *** Quits: l4yer (~l4yer@2a02:6ea0:e102:0:1011:23c9:cfaf:3bc9) (Ping timeout: 268 seconds)
[21:33:01] <phinxy> Aha, there is XvMC.  Might have to abondon Wayland then and try it out.
[21:39:18] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Quit: No Ping reply in 180 seconds.)
[21:39:38] *** Bertl is now known as Bertl_oO
[21:52:31] *** Quits: phinxy (~phinxy@78-71-229-90-no500.tbcn.telia.com) (Quit: Client closed)
[21:53:40] *** Joins: l4yer (~l4yer@2a02:6ea0:e102:0:1011:8d08:ca14:8f03)
[21:55:59] *** Joins: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net)
[21:57:13] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Client Quit)
[21:58:33] *** Joins: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net)
[21:59:05] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Client Quit)
[21:59:47] *** Quits: cosimone (~user@93-47-230-89.ip115.fastwebnet.it) (Ping timeout: 264 seconds)
[22:00:25] *** Joins: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net)
[22:04:49] *** Joins: cosimone (~user@93-47-230-89.ip115.fastwebnet.it)
[22:26:26] *** Joins: noarb- (~noarb@user/noarb)
[22:26:36] *** Joins: kib (~kib@user/kib)
[22:27:36] *** Quits: noarb (~noarb@user/noarb) (Ping timeout: 245 seconds)
[22:30:24] <kepstin> i don't think xvmc ever supported h264? it was mostly for mpeg2 stuff
[22:30:36] <kepstin> back in the days when decoding dvd video was challenging for pcs :)
[22:33:12] *** Joins: bartzy (~bartzy@5.29.33.36)
[22:34:19] *** Joins: softworkz_ (~softworkz@user/softworkz)
[22:34:19] *** softworkz is now known as Guest5950
[22:34:19] *** Quits: Guest5950 (~softworkz@user/softworkz) (Killed (sodium.libera.chat (Nickname regained by services)))
[22:34:19] *** softworkz_ is now known as softworkz
[22:34:39] <bartzy> Is it a known bug where a ProRes 422 HQ to rgb24 png sequence would produce slightly different colors than rgb48be?
[22:35:58] <bartzy> Weirdly, the same file but in ProRes 4444, with the same exact colors in the mov files, when converted to RGB24 PNG through ffmpeg, produces the correct colors (same as 422HQ->rgb48be). It's also 3.5MB while still 8-bit, while 422HQ->rgb24 is 2MB while 8-bit
[22:37:36] <bartzy> so: 422hq == 4444 in a given frame (I checked with various methods). 4444 -> rgb24 png = 3.5MB file and same colors, 422hq -> rgb24 = 2MB file and different colors, 422hq -> rgb48be = 6.9MB file and same colors.
[22:37:47] <bartzy> what am I doing wrong here?
[22:38:47] *** Quits: troyt (troyt@2601:681:4100:d591:44dd:acff:fe85:9c8e) (Ping timeout: 264 seconds)
[22:38:57] *** Joins: phinxy (~phinxy@78-71-229-90-no500.tbcn.telia.com)
[22:40:42] *** Joins: softworkz_ (~softworkz@user/softworkz)
[22:40:42] *** softworkz is now known as Guest6249
[22:40:42] *** softworkz_ is now known as softworkz
[22:44:14] *** Quits: Guest6249 (~softworkz@user/softworkz) (Ping timeout: 260 seconds)
[22:47:12] *** Joins: softworkz_ (~softworkz@user/softworkz)
[22:47:12] *** Quits: softworkz (~softworkz@user/softworkz) (Killed (molybdenum.libera.chat (Nickname regained by services)))
[22:47:12] *** softworkz_ is now known as softworkz
[22:50:05] *** Joins: troyt (~troyt@2601:681:4100:d591:44dd:acff:fe85:9c8e)
[23:00:05] <JEEB> bartzy: in case your FFmpeg build comes with zscale enabled via zimg library, is by chance zscale,format=pix_fmts=gbrp,scale,format=rgb24 such that it does not get affected?
[23:00:28] <JEEB> that causes zscale to handle the YCbCr to RGB conversion, and scale filter just doing the packing into rgb24
[23:00:46] <JEEB> (also utilize `-v verbose` to check that additional filters are not being added into the filter chain
[23:00:57] <JEEB> (since it logs all of the connections)
[23:01:04] <bartzy> JEEB: I do have zscale enabled for my build, but why do the pix_fmts=gbrp and the scale at the end?
[23:01:15] <bartzy> (also, checking now)
[23:01:26] <JEEB> the line after that explains the two-step thing
[23:01:39] <JEEB> mostly because zimg and thus zscale only support planar video by default
[23:01:48] <JEEB> gbrp is planar 8bit rgb
[23:02:02] <JEEB> so that you have one buffer for each of R, G and B
[23:02:05] <JEEB> while rgb24 is packed
[23:02:25] <JEEB> you have a single buffer which has r,g,b one after another for the same sample
[23:02:38] <bartzy> but they're equivalent? just different structures internally for the same rgb(24/48) data?
[23:03:03] <JEEB> rgb24 is 8 bit per plane, so thus the same
[23:03:46] <JEEB> 48 I think is 16bit per plane, and its equivalent in planar is gbrp16
[23:04:19] <bartzy> just before you messaged me, I tried this: ffmpeg -i 0284.mov -r 30 -vf format=yuva444p12le -pix_fmt rgb24 pngs_funnel/0284_%05d.png
[23:04:34] <bartzy> which weirdly also provides the correct colors.
[23:04:53] <bartzy> 0284.mov is a 422hq (reported by ffprobe as yuv422p10le)
[23:05:46] <JEEB> anyways, I recall there being some reports for some bit depth code paths in swscale being funky, but I'm not brave enough to go into that stuff: I have enough of "asdf this is broken too" moments lately.
[23:06:08] <bartzy> and zscale is a replacement for swscale in that regard?
[23:06:19] <bartzy> I'm not quite following what zimg/zscale actually is and what it's for
[23:06:31] <bartzy> (besides going through some of the repo on github)
[23:06:43] <JEEB> zimg is a newer CPU based image format conversion/scaling library, and zscale is a filter utilizing it
[23:07:14] <JEEB> it has less optimizations from early 2000s :)
[23:07:58] <bartzy> by newer CPU-based you mean that swscale is non-CPU (i.e. GPU?) based, or just older-CPU-based? :D
[23:08:22] <JEEB> just older CPU based
[23:08:28] <bartzy> I see
[23:08:49] <bartzy> OK yep - your solution worked as well! -  ffmpeg -i 0284.mov -r 30 -vf zscale,format=pix_fmts=gbrp,scale,format=rgb24  pngs_jeeb/0284_%05d.png
[23:09:04] <JEEB> and if you look at -v verbose output
[23:09:09] <JEEB> you should see teh connections
[23:09:23] <JEEB> first zscale from whatever to gbrp
[23:09:30] <JEEB> then scale from gbrp to rgb24
[23:09:37] <bartzy> so what does that mean? should I avoid swscale (is this literally -color_primaries/-colorspace/-color_trc and the scale filter?) and just use zscale instead?
[23:09:38] <JEEB> and I would expect that conversion to just be packing :D
[23:10:19] <JEEB> the color space related options that you listed are just literally parameters set to the encoder :D
[23:10:36] <JEEB> with FFmpeg 4.4.x+ I rewrote ffmpeg.c to actually take into account input (or filter chain) color metadata
[23:11:12] <JEEB> basically, those color space options affect nothing in the conversion process, you can just specify (or override output metadata with them
[23:11:30] <JEEB> as in, think of them as parameters for the encoder, and not touching anything before that
[23:11:41] <JEEB> the filter chain at that point had been created and all
[23:12:04] <bartzy> not sure I'm following. you mean that in 4.4+ (I have 4.4.2) the input color metadata (from the file OR if overwritten by the options I listed) is taken into account in conversion?
[23:12:32] <JEEB> the options you listed overwrote it always, but now if a filter overwrote it - it also gets taken into account
[23:12:49] <JEEB> before the encoder would get initialized without waiting for the first frame from the filter chain (you always had one even if it was a no-op)
[23:13:02] <bartzy> oh I see. So no matter what values I use for them in my problem, the PNG encoder still got wrong RGB values (because of swscale quirks), and my flags weren't respected at all up until it was "too late" ?
[23:13:03] <JEEB> now you receive the first frame and the encoder's metadata gets applied
[23:13:38] <JEEB> the flags have always been just metadata for the output encoder
[23:13:47] <JEEB> a way to set something you already knew.
[23:13:49] <JEEB> I got tired of that :P
[23:13:58] <JEEB> since I already set metadata in my filter chain
[23:14:08] <JEEB> or already had it in the input
[23:14:30] <bartzy> can I send some -v verbose output in a pastebin link?
[23:14:40] <bartzy> not sure I understand where the filter graph is and/or what it means
[23:15:30] <bartzy> I see these lines: [Parsed_scale_2 @ 0x7fa10fe2e040] w:iw h:ih flags:'bicubic' interl:0
[23:15:36] <bartzy> [graph 0 input from stream 0:0 @ 0x7fa10fe2f680] w:1284 h:2778 pixfmt:yuv422p10le tb:1/30 fr:30/1 sar:1/1
[23:15:42] <bartzy> [Parsed_scale_2 @ 0x7fa10fe2e040] w:1284 h:2778 fmt:gbrp sar:1/1 -> w:1284 h:2778 fmt:rgb24 sar:1/1 flags:0x4
[23:16:03] <JEEB> yup the first one is the input of the filter graph
[23:16:18] <JEEB> second is the scale filter's input/output
[23:16:33] <JEEB> so you can see it going from gbrp to rgb24
[23:16:45] <bartzy> oh but you can't see that it's swscale vs. zscale
[23:17:12] <JEEB> scale is just scale, which is the swscale based one
[23:17:28] <JEEB> so it's doing the packing in that case
[23:17:39] <bartzy> would it help in these cases to output to rawvideo and then pipe to another ffmpeg command for further processing (i.e. PNG output or whatever you need)? Like, to "level" the playing field of YUV to RGB conversion (and then maybe to YUV again). Or is it less ideal to do it
[23:18:19] *** Quits: kib (~kib@user/kib) (Ping timeout: 265 seconds)
[23:18:23] *** Quits: zsoltiv_ (~zsoltiv@fibhost-67-12-35.fibernet.hu) (Ping timeout: 264 seconds)
[23:18:40] <bartzy> I'm just trying to understand "best" modern practices for using ffmpeg. I found out about this coloring issue by chance and spent a day on it :|
[23:18:55] *** Joins: kib (~kib@user/kib)
[23:19:56] *** Joins: zsoltiv_ (~zsoltiv@fibhost-67-12-35.fibernet.hu)
[23:28:09] *** Joins: LanDi (~landi@187.19.137.250)
[23:28:33] *** Joins: SimAV (~SimAV@ip1f10fb08.dynamic.kabel-deutschland.de)
[23:30:39] *** Quits: rsx (~dummy@ppp-188-174-140-121.dynamic.mnet-online.de) (Quit: rsx)
[23:31:24] *** Joins: fructose (~fructose@user/fructose)
[23:34:16] *** Quits: ___nick___ (~quassel@cpc68286-cdif17-2-0-cust533.5-1.cable.virginm.net) (Ping timeout: 252 seconds)
[23:34:32] <bartzy> JEEB: still here perhaps? :)
[23:36:58] *** Quits: jkwnki (~jkwnki@p2e5793bc.dip0.t-ipconnect.de) (Ping timeout: 260 seconds)
[23:37:48] <JEEB> bartzy: I don't see piping helping in any way if you're hitting an issue with a specific pixel conversion. you're losing metadata that you had most likely, and you're still going to have that conversion there. and if you're going to remove that conversion then you can do that within your filter chain as well
[23:38:16] <bartzy> I see. thanks.
[23:39:57] <bartzy> JEEB: Here's the full thing I'm trying to do: I'm trying to take a 422HQ mov in BT709 (mediainfo reports BT709 matrix/transfer/primaries), and convert it to Display P3 (SMPTE432). So literally make the colors more "vivid" on displays that support it. The same effect as it I were embedding the "Display P3" ICC profile to an sRGB image to make a new
[23:39:57] <bartzy> P3'fied image.
[23:40:56] <bartzy> here's what I got so far: ffmpeg -i 0284.mov -vf zscale,format=yuv420p10le -colorspace bt2020c -color_primaries smpte432 -color_trc iec61966-2-1 -c:v libx265 -crf 28 -preset fast -movflags faststart -tag:v hvc1 colorspace_tests/1284x2778/0284-1284x2778-full.mov
[23:41:27] <JEEB> uhh
[23:41:40] <bartzy> but the colors are a bit off. I know that because if I take an sRGB PNG of the first frame and apply the P3 ICC profile on it, that's my reference.
[23:42:17] <JEEB> now take into mention that all those three values for color are just overrides. you ignore whatever metadata the input has, and stick those labels there
[23:42:20] <bartzy> and I'm pretty lost on what to try next :| My question before that you helped me with the zscale trick was just because it was an impediment to even trying that 422HQ input.
[23:43:21] <bartzy> OK but what's the actual pixel values at the end? I think that's the key for my issue
[23:43:58] <JEEB> first of all how does ffprobe or ffmpeg's Input: section describe the video?
[23:44:07] <bartzy> ideally what I want is to take the input 422HQ in BT709, turn it into sRGB RGB frames, then apply that metadata above to make it P3 and hence more vivid.
[23:44:34] <JEEB> "make it more vivid" sounds like "misinterpret as something else"
[23:44:44] <bartzy> exactly
[23:44:46] <JEEB> I really am struggling to figure out what you actually want to do
[23:44:48] <bartzy> I know it's weird
[23:44:58] <bartzy> this is the input section: Stream #0:0(eng): Video: prores (HQ) (apch / 0x68637061), yuv422p10le(tv, bt709, progressive), 1284x2778, 364816 kb/s, SAR 1:1 DAR 214:463, 30 fps, 30 tbr, 30 tbn, 30 tbc (default)
[23:45:19] <JEEB> ok, so it's BT.709|BT.709|BT.709 since the BT.709 only shows up once
[23:45:28] <JEEB> transfer of BT.709 means it's BT.1886
[23:46:23] <JEEB> so basically since you're only setting an output format, most likely zimg is only doing the chroma subsampling from 4:2:2 to 4:2:0
[23:46:36] <bartzy> OK, so I have some input videos that is in BT709 that designers made. Comes from After Effects, encoded with Adobe Media Encoder as 422HQ BT709. All these videos are meant to be delivered to iOS only devices, with screens supporting the P3 colorspace. For some of these videos, I actually want the "interpret as something else" feeling. It just looks
[23:46:36] <bartzy> much better
[23:47:57] <JEEB> I wonder if this is because BT.1886 is actually followed on iOS, while on macs/QT you get a different reverse-BT.709 and then something else handling :P
[23:48:09] <JEEB> and not too much to do with actual P3
[23:48:15] *** Quits: nillyhan (~00000000@user/nillyhan) (Quit: Leab)
[23:48:42] <bartzy> I understand this is kinda weird and not a standard workflow (why not just do it in AE?), but we made that decision to only output in BT709 and sRGB from the authoring software, and deal with it later in ffmpeg when encoding to HEVC :|
[23:49:49] <JEEB> anyways, you can see the output AVFrames' metadata get passed onto the Output: section if you just after the filter chain do `-f null -frames:v 1 -` or so
[23:50:02] <JEEB> in earlier FFmpeg versions pre-4.4 you would get undefined there
[23:50:17] <bartzy> JEEB: Actually we have another input source for some videos. Some videos are coming to us from designers as PNG sRGB sequences. And I got to the ffmpeg flow/command that gives me perfect results (i.e. PNG sRGB -> yuv420p10le in HEVC, in P3). If it helps:
[23:50:18] <JEEB> with 4.4+ due to blood, sweat and tears you get what the AVFrame says
[23:50:51] <bartzy> ok I'll do that, just posting the ffmpeg command that works with sRGB PNG sequences as input:
[23:51:09] <JEEB> but in any case, zscale and just chroma subsampling difference most likely just does that - changes the chroma subsampling. so it is the same BT.709|BT.709|BT.709 :p
[23:51:50] <bartzy> ffmpeg -framerate 30 -i png_sequence/0312_%05d.png -vf scale=in_range=full:out_range=full,format=yuv420p10le -color_range pc -colorspace bt2020c -color_primaries smpte432 -color_trc iec61966-2-1 -c:v libx265 -crf 28 -preset fast -movflags faststart -tag:v hvc1 0312/colorspace_tests/1284x2778/0312-1284x2778-full.mov
[23:52:51] <JEEB> ok, so you get most likely no touching the transfer function, so that's still sRGB
[23:53:02] <JEEB> so that color_trc is actually correct
[23:53:26] <JEEB> then color_range should not be necessary with 4.4+ unless the scale filter is dumb since you request full range output
[23:53:39] <JEEB> (from the filter chain that is)
[23:54:06] <bartzy> yeah I just added it for good measure :)  not sure I even need full range since I don't quite get if it's needed with YUV or supported. But I thought since this is delivered to iOS only, why not?
[23:54:22] <JEEB> in_range for RGB should be full by default
[23:54:41] <JEEB> unless the decoder is insane and outputs limited range RGB for some reason
[23:54:54] <JEEB> (should be visible in the input: section in that case)
[23:54:58] <bartzy> without the out_range=full it was doing limited. Is full-range YUV420p10le even makes sense?
[23:55:39] <JEEB> depends on your use case? it lets you use more bits so it's technically better. only if you then need to support players that don't handle full range YCbCr (even if flagged), you have a problem
[23:55:56] <JEEB> also swscale/scale filter by default handle the conversion as BT.601
[23:56:03] <JEEB> just fyi, welcome to early 2000s
[23:56:20] <bartzy> by makes sense I mean possibly better quality for a small increase in file size (10% increase from limited with same x265 CRF). Or is decreasing the CRF going to help me much more for the same file size increase?
[23:57:30] <bartzy> It's a motion graphics/VFX video. Not video footage from a camera. so I somehow thought that full-range is better here
[23:58:19] <JEEB> if the players you need to support support full range, it has more range in values for the same max and min, thus being more precise
[23:58:35] <JEEB> that is what I was saying with more bits :P
[23:58:55] <bartzy> yeah but also larger file size, which can be used for a smaller CRF for example instead of the full range
[23:59:10] <JEEB> I am not sure if you can extrapolate it like that
[23:59:20] <bartzy> what do you mean?
