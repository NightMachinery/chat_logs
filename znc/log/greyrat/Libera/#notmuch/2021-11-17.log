[00:00:12] *** Joins: gast0n (~g4570n@user/gast0n)
[00:26:01] <anarchat> epic
[00:26:01] <anarchat> C: 0/1  B: 134/205  F: +0/0 *0/0 #0/0  N: +1/677 *0/0 #0/0corrupted size vs. prev_size while consolidating
[00:26:02] <anarchat> Abandon (core dumped)
[00:46:18] <bremner> andi-: I only have about 700k messages, but I have heard from others that indexing gets slow with more than 1 million messages
[00:47:39] <andi-> bremner: yeah, it finished after about 27h
[00:48:06] <andi-> I had to re-run notmuch new as it complained about not being index some mails and aborted 700k short..
[00:48:16] <bremner> I have played around with parallel indexing, but didn't get any speedups.
[00:49:13] <bremner> The abort sounds odd. If you can reproduce, I'd be interested.
[00:49:57] <bremner> andi-: is your system using SSD?
[00:50:09] <andi-> yeah, I have 2 NVMe drives in a ZFS mirror
[00:52:51] <andi-> ugh, something is wrong here...
[00:52:54] <andi-> > terminate called after throwing an instance of 'Xapian::DatabaseCorruptError'
[00:53:12] <bremner> andi-: if you have time / motivation, running the notmuch performance test suite would give us a baseline
[00:53:15] <andi-> That happend after/while my tagging program that uses notmuch ran..
[00:54:13] *** Joins: rgrinberg (~textual@201.192.183.100)
[00:55:34] <bremner> Hmm. It should not really be possible to get that level of corruption using notmuch / xapian APIs
[00:56:45] <andi-> I am also surprised. I think I'll run the indexing on another machine (With the exact same binaries/libraries) to see if it really isn't the hardware.
[01:00:27] <andi-> the smart values look fine. Could have been so easy (https://termbin.com/1n8t)
[01:22:57] *** Quits: rgrinberg (~textual@201.192.183.100) (Read error: Connection reset by peer)
[01:23:38] *** Joins: rgrinberg (~textual@201.192.183.100)
[01:34:39] *** Quits: rgrinberg (~textual@201.192.183.100) (Read error: Connection reset by peer)
[01:35:50] *** Joins: rgrinberg (~textual@201.192.183.100)
[01:53:04] *** Quits: rgrinberg (~textual@201.192.183.100) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[02:05:29] *** Quits: seschwar (~seschwar@user/seschwar) (Quit: :wq)
[02:16:45] *** Joins: rdrg109 (~rdrg109@user/rdrg109)
[03:56:34] *** Joins: rgrinberg (~textual@201.192.183.100)
[05:50:14] *** Quits: fauno (~fauno@user/fauno) (Remote host closed the connection)
[05:50:57] *** Joins: fauno (~fauno@user/fauno)
[06:01:35] *** Quits: gast0n (~g4570n@user/gast0n) (Ping timeout: 264 seconds)
[07:08:58] *** Quits: rgrinberg (~textual@201.192.183.100) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[07:09:12] *** Quits: jao (~jao@cpc103048-sgyl39-2-0-cust502.18-2.cable.virginm.net) (Ping timeout: 256 seconds)
[07:20:36] *** Quits: andi- (~andi-@user/andi-) (Remote host closed the connection)
[07:21:24] *** Joins: andi- (~andi-@user/andi-)
[07:24:41] *** Joins: gast0n (~g4570n@user/gast0n)
[07:47:24] *** Quits: nyah (~nyah@94.6.71.219) (Ping timeout: 265 seconds)
[09:27:51] *** Quits: gast0n (~g4570n@user/gast0n) (Quit: Bye, see you soon! ðŸ‘‹)
[10:00:28] *** Joins: kzak (~kzak@nat-37.starnet.cz)
[10:16:39] *** Joins: wking (~wking@c-73-221-66-144.hsd1.wa.comcast.net)
[11:02:58] *** Quits: radu242407 (~radu242@pool-141-157-204-247.nycmny.fios.verizon.net) (Ping timeout: 260 seconds)
[11:19:26] *** Quits: bindu (~bindu@user/bindu) (Remote host closed the connection)
[11:19:52] *** Joins: bindu (~bindu@user/bindu)
[11:21:59] *** Joins: radu242407 (~radu242@pool-96-250-79-242.nycmny.fios.verizon.net)
[11:52:32] *** Quits: amolith (~amolith@nixnet/founder/amolith) (Ping timeout: 256 seconds)
[11:53:04] *** Joins: amolith (~amolith@nixnet/founder/amolith)
[13:21:53] *** Quits: amolith (~amolith@nixnet/founder/amolith) (Read error: Connection reset by peer)
[13:28:59] *** Joins: amolith (~amolith@nixnet/founder/amolith)
[14:11:01] *** meskio1 is now known as meskio
[14:18:16] <andi-> after 6h notmuch restore --tags=tags.gz exited with a Xapian::DatabaseCorruptError :| Am I maybe exceeding some 32bit int somewhere? Number of words in the database?
[14:30:59] *** Quits: kzak (~kzak@nat-37.starnet.cz) (Ping timeout: 265 seconds)
[15:04:24] *** Quits: bindu (~bindu@user/bindu) (Ping timeout: 276 seconds)
[15:13:46] *** Joins: bindu (~bindu@user/bindu)
[15:48:03] <bremner> andi-: I guess more people would hit it if so. Document ids are 32 bit iirc, but you are not near that limit. I'm guess you retyped the restore command, as it doesn't look quite right.
[15:48:47] <andi-> Oh yeah, I retyped that.
[15:49:06] <andi-> I just disabled FS level compression. That did give a nice 20% performance boost on the import speed according to perf.
[15:49:40] <andi-> Not sure what was going on but 20% of the time was spent decompressing files. Not sure how efficient that is implemented in regard to a few large files.
[15:52:29] <bremner> Xapian uses zlib compression internally, so probably some double compression there.
[15:53:13] <andi-> Yeah, I just used that because most of my stuff is source code on this machine and it felt like the logical thing to do...
[15:53:51] <andi-> That being said the import appears to be a lot faster this time around. (Processed 814907 of 3757907 files (4h 55m 21s remaining).). Still have to run those benchmarks.
[16:02:40] <bremner> It might be useful to have a page of zfs hints on  the wiki, assuming you figure things out
[16:14:29] <bremner> andi-: fwiw, notmuch is fairly flexible about the database location these days, so you could put it on a different filesystem from the mail messages
[16:15:19] <andi-> Yeah, if this fails again I'll try a plain old simple ext4.
[16:21:48] *** Quits: fauno (~fauno@user/fauno) (Remote host closed the connection)
[16:22:31] *** Joins: fauno (~fauno@user/fauno)
[16:27:59] <andi-> Interesting observation so far: The longer the import runs (so probably dependning on the DB size) the more time it spents in libc's pread. Is the import doing linear scanning of sorts?
[16:41:31] *** Joins: jao (~jao@cpc103048-sgyl39-2-0-cust502.18-2.cable.virginm.net)
[17:47:44] *** Joins: gast0n (~g4570n@user/gast0n)
[17:52:07] *** Joins: rgrinberg (~textual@201.192.183.100)
[18:07:12] *** Joins: nyah (~nyah@94.6.71.219)
[18:24:27] *** Quits: gast0n (~g4570n@user/gast0n) (Quit: ...)
[18:30:11] *** Quits: rgrinberg (~textual@201.192.183.100) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[18:55:45] <Domo> how are you measuring that time spent in pread... i'd presume libc pread is thin wrapper for the actual syscall...
[18:56:09] <Domo> so is is spending time in that syscall (most probably) or ...
[18:57:50] <Domo> (and then, if seen, what are the count and offset values...)
[19:11:37] *** Joins: nlhowell1 (~nlhowell@2600:1702:1bd0:4440::33)
[19:33:24] *** Joins: seschwar (~seschwar@user/seschwar)
[19:44:01] *** Quits: nlhowell1 (~nlhowell@2600:1702:1bd0:4440::33) (Ping timeout: 250 seconds)
[19:50:15] *** Quits: _coderkalyan (2c72974719@user/coderkalyan) (Remote host closed the connection)
[19:57:55] *** Joins: _coderkalyan (2c72974719@user/coderkalyan)
[19:58:56] <andi-> Domo: I'm using `perf -g -p $PID` and yeah it is the inclusive time for the syscall not just the libc wrapper
[20:27:49] *** Joins: nlhowell1 (~nlhowell@2600:1702:1bd0:4440::33)
[20:34:17] *** Quits: nlhowell1 (~nlhowell@2600:1702:1bd0:4440::33) (Ping timeout: 250 seconds)
[20:35:46] *** Joins: nlhowell1 (~nlhowell@2600:1702:1bd0:4440::33)
[21:23:59] <jani> off-topic-ish... trying to install fetchmail on debian bullseye fails with "Failed to fetch http://deb.debian.org/debian/pool/main/f/fetchmail/fetchmail_6.4.16-4_amd64.deb  404  Not Found".  and indeed it's not there. https://deb.debian.org/debian/pool/main/f/fetchmail/fetchmail_6.4.16-4+deb11u1_amd64.deb is, however. where did the +deb11u1 part go?
[21:29:02] <andi-> moved my notmuch database to tmpfs as it was writing 500MB/s on the disks and sync'ing
[22:19:09] *** Quits: nlhowell1 (~nlhowell@2600:1702:1bd0:4440::33) (Ping timeout: 250 seconds)
[23:05:33] *** Joins: gast0n (~g4570n@user/gast0n)
[23:06:52] <andi-> Turns out the import finishes in <3h if done on tmpfs.. unfortunately running `notmuch compact` right after it finished did trigger another xapian error
[23:07:07] <andi-> > Error while compacting: Error writing block 911549
[23:07:12] <andi-> Not sure if that it helpful.
[23:20:01] <andi-> restored the post-import backup and tried again but this time "Error while compacting: Bad position key"
[23:20:10] <andi-> I must have some very cured emails..
[23:20:13] <andi-> *cursed
[23:28:06] *** Quits: fauno (~fauno@user/fauno) (Remote host closed the connection)
[23:28:53] *** Joins: fauno (~fauno@user/fauno)
