[00:13:50] *** Quits: bitigchi2 (~bitigchi@user/bitigchi) (Ping timeout: 256 seconds)
[00:25:59] *** Quits: gabriel1 (~gabriel1@user/gabriel1) (Remote host closed the connection)
[00:39:12] *** Quits: strajder (~strajder@user/strajder) (Quit: leaving)
[00:39:49] *** Joins: rgrinberg (~textual@2806:101e:7:134:6049:80d8:3eba:ca96)
[00:43:12] *** Joins: nattiestnate (~nate@202.138.250.10)
[00:46:10] *** Joins: bitigchi2 (~bitigchi@user/bitigchi)
[00:48:55] *** Joins: epony (epony@user/epony)
[00:53:01] *** Quits: nyah (~nyah@05453449.skybroadband.com) (Quit: leaving)
[00:54:03] *** Joins: nyah (~nyah@05453449.skybroadband.com)
[01:08:12] *** Quits: Vaelatern (~Vaelatern@voidlinux/maintainer/Vaelatern) (Ping timeout: 240 seconds)
[01:13:22] *** Quits: nattiestnate (~nate@202.138.250.10) (Quit: WeeChat 3.4)
[01:14:18] *** Quits: rgrinberg (~textual@2806:101e:7:134:6049:80d8:3eba:ca96) (Ping timeout: 252 seconds)
[01:15:02] *** Quits: earthnative (~nemo@119-18-37-212.771225.bne.static.aussiebb.net) (Ping timeout: 256 seconds)
[01:21:50] *** Quits: sss1 (~sss1@46.148.180.137) (Ping timeout: 256 seconds)
[01:22:16] *** Joins: Vaelatern (~Vaelatern@cpe-76-183-97-243.tx.res.rr.com)
[01:22:16] *** Quits: Vaelatern (~Vaelatern@cpe-76-183-97-243.tx.res.rr.com) (Changing host)
[01:22:16] *** Joins: Vaelatern (~Vaelatern@voidlinux/maintainer/Vaelatern)
[01:23:53] *** Joins: sss1 (~sss1@46.148.180.137)
[01:24:34] *** Joins: earthnative (~nemo@119-18-37-212.771225.bne.static.aussiebb.net)
[01:30:14] *** Quits: earthnative (~nemo@119-18-37-212.771225.bne.static.aussiebb.net) (Ping timeout: 272 seconds)
[01:41:15] *** Joins: earthnative (~nemo@119-18-37-212.771225.bne.static.aussiebb.net)
[01:45:26] *** Quits: sss1 (~sss1@46.148.180.137) (Ping timeout: 272 seconds)
[01:47:16] *** Joins: sss1 (~sss1@46.148.180.137)
[02:18:30] *** Quits: sss1 (~sss1@46.148.180.137) (Ping timeout: 256 seconds)
[02:20:35] *** Joins: sss1 (~sss1@46.148.180.137)
[02:26:36] *** Quits: elshize (elshize@gateway/vpn/protonvpn/elshize) (Ping timeout: 272 seconds)
[02:28:04] *** Joins: motherfsck (~motherfsc@user/motherfsck)
[02:28:13] *** Joins: elshize (~elshize@70.107.91.44)
[02:35:17] *** Joins: bsd4me (~usingbsd@user/bsd4me)
[02:46:26] *** Quits: motherfsck (~motherfsc@user/motherfsck) (Quit: quit)
[02:48:53] *** Quits: sss1 (~sss1@46.148.180.137) (Ping timeout: 252 seconds)
[02:50:54] *** Joins: sss1 (~sss1@46.148.180.137)
[03:04:06] *** Quits: plastico (~plastico@neomutt/plastico) (Quit: WeeChat 3.4)
[03:08:36] *** Quits: bitigchi2 (~bitigchi@user/bitigchi) (Ping timeout: 240 seconds)
[03:40:21] *** Quits: sss1 (~sss1@46.148.180.137) (Ping timeout: 256 seconds)
[03:42:13] *** Joins: sss1 (~sss1@46.148.180.137)
[03:53:00] *** Quits: nyah (~nyah@05453449.skybroadband.com) (Remote host closed the connection)
[04:05:33] *** Joins: bitigchi2 (~bitigchi@user/bitigchi)
[04:10:29] *** Quits: flatcap (flatcap@neomutt/flatcap) (Quit: WeeChat 3.4)
[04:10:29] *** Quits: neo-bot (~neo-bot@flatcap.org) (Remote host closed the connection)
[04:11:15] *** Joins: neo-bot (~neo-bot@flatcap.org)
[04:11:45] *** Joins: flatcap (flatcap@neomutt/flatcap)
[04:11:50] *** Quits: bitigchi2 (~bitigchi@user/bitigchi) (Ping timeout: 256 seconds)
[04:14:46] *** Joins: tyler (~tyler82@185.69.144.213)
[04:17:16] *** Joins: rgrinberg (~textual@187.223.170.172)
[04:25:03] *** Joins: vysn (~vysn@user/vysn)
[04:27:21] *** Quits: Pali (~pali@user/pali) (Ping timeout: 268 seconds)
[04:30:08] *** Quits: NetSysFire (~NetSysFir@silly/elektra) (Remote host closed the connection)
[04:30:34] *** Joins: NetSysFire (~NetSysFir@silly/elektra)
[04:40:37] *** Quits: polve (~polve@user/polve) (Ping timeout: 240 seconds)
[04:41:50] *** Joins: polve (~polve@user/polve)
[04:49:46] *** Quits: tyler (~tyler82@185.69.144.213) (Quit: WeeChat 3.4)
[05:15:42] *** Quits: Seirdy (~Seirdy@sourcehut/user/seirdy) (Quit: exiting 3.4)
[05:32:17] *** Quits: maetthew (~maetthew@user/maetthew) (Quit: ZNC 1.8.2 - https://znc.in)
[05:35:04] *** Joins: maetthew (~maetthew@c188-150-159-232.bredband.tele2.se)
[05:35:04] *** Quits: maetthew (~maetthew@c188-150-159-232.bredband.tele2.se) (Changing host)
[05:35:04] *** Joins: maetthew (~maetthew@user/maetthew)
[05:37:35] *** Quits: rgrinberg (~textual@187.223.170.172) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[05:39:35] *** Joins: rgrinberg (~textual@2806:101e:7:134:a109:7fe8:fefe:7469)
[06:07:43] *** Joins: alec (~alec@104.219.97.186)
[06:10:44] *** Quits: rgrinberg (~textual@2806:101e:7:134:a109:7fe8:fefe:7469) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[06:12:44] *** Joins: rgrinberg (~textual@2806:101e:7:134:a109:7fe8:fefe:7469)
[06:20:46] *** Quits: alec (~alec@104.219.97.186) (Quit: WeeChat 3.0)
[06:37:23] *** Joins: ahelio (~alec@104.219.97.186)
[06:37:49] *** Quits: ahelio (~alec@104.219.97.186) (Quit: #xonsh)
[06:49:40] *** Quits: bsd4me (~usingbsd@user/bsd4me) (Quit: Leaving)
[06:55:07] *** Joins: bsd4me (~usingbsd@user/bsd4me)
[07:05:48] *** Joins: bitigchi2 (~bitigchi@user/bitigchi)
[07:10:35] *** Quits: bitigchi2 (~bitigchi@user/bitigchi) (Ping timeout: 256 seconds)
[07:15:02] *** Quits: rgrinberg (~textual@2806:101e:7:134:a109:7fe8:fefe:7469) (Ping timeout: 260 seconds)
[07:46:53] *** Joins: Seirdy (~Seirdy@sourcehut/user/seirdy)
[08:06:18] *** Quits: reset (~reset@user/reset) (Quit: reset)
[08:17:24] *** Quits: sudoforge (~sudoforge@wireguard/tunneler/sudoforge) (Ping timeout: 250 seconds)
[08:31:15] *** Joins: rgrinberg (~textual@2806:101e:7:134:f9e0:c2a9:e969:348a)
[08:45:54] *** Quits: bsd4me (~usingbsd@user/bsd4me) (Quit: Leaving)
[08:54:09] *** Quits: blaub (~blaub@194.208.201.25) (Quit: WeeChat 3.4)
[09:02:57] *** Quits: rgrinberg (~textual@2806:101e:7:134:f9e0:c2a9:e969:348a) (Ping timeout: 240 seconds)
[09:07:06] *** Joins: bitigchi2 (~bitigchi@user/bitigchi)
[09:12:44] *** Quits: bitigchi2 (~bitigchi@user/bitigchi) (Ping timeout: 256 seconds)
[09:23:14] *** Joins: nattiestnate (~nate@202.138.250.13)
[09:31:02] *** Quits: nattiestnate (~nate@202.138.250.13) (Quit: WeeChat 3.4)
[09:39:15] *** Quits: sbach (~sbach@user/sbach) (Read error: Connection reset by peer)
[09:41:32] *** Joins: sbach (~sbach@user/sbach)
[09:58:04] *** Quits: lazycat (~lazycat@user/lazycat) (Quit: ZNC - https://znc.in)
[10:00:38] *** Joins: kzak_ (~kzak@nat-37.starnet.cz)
[10:00:41] *** Joins: lazycat (~lazycat@user/lazycat)
[10:36:10] *** Quits: keypusher (keypusher@user/keypusher) (Ping timeout: 260 seconds)
[10:40:04] *** Joins: keypusher (keypusher@user/keypusher)
[11:42:16] <gahr> morning
[12:38:05] *** Joins: Pali (~pali@user/pali)
[12:38:16] *** Joins: plastico (~plastico@neomutt/plastico)
[12:47:45] *** Joins: bitigchi2 (~bitigchi@user/bitigchi)
[13:15:33] *** Joins: _rittchen_ (~rittchen@gateway/tor-sasl/rittchen)
[13:15:39] *** Quits: _rittchen (~rittchen@gateway/tor-sasl/rittchen) (Remote host closed the connection)
[13:26:13] <flatcap> morning all
[13:30:16] <gahr> hi flatcap 
[13:30:50] *** Quits: _rittchen_ (~rittchen@gateway/tor-sasl/rittchen) (Remote host closed the connection)
[13:31:12] *** Joins: _rittchen_ (~rittchen@gateway/tor-sasl/rittchen)
[13:35:40] <flatcap> hi gahr 
[13:40:15] <flatcap> are you busy?  got time for a challenge?
[13:55:21] <gahr> always
[13:55:25] <gahr> to both questions :)
[13:55:34] <flatcap> :-)
[13:56:00] <flatcap> I've got a couple of ideas...
[13:56:17] * gahr fear
[13:57:13] <flatcap> there are a pair of upstream changes:
[13:57:14] <flatcap> the first refactors the parse_mailboxes() and adds -(no)label and -(no)poll options
[13:57:48] <flatcap> the second refactors imap so that lsub calls the mailboxes command directly, rather than generating a config line to parse
[13:58:01] <flatcap>  
[13:58:30] <flatcap> the second idea, is a small mental challenge: #3285
[13:58:30] <neo-bot> Issue by @dcpurton "ASAN memory leak when loading sample.neomuttrc": https://github.com/neomutt/neomutt/issues/3285
[13:59:05] <flatcap> I've done a quick analysis (and created a nice diagram :-)
[13:59:39] <flatcap>  
[14:00:31] <flatcap> the first brings us in line with upstream and also fixes a subtle bug in imap when you have multiple accounts on a single server
[14:02:01] <flatcap> the second is easilily triggered, it just needs a bit of careful debugging
[14:02:03] <flatcap>  
[14:02:12] <flatcap> either take your fancy?
[14:09:33] <gahr> 3285 a bit
[14:09:47] <gahr> merging upstream, not really
[14:10:07] <gahr> I can take 3285 yeah
[14:10:19] <gahr> doesn't dcpurton want to do it?
[14:11:04] <flatcap> thanks, no he doesn't :-)
[14:12:29] <flatcap> I've pushed some debugging changes to flatcap/gv-pattern (to generate diagrams)
[14:13:18] <flatcap> (and yes, if I'd spent the time that I used making diagrams, I might have already fixed the bug :-)
[14:17:17] <gahr> of I can repro it
[14:18:19] <flatcap> it's a leak (that you can't see), but it should always be repro from that one-liner
[14:18:31] <gahr> I can see it
[14:18:34] <gahr> with valgrind
[14:18:38] <gahr> :)
[14:18:52] <flatcap> great :-)
[14:21:04] *** Quits: redgloboli (~redglobol@user/redgloboli) (Quit: ...enter the matrix...)
[14:22:06] *** Joins: redgloboli (~redglobol@user/redgloboli)
[14:24:36] *** Joins: whatsyourask (~whatsyour@user/whatsyourask)
[14:30:06] *** Quits: ueberall (ueberall_l@user/ueberall) (Quit: ZNC)
[14:33:52] *** Joins: ueberall (ueberall_l@user/ueberall)
[15:12:54] <gahr> #3292, but I'd like to unit test it first
[15:12:54] <neo-bot> PR by @gahr "Plug a leak in mutt_pattern_comp": https://github.com/neomutt/neomutt/pull/3292
[15:13:19] * flatcap builds ...
[15:13:31] <flatcap> sure
[15:18:27] <flatcap> no leaks here (simple test, or regular config)
[15:21:39] <gahr> do you think this is too ugly? https://github.com/neomutt/neomutt/pull/3292/commits/76b5ba0875e0eeac885addc378dd90e0423eaf96
[15:22:48] * flatcap looks ...
[15:23:12] <flatcap> er...
[15:25:10] <flatcap> given that we've spent a lot of time eliminating ugly macros...
[15:25:15] <gahr> yeah
[15:25:31] <flatcap> and turning it into an inline function would be messier still
[15:25:44] <gahr> yeah
[15:25:49] <gahr> ok let me just remove it
[15:25:55] <flatcap> hmm... 5 places
[15:26:11] <gahr> perhaps I can refactor that function so we don't have to keep track of three pattern thingies
[15:26:50] <flatcap> very probably
[15:27:11] <flatcap> it's a clever bit of code, but I'm sure it could be better written
[15:27:31] <gahr> ok let me first make sure I plug all the leaks
[15:27:58] <flatcap> yep
[16:20:09] *** Quits: bitigchi2 (~bitigchi@user/bitigchi) (Ping timeout: 252 seconds)
[16:38:01] <gahr> I have a unit test that triggers the leak in master
[16:38:06] <gahr> not sure what I'd test, though..
[16:38:17] <gahr> I mean.. not sure how to make it fail when we leak
[16:38:28] <gahr> other than instrumenting calloc and free
[16:39:45] <flatcap> hmm...
[16:40:28] <flatcap> currently, none of the tests leak...
[16:40:42] <flatcap> if you build them with asan, then a leak causes the test to fail
[16:41:07] *** Quits: whatsyourask (~whatsyour@user/whatsyourask) (Ping timeout: 250 seconds)
[16:41:16] <flatcap> so we could alter the github action to rebuild with asan (just for the unit tests)
[16:42:07] <gahr> good idea
[16:51:08] <gahr> ok I think I caught a couple of leaks
[16:55:55] <flatcap> great
[17:05:15] *** Joins: nyah (~nyah@05453449.skybroadband.com)
[17:06:26] <gahr> what I don't like about mutt_pattern_comp is that we create intermediate PatternList only to use their first (and only) element
[17:07:39] <flatcap> yeah
[17:09:25] * flatcap builds the tests too...
[17:10:48] <flatcap> all good
[17:37:38] *** Quits: Maxattax (~max@50-195-160-193-static.hfc.comcastbusiness.net) (Ping timeout: 256 seconds)
[17:52:10] *** Joins: Maxattax (~max@50-195-160-193-static.hfc.comcastbusiness.net)
[18:05:39] *** Joins: bsd4me (~usingbsd@user/bsd4me)
[18:16:44] *** Quits: sss1 (~sss1@46.148.180.137) (Ping timeout: 252 seconds)
[18:18:32] *** Joins: sss1 (~sss1@46.148.180.137)
[18:38:06] <gahr> thanks for the comprehensive test/pattern/comp.c :)
[18:40:55] <flatcap> :-)
[18:41:08] <flatcap> I've got the github action working
[18:41:46] <flatcap> if asan is triggered it saves the log as an (downloadable) artifact
[18:42:28] <flatcap> when shall we run it?
[18:42:44] <flatcap> on [devel/*] + PRs + master?
[18:42:59] <flatcap> or once a week, like coverity, etc
[18:46:18] <gahr> is it too much to always run tests with asan on?
[18:46:22] <gahr> or to always build with asan on?
[18:46:24] <gahr> :)
[18:46:41] <flatcap> nah, it's Microsoft's money :-)
[18:51:18] *** Joins: reset (~reset@user/reset)
[18:56:53] <flatcap> example failure: https://github.com/neomutt/neomutt/actions/runs/1952214010
[19:00:36] <gahr> what test fails?
[19:01:04] <gahr> oh
[19:01:12] <gahr> :)
[19:01:37] <gahr> so I'm refactoring how nodes are added to the pattern list in mutt_pattern_comp
[19:02:00] <gahr> basically now we're keeping each node as a list so we can append to it
[19:02:07] <gahr> instead of using a doubly-linked list :/
[19:03:26] <flatcap> your code's fine, that's an engineered failure :-)
[19:03:40] <flatcap> ah, nice
[19:06:05] <gahr> https://github.com/neomutt/neomutt/pull/3292/commits/2d1616fd4ee4c757a7ec98beba85d88ef5929a3c
[19:08:19] <gahr> not perfect, still chasing a small bug
[19:09:05] <flatcap> ok.  I'll have a read in a sec
[19:11:02] <flatcap> I've merged the asan checks.  if you rebase they'll kick in
[19:12:02] *** Joins: blaub (~blaub@194-208-201-025.tele.net)
[19:14:49] *** Joins: bitigchi2 (~bitigchi@user/bitigchi)
[19:17:22] *** Quits: bsd4me (~usingbsd@user/bsd4me) (Ping timeout: 256 seconds)
[19:19:31] *** Quits: bitigchi2 (~bitigchi@user/bitigchi) (Ping timeout: 245 seconds)
[19:24:17] <gahr> ok please don't look at that commit, look at this one: https://github.com/neomutt/neomutt/pull/3292/commits/13ce76742995ff3476a99c1834e0a157643c0dd5
[19:25:55] * flatcap looks ...
[19:26:10] <flatcap> first impressions: it's looking a LOT tidier :-)
[19:27:42] <gahr> I could use some help with naming the helper functions :)
[19:28:04] <flatcap> hehe, ok
[19:28:44] <gahr> I was about to rant about the quality of that code, but let me git blame first :)
[19:29:21] <flatcap> :-)
[19:30:06] <gahr> Initial revision phew
[19:32:23] <flatcap> hehe
[19:32:51] <gahr> https://github.com/neomutt/neomutt/blob/1a5381e07e97fe482c2b3a7c75f99938f0b105d4/pattern.c#L601-L605
[19:32:54] <gahr> this pattern. I hate it.
[19:33:09] <gahr> and it's all over the place
[19:33:16] <gahr> well, a bit less now than it was before 
[19:33:54] <gahr> do you want me to split the PR between plugging the leak and refactoring the parser?
[19:34:13] <gahr> I think I want to make sure the coverage of the pattern branches is ok
[19:35:11] <flatcap> yeah, splitting the fix and refactoring sounds good
[19:38:34] <gahr> doing
[19:38:43] <flatcap> thanks
[19:40:04] <gahr> done
[19:40:12] *** Quits: vysn (~vysn@user/vysn) (Ping timeout: 240 seconds)
[19:42:10] <gahr> btw, I think I'm seeing the index not showing limited messages when I limit
[19:42:27] <gahr> something off with the thing that keeps track of the current position, probably
[19:42:30] <gahr> if I page up, they show up
[19:46:13] <gahr> yeah I can repro with an empty config
[19:46:25] <flatcap> ah, ok.  the repainting's a bit off, still
[19:46:42] <gahr> simple mbox with 3 emails, flag the second one, l~F
[19:46:44] <gahr> all disappear
[19:46:53] * flatcap tries
[19:46:57] <gahr> page-up, the second email appears (correctly, alone)
[19:48:00] <flatcap> hmm...
[19:48:47] <gahr> can't repro?
[19:49:00] <flatcap> I can reproduce that
[19:49:15] <flatcap> I'm just wondering what I've broken this time
[19:49:57] <flatcap> and why up/down fail, but page up/down success
[19:50:15] <gahr> I guess up/down depend on the current value
[19:50:29] <gahr> right, up/down should, too :)
[19:52:08] <flatcap> if you limit whilst at line 1, it's fine
[19:56:50] <gahr> true
[19:56:59] <gahr> so it's probably the current selection that goes out of range?
[19:57:19] <gahr> it also works if you limit to 2 messages and you're on line 2 :D
[19:57:35] <gahr> it also works if you limit to 2 messages and you're on line 3 - wtf
[19:58:13] <flatcap> yeah
[19:58:22] <flatcap> oh
[19:58:25] <gahr> it works as long as you're at or before one of the limited messagtes
[19:58:36] <gahr> if you're at line x and all limited messages are at x+y, it won't work
[19:58:52] <gahr> not true.
[19:58:55] <gahr> I don't know :)
[19:59:46] <flatcap> hehe
[20:08:34] *** Joins: gabriel1 (~gabriel1@user/gabriel1)
[20:09:41] *** Joins: bitigchi2 (~bitigchi@user/bitigchi)
[20:42:07] *** Joins: whatsyourask (~whatsyour@user/whatsyourask)
[20:48:48] *** Quits: andi- (~andi-@user/andi-) (Ping timeout: 250 seconds)
[20:58:14] *** Quits: sss1 (~sss1@46.148.180.137) (Ping timeout: 256 seconds)
[20:59:53] *** Joins: sss1 (~sss1@46.148.180.137)
[21:01:39] *** Joins: andi- (~andi-@user/andi-)
[21:14:50] *** Joins: rgrinberg (~textual@2806:101e:7:134:a534:da12:3a85:780f)
[21:25:52] *** Joins: bsd4me (~usingbsd@user/bsd4me)
[21:36:35] *** Joins: gabriel1_ (~gabriel1@37.165.142.47)
[21:38:25] *** Quits: gabriel1 (~gabriel1@user/gabriel1) (Ping timeout: 268 seconds)
[21:49:24] *** Quits: sss1 (~sss1@46.148.180.137) (Ping timeout: 272 seconds)
[21:50:52] *** Joins: strajder (~strajder@user/strajder)
[21:51:12] *** Joins: sss1 (~sss1@46.148.180.137)
[22:11:41] *** Joins: sudoforge (~sudoforge@wireguard/tunneler/sudoforge)
[22:44:19] *** Quits: blaub (~blaub@194-208-201-025.tele.net) (Read error: Connection reset by peer)
[23:13:16] *** Quits: whatsyourask (~whatsyour@user/whatsyourask) (Quit: whatsyourask)
[23:14:29] *** Quits: rgrinberg (~textual@2806:101e:7:134:a534:da12:3a85:780f) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[23:15:32] *** Joins: rgrinberg (~textual@2806:101e:7:134:a534:da12:3a85:780f)
[23:29:13] *** Quits: CrashOverride (~strcat@p54855450.dip0.t-ipconnect.de) (Ping timeout: 256 seconds)
[23:31:05] *** Joins: CrashOverride (~strcat@p548541a3.dip0.t-ipconnect.de)
[23:37:07] *** Quits: rgrinberg (~textual@2806:101e:7:134:a534:da12:3a85:780f) (Ping timeout: 250 seconds)
[23:52:51] *** Quits: sss1 (~sss1@46.148.180.137) (Ping timeout: 268 seconds)
[23:54:33] *** Joins: sss1 (~sss1@46.148.180.137)
